// AUTO-GENERATED - DO NOT EDIT
// Run: bun scripts/gen_builtin_skills.ts
// Source: src/node/builtinSkills/*.md and docs/

export const BUILTIN_SKILL_FILES: Record<string, Record<string, string>> = {
  init: {
    "SKILL.md": [
      "---",
      "name: init",
      "description: Bootstrap an AGENTS.md file in a new or existing project",
      "---",
      "",
      "<system>",
      "Use your tools to create or improve an AGENTS.md file in the root of the workspace which will serve as a contribution guide for AI agents.",
      "If an AGENTS.md file already exists, focus on additive improvement (preserve intent and useful information; refine, extend, and reorganize as needed) rather than replacing it wholesale.",
      "Inspect the workspace layout, code, documentation and git history to ensure correctness and accuracy.",
      "",
      "Ensure the following preamble exists at the top of the file before any other sections. Do not include the surrounding code fence backticks; only include the text.",
      "",
      "```md",
      "You are an experienced, pragmatic software engineering AI agent. Do not over-engineer a solution when a simple one is possible. Keep edits minimal. If you want an exception to ANY rule, you MUST stop and get permission first.",
      "```",
      "",
      "Recommended sections:",
      "",
      "- Project Overview (mandatory)",
      "  - Basic details about the project (e.g., high-level overview and goals).",
      "  - Technology choices (e.g., languages, databases, frameworks, libraries, build tools).",
      "- Reference (mandatory)",
      "  - List important code files.",
      "  - List important directories and basic code structure tips.",
      "  - Project architecture.",
      "- Essential commands (mandatory)",
      "  - build",
      "  - format",
      "  - lint",
      "  - test",
      "  - clean",
      "  - development server",
      "  - other _important_ scripts (use `find -type f -name '*.sh'` or similar)",
      "- Patterns (optional)",
      "  - List any important or uncommon patterns (compared to other similar codebases), with examples (e.g., how to authorize an HTTP request).",
      "  - List any important workflows and their steps (e.g., how to make a database migration).",
      "  - Testing patterns.",
      "- Anti-patterns (optional)",
      "  - Search git history and comments to find recurring mistakes or forbidden patterns.",
      "  - List each pattern and its reason.",
      "- Code style (optional)",
      "  - Style guide to follow (with link).",
      "- Commit and Pull Request Guidelines (mandatory)",
      "  - Required steps for validating changes before committing.",
      "  - Commit message conventions (read `git log`, or use `type: message` by default).",
      "  - Pull request description requirements.",
      "",
      "You can add other sections if they are necessary.",
      "If the information required for mandatory sections isn't available due to the workspace being empty or sparse, add TODO text in its place.",
      "Optional sections should be scrapped if the information is too thin.",
      "",
      "Some investigation tips:",
      "",
      "- Read existing lint configs, tsconfig, and CI workflows to find any style or layout rules.",
      '- Search for "TODO", "HACK", "FIXME", "don\'t", "never", "always" in comments.',
      "- Examine test files for patterns.",
      "- Read PR templates and issue templates if they exist.",
      "- Check for existing CONTRIBUTING.md, CODE_OF_CONDUCT.md, or similar documentation files.",
      "",
      "Some writing tips:",
      "",
      '- Each "do X" should have a corresponding "don\'t Y" where applicable.',
      "- Commands should be easily copy-pastable and tested.",
      "- Terms or phrases specific to this project should be explained on first use.",
      "- Anything that is against the norm should be explicitly highlighted and called out.",
      "",
      "Above all things:",
      "",
      "- The document must be clear and concise. Simple projects should need less than 400 words, but larger and more mature codebases will likely need 700+. Prioritize completeness over brevity.",
      "- Don't include useless fluff.",
      "- The document must be in Markdown format and use headings for structure.",
      "- Give examples where necessary or helpful (commands, directory paths, naming patterns).",
      "- Explanations and examples must be correct and specific to this codebase.",
      "- Maintain a professional, instructional tone.",
      "",
      "If the workspace is empty or sparse, ask the user for more information. Avoid hallucinating important decisions. You can provide suggestions to the user for language/technology/tool choices, but always respect the user's decision.",
      "",
      "- Project description and goals.",
      "- Language(s).",
      "- Technologies (database?), frameworks, libraries.",
      "- Tools.",
      "- Any other questions as you deem necessary.",
      "",
      "For empty or sparse workspaces ONLY, when finished writing/updating AGENTS.md, ask the user if they would like you to do the following:",
      "",
      "- initialize git IF it's not already set up (e.g., `git init`, `git remote add`, etc.)",
      "- write a concise README.md file",
      "- generate the bare minimum project scaffolding (e.g., initializing the package manager, writing a minimal build tool config)",
      "  </system>",
      "",
    ].join("\n"),
  },
  "mux-docs": {
    "references/docs/AGENTS.md": [
      "---",
      "title: AGENTS.md",
      "description: Agent instructions for AI assistants working on the Mux codebase",
      "---",
      "",
      "**Prime directive:** keep edits minimal and token-efficient—say only what conveys actionable signal.",
      "",
      "## Project Snapshot",
      "",
      "- `mux`: Electron + React desktop app for parallel agent workflows; UX must be fast, responsive, predictable.",
      "- Minor breaking changes are expected, but critical flows must allow upgrade↔downgrade without friction; skip migrations when breakage is tightly scoped.",
      "- **Before creating or updating any PR, commit, or public issue**, you **MUST** read the `pull-requests` skill (`agent_skill_read`) for attribution footer requirements and workflow conventions. Do not skip this step.",
      "",
      "## External Submissions",
      "",
      "- **Do not submit updates to the Terminal-Bench leaderboard repo directly.** Only provide the user with commands they can run themselves.",
      "",
      "## Repo Reference",
      "",
      "- Core files: `src/main.ts`, `src/preload.ts`, `src/App.tsx`, `src/config.ts`.",
      "- Up-to-date model names: see `src/common/knownModels.ts` for current provider model IDs.",
      "- Persistent data: `~/.mux/config.json`, `~/.mux/src/<project>/<branch>` (worktrees), `~/.mux/sessions/<workspace>/chat.jsonl`.",
      "",
      "## Documentation Rules",
      "",
      "- No free-floating Markdown. User docs live in `docs/` (read `docs/README.md`, add pages to `docs.json` navigation, use standard Markdown + mermaid). Developer notes belong inline as comments.",
      "- For planning artifacts, use the `propose_plan` tool or inline comments instead of ad-hoc docs.",
      "- Do not add new root-level docs without explicit request; during feature work rely on code + tests + inline comments.",
      "- External API docs already live inside `/tmp/ai-sdk-docs/**.mdx`; never browse `https://sdk.vercel.ai/docs/ai-sdk-core` directly.",
      "",
      "### Code Comments",
      "",
      "- When delivering a user's request, leave their rationale in the code as comments.",
      '- Generally, prefer code comments that explain the "why" behind a change.',
      '- Still explain the "what" if the code is opaque, surprising, confusing, etc.',
      "",
      "## Key Features & Performance",
      "",
      "- Core UX: projects sidebar (left panel), workspace management (local git worktrees or SSH clones), config stored in `~/.mux/config.json`.",
      "- Fetch bulk data in one IPC call—no O(n) frontend→backend loops.",
      "- **React Compiler enabled** — auto-memoization handles components/hooks; do not add manual `React.memo()`, `useMemo`, or `useCallback` for memoization purposes. Focus instead on fixing unstable object references that the compiler cannot optimize (e.g., `new Set()` in state setters, inline object literals as props).",
      "- **useEffect** — Before adding effects, consult the `react-effects` skill. Most effects for derived state, prop resets, or event-triggered logic are anti-patterns.",
      "",
      "## Tooling & Commands",
      "",
      "- Package manager: bun only. Use `bun install`, `bun add`, `bun run` (which proxies to Make when relevant). Run `bun install` if modules/types go missing.",
      "- Makefile is source of truth (new commands land there, not `package.json`).",
      "- Primary targets: `make dev|start|build|lint|lint-fix|fmt|fmt-check|typecheck|test|test-integration|clean|help`.",
      "- **Codex reviews:** if a PR has Codex review comments, address + resolve them, then re-request review by commenting `@codex review` on the PR. Repeat until `./scripts/check_codex_comments.sh <pr_number>` reports none.",
      "- Full `static-check` includes docs link checking via `mintlify broken-links`.",
      "",
      "## Testing: HistoryService",
      "",
      "HistoryService is pure local disk I/O with a single dependency (`getSessionDir`). **Always use a real instance** via `createTestHistoryService()` (`src/node/services/testHistoryService.ts`) rather than mocking.",
      "",
      "- For pre-seeded data: call `historyService.appendToHistory()` in `beforeEach`",
      '- For error injection: use real instance + `spyOn(historyService, "method").mockRejectedValueOnce(...)`',
      '- For call tracking: `spyOn(historyService, "method")` without `mockImplementation` — real impl runs, calls are recorded',
      "- For assertions: read history back with `getHistoryFromLatestBoundary()` or `getLastMessages()` instead of checking mock calls",
      "",
      "## Refactoring & Runtime Etiquette",
      "",
      "- Use `git mv` to retain history when moving files.",
      "",
      "## Self-Healing & Crash Resilience",
      "",
      "- Prefer **self-healing** behavior: if corrupted or invalid data exists in persisted state (e.g., `chat.jsonl`), the system should sanitize or filter it at load/request time rather than failing permanently.",
      "- Never let a single malformed line in history brick a workspace—apply defensive filtering in request-building paths so the user can continue working.",
      "- When streaming crashes, any incomplete state committed to disk should either be repairable on next load or excluded from provider requests to avoid API validation errors.",
      "- **Startup-time initialization must never crash the app.** Wrap in try-catch, use timeouts, fall back silently.",
      "",
      "## Command Palette & UI Access",
      "",
      "- Open palette with `Cmd+Shift+P` (mac) / `Ctrl+Shift+P` (win/linux); quick toggle via `Cmd+P` / `Ctrl+P`.",
      "- Palette covers workspace mgmt, navigation, chat utils, mode/model switches, slash commands (`/` for suggestions, `>` for actions).",
      "",
      "## Styling",
      "",
      "- Never use emoji characters as UI icons or status indicators; emoji rendering varies across platforms and fonts.",
      "- Prefer SVG icons (usually from `lucide-react`) or shared icon components under `src/browser/components/icons/`.",
      "- For tool call headers, use `ToolIcon` from `src/browser/components/tools/shared/ToolPrimitives.tsx`.",
      "- If a tool/agent provides an emoji string (e.g., `status_set` or `displayStatus`), render via `EmojiIcon` (`src/browser/components/icons/EmojiIcon.tsx`) instead of rendering the emoji.",
      "- If a new emoji appears in tool output, extend `EmojiIcon` to map it to an SVG icon.",
      "- Colors defined in `src/browser/styles/globals.css` (`:root @theme` block). Reference via CSS variables (e.g., `var(--color-plan-mode)`), never hardcode hex values.",
      "",
      "## TypeScript Discipline",
      "",
      "- Ban `as any`; rely on discriminated unions, type guards, or authored interfaces.",
      "- Use `Record<Enum, Value>` for exhaustive mappings to catch missing cases.",
      "- Apply utility types (`Omit`, `Pick`, etc.) to build UI-specific variants of backend types, preventing unnecessary re-renders and clarifying intent.",
      "- Let types drive design: prefer discriminated unions for state, minimize runtime checks, and simplify when types feel unwieldy.",
      "- Use `using` declarations (or equivalent disposables) for processes, file handles, etc., to ensure cleanup even on errors.",
      "- Centralize magic constants under `src/constants/`; share them instead of duplicating values across layers.",
      "- Never repeat constant values (like keybinds) in comments—they become stale when the constant changes.",
      "- **Avoid `void asyncFn()`** - fire-and-forget async calls hide race conditions. When state is observable by other code (in-memory cache, event emitters), ensure visibility order matches invariants. If memory and disk must stay in sync, persist before updating memory so observers see consistent state.",
      "- **Avoid `setTimeout` for component coordination** - racy and fragile; use callbacks or effects.",
      "- **Keyboard event propagation** - React's `e.stopPropagation()` only stops synthetic event bubbling; native `window` listeners still fire. Use `stopKeyboardPropagation(e)` from `@/browser/utils/events` to stop both React and native propagation when blocking global handlers (like stream interrupt on Escape).",
      "",
      "",
      "## Tool Schema Conventions",
      "",
      "- **Use `.nullish()` for optional tool input parameters** — never `.optional()` alone. OpenAI's Responses API normalizes tool schemas into strict mode, which forces every field into `required` and expects optional fields to accept `null`. `.nullish()` (= `.optional().nullable()`) satisfies strict-mode providers (OpenAI) while remaining compatible with non-strict providers (Anthropic, Google). See the module doc comment in `src/common/utils/tools/toolDefinitions.ts` for details.",
      '- Implementation handlers should use `!= null` (loose equality) instead of `!== undefined` to treat both `null` and `undefined` as "not provided".',
      "- This applies only to tool **input** schemas (parameters the model provides), not to tool **output/result** schemas (constructed by our backend).",
      "",
      "## Component State & Storage",
      "",
      "- Prefer **self-contained components** over utility functions + hook proliferation. A component that takes `workspaceId` and computes everything internally is better than one that requires 10 props drilled from parent hooks.",
      "- **Colocate subscriptions with consumers** — Don't pass frequently-updating values (streaming stats, live costs, timers) as props through intermediate components. Instead, have the leaf component that displays the value subscribe directly. This prevents re-renders from cascading through expensive sibling subtrees (e.g., terminal). See `CostsTabLabel`/`StatsTabLabel` for examples.",
      "- Parent components own localStorage interactions; children announce intent only.",
      "- **Never call `localStorage` directly** — always use `usePersistedState`/`readPersistedState`/`updatePersistedState` helpers. This includes inside `useCallback`, event handlers, and non-React functions. The helpers handle JSON parsing, error recovery, and cross-component sync.",
      "- When a component needs to read persisted state it doesn't own (to avoid layout flash), use `readPersistedState` in `useState` initializer: `useState(() => readPersistedState(key, default))`.",
      "- When multiple components need the same persisted value, use `usePersistedState` with identical keys and `{ listener: true }` for automatic cross-component sync.",
      "- Avoid destructuring props in function signatures; access via `props.field` to keep rename-friendly code.",
      "",
      "## Module Imports",
      "",
      "- Use static `import` statements at the top; resolve circular dependencies by extracting shared modules, inverting dependencies, or using DI. Dynamic `await import()` is not an acceptable workaround.",
      "",
      "## Workspace Identity",
      "",
      "- Frontend must never synthesize workspace IDs (e.g., `${project}-${branch}` is forbidden). Backend operations that change IDs must return the value; always consume that response.",
      "",
      "## IPC",
      "",
      "### Typing",
      "",
      "1. IPC methods return backend types (`WorkspaceMetadata`, etc.), not ad-hoc objects.",
      "2. Frontend may extend backend types with UI context (projectPath, branch, etc.).",
      "3. Frontend constructs UI shapes from backend responses plus existing context (e.g., recommended trunk branch).",
      "4. Never duplicate type definitions around the boundary—import shared types instead.",
      "",
      "**Why:** single source of truth, clean separation, automatic propagation of backend changes, and no duplicate schemas.",
      "",
      "### Compatibility",
      "",
      "It is safe to assume that the frontend and backend of the IPC are always in sync.",
      "Freely make breaking changes, and reorganize / cleanup IPC as needed.",
      "",
      "## Debugging & Diagnostics",
      "",
      "- `bun run debug ui-messages --workspace <name>` to inspect messages; add `--drop <n>` to skip recent entries. Workspace names live in `~/.mux/sessions/`.",
      "",
      "## UX Guardrails",
      "",
      "- Do not add UX flourishes (auto-dismiss, animations, tooltips, etc.) unless requested. Ship the simplest behavior that meets requirements.",
      "- Enforce DRY: if you repeat code/strings, factor a shared helper/constant (search first; if cross-layer, move to `src/constants/` or `src/types/`).",
      "- Hooks that detect a condition should handle it directly when they already have the data—avoid unnecessary callback hop chains.",
      "- Every operation must have a keyboard shortcut, and UI controls with shortcuts should surface them in hover tooltips.",
      "",
      "## Logging",
      "",
      "- Use the `log` helper (`log.debug` for noisy output) for backend logging.",
      "",
      "## Bug-Fixing Mindset",
      "",
      "- Avoid timing-based coordination (e.g., sleep/grace timers) when deterministic signals exist; prefer awaiting explicit completion/exit signals.",
      "- When asked to reduce LoC, focus on simplifying production logic—not stripping comments, docs, or tests.",
      "",
      "## UI Component Testability (tests/ui)",
      "",
      "- **Radix Popover portals don't work in happy-dom** — content renders to `document.body` via portal but happy-dom doesn't support this properly. Popover content won't appear in tests.",
      "- **Use conditional rendering for testability:** Components like `AgentModePicker` use `{isOpen && <div>...}` instead of Radix Portal. This renders inline and works in happy-dom.",
      "- When adding new dropdown/popover components that need tests/ui coverage, prefer the conditional rendering pattern over Radix Portal.",
      "- E2E tests (tests/e2e) work with Radix but are slow (~2min startup); reserve for scenarios that truly need real Electron.",
      "- Only use `validateApiKeys()` in tests that actually make AI API calls.",
      "",
      "## Tool: status_set",
      "",
      "- Set status url to the Pull Request once opened",
      "",
      "## GitHub",
      "",
      "Many tasks involve reading and writing from GitHub, prefer the `gh` CLI over web search and manual curl requests when helping the User.",
      "",
    ].join("\n"),
    "references/docs/agents/agent-skills.mdx": [
      "---",
      "title: Agent Skills",
      "description: Share reusable workflows and references with skills",
      "---",
      "",
      "## Overview",
      "",
      "Agent Skills are reusable, file-based “playbooks” that you can share across projects or keep workspace-local.",
      "",
      "Mux follows the Agent Skills specification and exposes skills to models in two steps:",
      "",
      "1. **Index in the system prompt**: Mux lists available skills (name + description).",
      "2. **Tool-based loading**: the agent calls tools to load a full skill when needed.",
      "",
      "Skills help you practice progressive disclosure, where the LLM sees only the necessary context to complete",
      "the task at hand.",
      "",
      "The easiest way to invoke a skill in Mux is to use the `/<skill-name>` slash command. For example:",
      "`/mux-docs suggest tool hooks for this project`.",
      "",
      "You can find a list of community-maintained, curated skills at [skills.sh](https://skills.sh/).",
      "",
      "You can easily add those skills to your Mux instance with:",
      "",
      "```bash",
      "npx skills add https://github.com/anthropics/skills --skill frontend-design",
      "```",
      "",
      "## Where skills live",
      "",
      "Mux discovers skills from three roots:",
      "",
      "- **Workspace-local**: `.mux/skills/<skill-name>/SKILL.md` (in the workspace working directory)",
      "- **Global**: `~/.mux/skills/<skill-name>/SKILL.md`",
      "- **Built-in**: shipped with Mux",
      "",
      "If a skill exists in multiple locations, the precedence order is: **workspace-local > global > built-in**.",
      "",
      "<Info>",
      "  Mux reads skills using the active workspace runtime. For SSH workspaces, skills are read from the",
      "  remote host.",
      "</Info>",
      "",
      "## Skill layout",
      "",
      "A skill is a directory named after the skill:",
      "",
      "```text",
      ".mux/skills/",
      "  my-skill/",
      "    SKILL.md",
      "    references/",
      "      ...",
      "```",
      "",
      "Skill directory names must match `^[a-z0-9]+(?:-[a-z0-9]+)*$` (1–64 chars).",
      "",
      "## `SKILL.md` format",
      "",
      "`SKILL.md` must start with YAML frontmatter delimited by `---` on its own line.",
      "Mux enforces a 1MB maximum file size for `SKILL.md`.",
      "",
      "Required fields:",
      "",
      "- `name`: must match the directory name",
      "- `description`: short summary shown in Mux’s skills index",
      "",
      "Optional fields:",
      "",
      "- `license`",
      "- `compatibility`",
      "- `metadata` (string key/value map)",
      "- `advertise` (boolean) — set to `false` to omit a skill from the system prompt index (see [Unadvertised skills](#unadvertised-skills) below)",
      "",
      "Mux ignores unknown frontmatter keys (for example `allowed-tools`).",
      "",
      "## Unadvertised skills",
      "",
      "By default, Mux _advertises_ skills by listing them in the system prompt’s `<agent-skills>` index.",
      "",
      "Set `advertise: false` in the frontmatter to exclude a skill from that index. Unadvertised skills:",
      "",
      "- **Are not listed** in the system prompt (reducing token overhead)",
      '- **Can still be invoked** via `/{skill-name}` slash command or `agent_skill_read({ name: "skill-name" })`',
      "- **Still appear** in Mux’s UI lists (for example `/` slash suggestions)",
      "- **Are useful for**: skills meant only for sub-agents, advanced users, or internal orchestration",
      "",
      "### Example: `deep-review` skill",
      "",
      "The Mux repository includes an unadvertised `deep-review` skill that encourages aggressive use of sub-agents to produce excellent code reviews (correctness, tests, consistency, UX, performance). Invoke it with `/deep-review` when you want a thorough, parallelized review. This skill is defined in `.mux/skills/deep-review/SKILL.md`.",
      "",
      "{/* BEGIN DEEP_REVIEW_SKILL */}",
      "",
      "```md",
      "---",
      "name: deep-review",
      "description: Sub-agent powered code reviews spanning correctness, tests, consistency, and fit",
      "advertise: false",
      "---",
      "",
      "# Deep Review Mode",
      "",
      "Provide an **excellent code review** by defaulting to **parallelism**.",
      "",
      "You should use sub-agents to review the change from multiple angles (correctness, tests, consistency, UX, performance, safety). Each sub-agent should have a focused mandate and return actionable findings with file paths.",
      "",
      "## Step 0: Establish the review surface",
      "",
      "Before reviewing, gather context:",
      "",
      "- Identify the change scope: `git diff --name-only` (or the file list the user provides).",
      "- Skim the diff for intent and risk: `git diff`.",
      "- Note which layers are touched:",
      "  - UI (React/components/styles)",
      "  - Main process / backend services",
      "  - IPC boundary / shared types",
      "  - Tooling/scripts",
      "  - Docs",
      "  - Tests",
      "",
      "If the change is large, split review by module and prioritize **high-risk** paths.",
      "",
      "## Spawn the right sub-agents (change-type aware)",
      "",
      "Spawn **2–5** sub-agents depending on scope. Tailor them to the change.",
      "",
      "### Suggested sub-agent set",
      "",
      "- **Correctness & edge cases** (always)",
      "  - Goal: find logic bugs, missing error handling, race conditions, broken invariants.",
      "- **Tests & verification** (always)",
      "  - Goal: evaluate test coverage, propose missing tests, suggest commands to validate.",
      "- **Consistency & architecture** (usually)",
      "  - Goal: ensure changes match existing patterns, abstractions, and boundaries.",
      "- **UX & accessibility** (when UI changed)",
      "  - Goal: keyboard flows, a11y, visual consistency, empty/loading/error states.",
      "- **Performance & reliability** (when hot paths / streaming / IO changed)",
      "  - Goal: latency, unnecessary work, blocking calls, memory growth, resilience.",
      "- **Docs & developer experience** (when docs/scripts/public API changed)",
      "  - Goal: clarity, correctness, navigation updates, link integrity.",
      "",
      "## Synthesize into a single excellent review",
      "",
      "When sub-agent results arrive, produce a consolidated review with:",
      "",
      "1. **Summary** (what changed + overall risk)",
      "2. **Issues**",
      "3. **Questions** (unknown intent; ask for clarification)",
      "4. **Suggested validation plan** (commands + manual checks)",
      "",
      "Issues should have a severity in form of:",
      "",
      "| Severity | Description                              | Example                                                                                       |",
      "| -------- | ---------------------------------------- | --------------------------------------------------------------------------------------------- |",
      "| P0       | Change must not be merged until resolved | Change would permanently break core workflows if merged.                                      |",
      "| P1       | Change should not be merged              | New code will not work as expected due to severe bugs                                         |",
      "| P2       | Consideration required before merging    | The change creates inconsistency / fragility                                                  |",
      "| P3       | Minor issue                              | The change introduces a minor issue that may be addressed later                               |",
      "| P4       | Long-term issue                          | The change raises concerns about long-term maintainability or may break under rare conditions |",
      "",
      "### Review rubric",
      "",
      "Use this rubric to avoid blind spots:",
      "",
      "- **Correctness**: invariants, edge cases, error handling, races",
      "- **Fitness**: does it meet the user goal, and does it match product constraints?",
      "- **Tests**: coverage of new logic, regression tests, deterministic behavior",
      "- **Consistency**: patterns, naming, types, boundaries, IPC typing",
      "- **Maintainability**: complexity, duplication, readability",
      "- **Performance**: hot paths, streaming, excessive re-renders/IO",
      "- **Safety**: secrets, path traversal, injection risks, filesystem safety",
      "- **DX**: logs, error messages, debuggability",
      "",
      "## Anti-patterns",
      "",
      "- **Single-threaded review** of a large change (spawn sub-agents).",
      "- **Vague feedback** (“looks good”) without actionable items and file paths.",
      "- **Non-verifiable suggestions** (always include a validation plan).",
      "- **Scope creep** disguised as review (focus on minimal changes unless risk demands more).",
      "```",
      "",
      "{/* END DEEP_REVIEW_SKILL */}",
      "",
      "## Current limitations",
      "",
      "- Slash command invocation supports only a single skill as the first token (for example `/{skill-name}` or `/{skill-name} ...`).",
      "- Skill bodies may be truncated when injected to avoid accidental mega-prompts.",
      "- `allowed-tools` is not enforced by Mux (it is tolerated in frontmatter, but ignored).",
      "",
      "## Further reading",
      "",
      "- [Agent Skills overview](https://agentskills.io/home)",
      "- [What are skills?](https://agentskills.io/what-are-skills) (progressive disclosure)",
      "- [Agent Skills specification](https://agentskills.io/specification)",
      "  - [Directory structure](https://agentskills.io/specification#directory-structure)",
      "  - [`SKILL.md` format](https://agentskills.io/specification#skill-md-format)",
      "  - [Frontmatter fields](https://agentskills.io/specification#frontmatter-required)",
      "  - [Optional directories](https://agentskills.io/specification#optional-directories)",
      "  - [Progressive disclosure](https://agentskills.io/specification#progressive-disclosure)",
      "- [Integrate skills into your agent](https://agentskills.io/integrate-skills) (tool-based vs filesystem-based)",
      "- [Example skills (GitHub)](https://github.com/anthropics/skills)",
      "- [skills-ref validation library (GitHub)](https://github.com/agentskills/agentskills/tree/main/skills-ref)",
      "",
      "```",
      "",
      "```",
      "",
    ].join("\n"),
    "references/docs/agents/index.mdx": [
      "---",
      "title: Agents",
      "description: Define custom agents (modes + subagents) with Markdown files",
      "---",
      "",
      "## Overview",
      "",
      "Mux uses **agents** to control the model's:",
      "",
      '- **System prompt** (what the assistant "is")',
      "- **Tool access policy** (which tools it can call)",
      "",
      "This unifies two older concepts:",
      "",
      "- **UI modes** (Plan/Exec/Compact)",
      "- **Subagents** (the presets used by the `task` tool)",
      "",
      "An **Agent Definition** is a Markdown file:",
      "",
      "- The **YAML frontmatter** defines metadata + policy.",
      "- The **Markdown body** becomes the agent's system prompt (layered with Mux's base prelude).",
      "",
      "## Quick Start",
      "",
      "**Switch agents:** Press `Cmd+Shift+M` (Mac) or `Ctrl+Shift+M` (Windows/Linux), or use the agent selector in the chat input.",
      "",
      "**Create a custom agent:** Add a markdown file with YAML frontmatter to `.mux/agents/` in your project:",
      "",
      "```md",
      "---",
      "name: Review",
      "description: Terse reviewer-style feedback",
      "base: exec",
      "tools:",
      "  # Remove editing tools from exec base (this is a read-only reviewer)",
      "  remove:",
      "    - file_edit_.*",
      "    - task",
      "    - task_.*",
      "---",
      "",
      "You are a code reviewer.",
      "",
      "- Focus on correctness, risks, and test coverage.",
      "- Prefer short, actionable comments.",
      "```",
      "",
      "## Discovery + Precedence",
      "",
      "Mux discovers agent definitions from (non-recursive):",
      "",
      "| Location             | Scope   | Priority |",
      "| -------------------- | ------- | -------- |",
      "| `.mux/agents/*.md`   | Project | Highest  |",
      "| `~/.mux/agents/*.md` | Global  | Medium   |",
      "| Built-in             | System  | Lowest   |",
      "",
      "Higher-priority definitions override lower-priority ones with the same **agent id**.",
      "",
      "### Agent IDs",
      "",
      "The **agent id** is derived from the filename:",
      "",
      '- `review.md` → `agentId = "review"`',
      "",
      "Agent ids are lowercase and should be simple (letters/numbers with `-`/`_`).",
      "",
      "## File Format",
      "",
      "### Frontmatter Schema",
      "",
      "```yaml",
      "---",
      "# Required",
      "name: My Agent # Display name in UI",
      "",
      "# Optional",
      "description: What this agent does # Shown in tooltips",
      "base: exec # Inherit from another agent (exec, plan, or custom agent id)",
      "",
      "# UI settings",
      "ui:",
      "  hidden: false # Set true to hide from agent selector",
      "  disabled: false # Set true to completely disable (useful to hide built-ins)",
      '  color: "#6b5bff" # UI accent color (inherited from base if not set)',
      "",
      "# Prompt behavior",
      "prompt:",
      "  append: true # Append body to base agent's body (default); set false to replace",
      "",
      "# Subagent configuration",
      "subagent:",
      "  runnable: false # Allow spawning via task({ agentId: ... })",
      "  skip_init_hook: false # When true, skip the project's .mux/init hook for this sub-agent",
      "",
      "# AI defaults (override user settings)",
      "ai:",
      '  model: sonnet # Or full ID like "anthropic:claude-sonnet-4-5"',
      "  thinkingLevel: medium",
      "",
      "# Tool configuration (regex patterns, processed in order during inheritance)",
      "tools:",
      "  add: # Patterns to add/enable",
      "    - file_read",
      "    - file_edit_.*",
      "    - bash",
      "  remove: # Patterns to remove/disable (applied after add)",
      "    - task_.*",
      "---",
      "```",
      "",
      "### Markdown Body (Instructions)",
      "",
      "The markdown body after the frontmatter becomes the agent's system prompt, layered with Mux's base prelude.",
      "",
      "**Inheritance behavior:** By default, when an agent has a `base`, the child's body is **appended** to the base agent's body. Set `prompt.append: false` to **replace** the base body entirely—useful when you want to completely override the base agent's instructions while keeping its tool policies or AI defaults.",
      "",
      "## Disabling Built-in Agents",
      "",
      "To hide a built-in agent, create a file with the same name and `ui.disabled: true`:",
      "",
      "```md",
      "---",
      "name: Plan",
      "ui:",
      "  disabled: true",
      "---",
      "```",
      "",
      "This completely removes the agent from discovery. To override (replace) a built-in instead, omit `disabled` and provide your own configuration.",
      "",
      "## Extending Built-in Agents",
      "",
      "You can extend a built-in agent by creating a file with the **same name** and using `base` to inherit from it:",
      "",
      "```md",
      "---",
      "name: Exec",
      "base: exec",
      "---",
      "",
      "Additional project-specific instructions that append to built-in exec.",
      "```",
      "",
      "This works because when resolving `base: exec`, Mux skips the current scope (project) and looks for `exec` in lower-priority scopes (global, then built-in). Your project-local `exec.md` extends the built-in exec, not itself.",
      "",
      "**Common pattern:** Add repo-specific guidance (CI commands, test patterns) without duplicating the built-in instructions.",
      "",
      "## Tool Policy Semantics",
      "",
      "Tools are controlled via an explicit **whitelist**. The `tools` array lists patterns (exact names or regex) that the agent can use. If `tools` is omitted or empty, no tools are available.",
      "",
      "**Inheritance:** Use `base` to inherit behavior from another agent:",
      "",
      "- `base: plan` — Plan-mode behaviors (enables `ask_user_question`, `propose_plan`)",
      "- `base: exec` — Exec-mode behaviors (standard coding workflow)",
      "- `base: <custom-agent-id>` — Inherit from any custom agent",
      "",
      "Inheritance is multi-level: if `my-agent` has `base: plan`, agents inheriting from `my-agent` also get plan-like behavior.",
      "",
      "**Hard denies in subagents:** Even if an agent definition allows them, Mux blocks these tools in child workspaces:",
      "",
      "- `task`, `task_await`, `task_list`, `task_terminate` (no recursive spawning)",
      "- `propose_plan`, `ask_user_question` (UI-only tools)",
      "",
      "## Using Agents",
      "",
      "### Main Agent",
      "",
      "Use the agent selector in the chat input to switch agents.",
      "",
      "Keyboard: `Cmd+Shift+M` (mac) / `Ctrl+Shift+M` (win/linux) cycles between agents.",
      "",
      "### Subagents (task tool)",
      "",
      "Spawn a subagent workspace with:",
      "",
      "```ts",
      "task({",
      '  agentId: "explore",',
      '  title: "Find the callsites",',
      '  prompt: "Locate where X is computed and report back",',
      "});",
      "```",
      "",
      "Only agents with `subagent.runnable: true` can be used this way.",
      "",
      "## Examples",
      "",
      "### Security Audit Agent",
      "",
      "```md",
      "---",
      "name: Security Audit",
      "description: Security-focused code review",
      "base: exec",
      "tools:",
      "  # Remove editing/task tools - this is read-only analysis",
      "  remove:",
      "    - file_edit_.*",
      "    - task",
      "    - task_.*",
      "---",
      "",
      "You are a security auditor. Analyze the codebase for:",
      "",
      "- Authentication/authorization issues",
      "- Injection vulnerabilities",
      "- Data exposure risks",
      "- Insecure dependencies",
      "",
      "Provide a structured report with severity levels. Do not make changes.",
      "```",
      "",
      "### Documentation Agent",
      "",
      "```md",
      "---",
      "name: Docs",
      "description: Focus on documentation tasks",
      "base: exec",
      "tools:",
      "  # Remove task delegation - keep it simple for doc tasks",
      "  remove:",
      "    - task",
      "    - task_.*",
      "---",
      "",
      "You are in Documentation mode. Focus on improving documentation:",
      "README files, code comments, API docs, and guides. Avoid",
      "refactoring code unless it's purely for documentation purposes.",
      "```",
      "",
      "## Built-in Agents",
      "",
      "{/* BEGIN BUILTIN_AGENTS */}",
      "",
      "### Ask",
      "",
      "**Delegate questions to Explore sub-agents and synthesize an answer.**",
      "",
      '<Accordion title="View ask.md">',
      "",
      "```md",
      "---",
      "name: Ask",
      "description: Delegate questions to Explore sub-agents and synthesize an answer.",
      "base: exec",
      "ui:",
      "  color: var(--color-ask-mode)",
      "subagent:",
      "  runnable: false",
      "tools:",
      "  # Inherits all tools from exec, then removes editing tools",
      "  remove:",
      "    # Read-only: no file modifications",
      "    - file_edit_.*",
      "---",
      "",
      "You are **Ask**.",
      "",
      "Your job is to answer the user's question by delegating research to sub-agents (typically **Explore**), then synthesizing a concise, actionable response.",
      "",
      "## When to delegate",
      "",
      "- Delegate when the question requires repository exploration, multiple viewpoints, or verification.",
      "- If the answer is obvious and does not require looking anything up, answer directly.",
      "",
      "## Delegation workflow",
      "",
      "1. Break the question into **1–3** focused research threads.",
      "2. Spawn Explore sub-agents in parallel using the `task` tool:",
      '   - `agentId: "explore"` (or `subagent_type: "explore"`)',
      '   - Use clear titles like `"Ask: find callsites"`, `"Ask: summarize behavior"`, etc.',
      "   - Ask for concrete outputs: file paths, symbols, commands to reproduce, and short excerpts.",
      "3. Wait for results (use `task_await` if you launched tasks in the background).",
      "4. Synthesize:",
      "   - Provide the final answer first.",
      "   - Then include supporting details (paths, commands, edge cases).",
      "   - Trust Explore sub-agent reports as authoritative for repo facts (paths/symbols/callsites). Do not redo the same investigation yourself; only re-check if the report is ambiguous or contradicts other evidence.",
      "",
      "## Safety rules",
      "",
      "- Do **not** modify repository files.",
      '- Prefer `agentId: "explore"`. Only use `"exec"` if the user explicitly asks to implement changes.',
      "```",
      "",
      "</Accordion>",
      "",
      "### Exec",
      "",
      "**Implement changes in the repository**",
      "",
      '<Accordion title="View exec.md">',
      "",
      "```md",
      "---",
      "name: Exec",
      "description: Implement changes in the repository",
      "ui:",
      "  color: var(--color-exec-mode)",
      "subagent:",
      "  runnable: true",
      "  append_prompt: |",
      "    You are running as a sub-agent in a child workspace.",
      "",
      "    - Take a single narrowly scoped task and complete it end-to-end. Do not expand scope.",
      "    - Preserve your context window: treat `explore` tasks as a context-saving repo scout for discovery (file locations, callsites, tests, config points, high-level flows).",
      "      If you need repo context, spawn 1–N `explore` tasks (read-only) to scan the codebase and return paths + symbols + minimal excerpts.",
      '      Then open/read only the returned files; avoid broad manual file-reading, and write a short internal "mini-plan" before editing.',
      "      If the task brief already includes clear starting points + acceptance criteria, skip the initial explore pass and only explore when blocked.",
      "      Prefer 1–3 narrow `explore` tasks (possibly in parallel).",
      "    - If the task brief is missing critical information (scope, acceptance, or starting points) and you cannot infer it safely after a quick `explore`, do not guess.",
      "      Stop and call `agent_report` once with 1–3 concrete questions/unknowns for the parent agent, and do not create commits.",
      "    - Run targeted verification and create one or more git commits.",
      "    - **Before your stream ends, you MUST call `agent_report` exactly once with:**",
      "      - What changed (paths / key details)",
      "      - What you ran (tests, typecheck, lint)",
      "      - Any follow-ups / risks",
      "      (If you forget, the parent will inject a follow-up message and you'll waste tokens.)",
      "    - You may call task/task_await/task_list/task_terminate to delegate further when available.",
      "      Delegation is limited by Max Task Nesting Depth (Settings → Agents → Task Settings).",
      "    - Do not call propose_plan.",
      "tools:",
      "  add:",
      "    # Allow all tools by default (includes MCP tools which have dynamic names)",
      "    # Use tools.remove in child agents to restrict specific tools",
      "    - .*",
      "  remove:",
      "    # Exec mode doesn't use planning tools",
      "    - propose_plan",
      "    - ask_user_question",
      "    # Internal-only tools",
      "    - system1_keep_ranges",
      "---",
      "",
      "You are in Exec mode.",
      "",
      "- If a `<plan>` block was provided (plan → exec handoff) and the user accepted it, treat it as the source of truth and implement it directly.",
      "  Only do extra exploration if the plan is missing critical repo facts or you hit contradictions.",
      "- Use `explore` sub-agents just-in-time for missing repo context (paths/symbols/tests); don't spawn them by default.",
      "- Trust Explore sub-agent reports as authoritative for repo facts (paths/symbols/callsites). Do not redo the same investigation yourself; only re-check if the report is ambiguous or contradicts other evidence.",
      "- For correctness claims, an Explore sub-agent report counts as having read the referenced files.",
      "- Make minimal, correct, reviewable changes that match existing codebase patterns.",
      "- Prefer targeted commands and checks (typecheck/tests) when feasible.",
      "- Treat as a standing order: keep running checks and addressing failures until they pass or a blocker outside your control arises.",
      "```",
      "",
      "</Accordion>",
      "",
      "### Orchestrator",
      "",
      "**Coordinate sub-agent implementation and apply patches**",
      "",
      '<Accordion title="View orchestrator.md">',
      "",
      "```md",
      "---",
      "name: Orchestrator",
      "description: Coordinate sub-agent implementation and apply patches",
      "base: exec",
      "ui:",
      "  requires:",
      "    - plan",
      "subagent:",
      "  runnable: false",
      "tools:",
      "  add:",
      "    - ask_user_question",
      "  remove:",
      "    - propose_plan",
      "---",
      "",
      "You are an internal Orchestrator agent running in Exec mode.",
      "",
      "**Mission:** coordinate implementation by delegating investigation + coding to sub-agents, then integrating their patches into this workspace.",
      "",
      "When a plan is present (default):",
      "",
      "- Treat the accepted plan as the source of truth. Its file paths, symbols, and structure were validated during planning — do not routinely spawn `explore` to re-confirm them. Exception: if the plan references stale paths or appears to have been authored/edited by the user without planner validation, a single targeted `explore` to sanity-check critical paths is acceptable.",
      "- Spawning `explore` to gather _additional_ context beyond what the plan provides is encouraged (e.g., checking whether a helper already exists, locating test files not mentioned in the plan, discovering existing patterns to match). This produces better `exec` task briefs.",
      "- Do not spawn `explore` just to verify that a planner-generated plan is correct — that is the planner's job, and the plan was accepted by the user.",
      "- Convert the plan into concrete `exec` subtasks and start delegation.",
      "",
      "What you are allowed to do directly in this workspace:",
      "",
      "- Spawn/await/manage sub-agent tasks (`task`, `task_await`, `task_list`, `task_terminate`).",
      "- Apply patches (`task_apply_git_patch`).",
      "- Resolve _small_ patch-apply conflicts locally (delegate large/confusing conflicts).",
      "- Coordinate targeted verification after integrating patches (prefer delegating verification runs to `explore` to keep this agent focused on coordination).",
      "",
      "Hard rules (delegate-first):",
      "",
      "- Trust `explore` sub-agent reports as authoritative for repo facts (paths/symbols/callsites). Do not redo the same investigation yourself; only re-check if the report is ambiguous or contradicts other evidence.",
      "- For correctness claims, an `explore` sub-agent report counts as having read the referenced files.",
      "- **Do not do broad repo investigation here.** If you need context, spawn an `explore` sub-agent with a narrow prompt (keeps this agent focused on coordination).",
      "- **Do not implement features/bugfixes directly here.** Spawn an `exec` sub-agent and have it complete the work end-to-end.",
      "- **Never read or scan session storage.** This includes `~/.mux/sessions/**` and `~/.mux/sessions/subagent-patches/**`. Treat session storage as an internal implementation detail; do not shell out to locate patch artifacts on disk. Only use `task_apply_git_patch` to access patches.",
      "",
      "Delegation guide:",
      "",
      '- Use `explore` for narrowly-scoped read-only questions (confirm an assumption, locate a symbol/callsite, find relevant tests). Avoid "scan the repo" prompts.',
      "- Use `exec` for code changes.",
      "  - Provide a compact task brief (so the sub-agent can act without reading the full plan) with:",
      "    - Task: one sentence",
      "    - Background (why this matters): 1–3 bullets",
      "    - Scope / non-goals: what to change, and what not to change",
      "    - Starting points: relevant files/symbols/paths (from prior exploration)",
      "    - Acceptance: bullets / checks",
      "    - Deliverables: commits + verification commands to run",
      "    - Constraints:",
      "      - Do not expand scope.",
      "      - Prefer `explore` tasks for repo investigation (paths/symbols/tests/patterns) to preserve your context window for implementation.",
      "        Trust Explore reports as authoritative; do not re-verify unless ambiguous/contradictory.",
      "        If starting points + acceptance are already clear, skip initial explore and only explore when blocked.",
      "      - Create one or more git commits before `agent_report`.",
      "",
      "Recommended Orchestrator → Exec task brief template:",
      "",
      "- Task: <one sentence>",
      "- Background (why this matters):",
      "  - <bullet>",
      "- Scope / non-goals:",
      "  - Scope: <what to change>",
      "  - Non-goals: <explicitly out of scope>",
      "- Starting points: <paths / symbols / callsites>",
      "- Dependencies / assumptions:",
      "  - Assumes: <prereq patch(es) already applied in parent workspace, or required files/targets already exist>",
      "  - If unmet: stop and report back; do not expand scope to create prerequisites.",
      "- Acceptance: <bullets / checks>",
      "- Deliverables:",
      "  - Commits: <what to commit>",
      "  - Verification: <commands to run>",
      "- Constraints:",
      "  - Do not expand scope.",
      "  - Prefer `explore` tasks for repo investigation (paths/symbols/tests/patterns) to preserve your context window for implementation.",
      "    Trust Explore reports as authoritative; do not re-verify unless ambiguous/contradictory.",
      "    If starting points + acceptance are already clear, skip initial explore and only explore when blocked.",
      "  - Create one or more git commits before `agent_report`.",
      "",
      "Dependency analysis (required before spawning `exec` tasks):",
      "",
      "- For each candidate subtask, write:",
      "  - Outputs: files/targets/artifacts introduced/renamed/generated",
      "  - Inputs / prerequisites (including for verification): what must already exist",
      '- A subtask is "independent" only if its patch can be applied + verified on the current parent workspace HEAD, without any other pending patch.',
      "- Parallelism is the default: maximize the size of each independent batch and run it in parallel.",
      "  Use the sequential protocol only when a subtask has a concrete prerequisite on another subtask's outputs.",
      "- If task B depends on outputs from task A:",
      "  - Do not spawn B until A has completed and A's patch is applied in the parent workspace.",
      "  - If the dependency chain is tight (download → generate → wire-up), prefer one `exec` task rather than splitting.",
      "",
      "Example dependency chain (schema download → generation):",
      "",
      "- Task A outputs: a new download target + new schema files.",
      "- Task B inputs: those schema files; verifies by running generation.",
      "- Therefore: run Task A (await + apply patch) before spawning Task B.",
      "",
      "Patch integration loop (default):",
      "",
      "1. Identify a batch of independent subtasks.",
      "2. Spawn one `exec` sub-agent task per subtask with `run_in_background: true`.",
      "3. Await the batch via `task_await`.",
      "4. For each successful `exec` task:",
      "   - Dry-run apply: `task_apply_git_patch` with `dry_run: true`.",
      "   - If dry-run succeeds, apply for real: `task_apply_git_patch` with `dry_run: false`.",
      "   - If dry-run fails, treat it as a patch conflict. Choose one:",
      "     - **Resolve locally (small/obvious conflicts only):**",
      "       1. Apply for real: `task_apply_git_patch` with `dry_run: false` (this may fail but will leave the repo in a `git am` conflict state).",
      "       2. Inspect with `git status` / `git diff`.",
      "       3. Resolve conflicts, then `git add -A`.",
      "       4. Finish with `git am --continue`.",
      "       5. If messy/unclear, abort and delegate: `git am --abort`.",
      "     - **Delegate reconciliation (preferred for large/confusing conflicts):**",
      "       - Spawn a dedicated `exec` task that replays the patch via `task_apply_git_patch`, resolves conflicts in its own workspace, commits the resolved result, and reports back with a new patch to apply cleanly.",
      "5. Verify + review:",
      "   - Spawn a narrow `explore` task to sanity-check the diff and run verification (`make fmt-check`, `make lint`, `make typecheck`, `make test`, etc.).",
      "   - PASS: summary-only (no long logs).",
      "   - FAIL: include the failing command + key error lines; then delegate a fix to `exec` and re-verify.",
      "",
      "Sequential protocol (only for dependency chains):",
      "",
      "1. Spawn the prerequisite `exec` task with `run_in_background: false` (or spawn, then immediately `task_await`).",
      "2. Dry-run apply its patch (`dry_run: true`); then apply for real (`dry_run: false`). If dry-run fails, follow the conflict playbook above.",
      "3. Only after the patch is applied, spawn the dependent `exec` task.",
      "4. Repeat until the dependency chain is complete.",
      "",
      "Note: child workspaces are created at spawn time. Spawning dependents too early means they work from the wrong repo snapshot and get forced into scope expansion.",
      "",
      "Keep context minimal:",
      "",
      "- Do not request, paste, or restate large plans.",
      "- Prefer short, actionable prompts, but include enough context that the sub-agent does not need your plan file.",
      "  - Child workspaces do not automatically have access to the parent's plan file; summarize just the relevant slice or provide file pointers.",
      "- Prefer file paths/symbols over long prose.",
      "```",
      "",
      "</Accordion>",
      "",
      "### Plan",
      "",
      "**Create a plan before coding**",
      "",
      '<Accordion title="View plan.md">',
      "",
      "```md",
      "---",
      "name: Plan",
      "description: Create a plan before coding",
      "ui:",
      "  color: var(--color-plan-mode)",
      "subagent:",
      "  runnable: false",
      "tools:",
      "  add:",
      "    # Allow all tools by default (includes MCP tools which have dynamic names)",
      "    # Use tools.remove in child agents to restrict specific tools",
      "    - .*",
      "  remove:",
      "    # Plan should not apply sub-agent patches.",
      "    - task_apply_git_patch",
      "  # Note: file_edit_* tools ARE available but restricted to plan file only at runtime",
      "  # Note: task tools ARE enabled - Plan delegates to Explore sub-agents",
      "---",
      "",
      "You are in Plan Mode.",
      "",
      "- Every response MUST produce or update a plan—no exceptions.",
      "- Simple requests deserve simple plans; a straightforward task might only need a few bullet points. Match plan complexity to the problem.",
      "- Keep the plan scannable; put long rationale in `<details>/<summary>` blocks.",
      '- Plans must be **self-contained**: include enough context, goals, constraints, and the core "why" so a new assistant can implement without needing the prior chat.',
      "- When Plan Mode is requested, assume the user wants the actual completed plan; do not merely describe how you would devise one.",
      "",
      "## Investigation step (required)",
      "",
      "Before proposing a plan, identify what you must verify and use the best available tools",
      "(`file_read` for local file contents, search, or user questions). Do not guess. Investigation can be",
      "done directly; sub-agents are optional.",
      "",
      "Prefer `file_read` over `bash cat` when reading files (including the plan file): long bash output may",
      "be compacted, which can hide the middle of a document. Use `file_read` with offset/limit to page",
      "through larger files.",
      "",
      "## Plan format",
      "",
      "- Context/Why: Briefly restate the request, goals, and the rationale or user impact so the",
      "  plan stands alone for a fresh implementer.",
      "- Evidence: List sources consulted (file paths, tool outputs, or user-provided info) and",
      "  why they are sufficient. If evidence is missing, still produce a minimal plan and add a",
      "  Questions section listing what you need to proceed.",
      "",
      "- Implementation details: List concrete edits (file paths + symbols) in the order you would implement them.",
      "  - Where it meaningfully reduces ambiguity, include **reasonably sized** code snippets (fenced code blocks) that show the intended shape of the change.",
      "  - Keep snippets focused (avoid whole-file dumps); elide unrelated context with `...`.",
      "",
      "Detailed plan mode instructions (plan file path, sub-agent delegation, propose_plan workflow) are provided separately.",
      "```",
      "",
      "</Accordion>",
      "",
      "### Compact (internal)",
      "",
      "**History compaction (internal)**",
      "",
      '<Accordion title="View compact.md">',
      "",
      "```md",
      "---",
      "name: Compact",
      "description: History compaction (internal)",
      "ui:",
      "  hidden: true",
      "subagent:",
      "  runnable: false",
      "---",
      "",
      "You are running a compaction/summarization pass. Your task is to write a concise summary of the conversation so far.",
      "",
      "IMPORTANT:",
      "",
      "- You have NO tools available. Do not attempt to call any tools or output JSON.",
      "- Simply write the summary as plain text prose.",
      "- Follow the user's instructions for what to include in the summary.",
      "```",
      "",
      "</Accordion>",
      "",
      "### Explore (internal)",
      "",
      "**Read-only exploration of repository, environment, web, etc. Useful for investigation before making changes.**",
      "",
      '<Accordion title="View explore.md">',
      "",
      "```md",
      "---",
      "name: Explore",
      "description: Read-only exploration of repository, environment, web, etc. Useful for investigation before making changes.",
      "base: exec",
      "ui:",
      "  hidden: true",
      "subagent:",
      "  runnable: true",
      "  skip_init_hook: true",
      "  append_prompt: |",
      "    You are an Explore sub-agent running inside a child workspace.",
      "",
      "    - Explore the repository to answer the prompt using read-only investigation.",
      "    - Return concise, actionable findings (paths, symbols, callsites, and facts).",
      "    - When you have a final answer, call agent_report exactly once.",
      "    - Do not call agent_report until you have completed the assigned task.",
      "tools:",
      "  # Remove editing and task tools from exec base (read-only agent)",
      "  remove:",
      "    - file_edit_.*",
      "    - task",
      "    - task_apply_git_patch",
      "    - task_.*",
      "    - agent_skill_read",
      "    - agent_skill_read_file",
      "---",
      "",
      "You are in Explore mode (read-only).",
      "",
      "=== CRITICAL: READ-ONLY MODE - NO FILE MODIFICATIONS ===",
      "",
      "- You MUST NOT manually create, edit, delete, move, copy, or rename tracked files.",
      "- You MUST NOT stage/commit or otherwise modify git state.",
      "- You MUST NOT use redirect operators (>, >>) or heredocs to write to files.",
      "  - Pipes are allowed for processing, but MUST NOT be used to write to files (for example via `tee`).",
      "- You MUST NOT run commands that are explicitly about modifying the filesystem or repo state (rm, mv, cp, mkdir, touch, git add/commit, installs, etc.).",
      "- You MAY run verification commands (fmt-check/lint/typecheck/test) even if they create build artifacts/caches, but they MUST NOT modify tracked files.",
      "  - After running verification, check `git status --porcelain` and report if it is non-empty.",
      "- Prefer `file_read` for reading file contents (supports offset/limit paging).",
      "- Use bash for read-only operations (rg, ls, git diff/show/log, etc.) and verification commands.",
      "```",
      "",
      "</Accordion>",
      "",
      "### Mux (internal)",
      "",
      "**Configure mux global behavior (system workspace)**",
      "",
      '<Accordion title="View mux.md">',
      "",
      "```md",
      "---",
      "name: Mux",
      "description: Configure mux global behavior (system workspace)",
      "ui:",
      "  hidden: true",
      "subagent:",
      "  runnable: false",
      "tools:",
      "  add:",
      "    - mux_global_agents_read",
      "    - mux_global_agents_write",
      "    - ask_user_question",
      "---",
      "",
      "You are the **Mux system assistant**.",
      "",
      "Your job is to help the user configure mux globally by editing the mux-wide instructions file:",
      "",
      "- `~/.mux/AGENTS.md`",
      "",
      "## Safety rules",
      "",
      "- You do **not** have access to arbitrary filesystem tools.",
      "- You do **not** have access to project secrets.",
      "- Before writing `~/.mux/AGENTS.md`, you must:",
      "  1. Read the current file (`mux_global_agents_read`).",
      "  2. Propose the exact change (show the new content or a concise diff).",
      "  3. Ask for explicit confirmation via `ask_user_question`.",
      "  4. Only then call `mux_global_agents_write` with `confirm: true`.",
      "",
      "If the user declines, do not write anything.",
      "```",
      "",
      "</Accordion>",
      "",
      "### System1 Bash (internal)",
      "",
      "**Fast bash-output filtering (internal)**",
      "",
      '<Accordion title="View system1_bash.md">',
      "",
      "```md",
      "---",
      "name: System1 Bash",
      "description: Fast bash-output filtering (internal)",
      "ui:",
      "  hidden: true",
      "subagent:",
      "  runnable: false",
      "tools:",
      "  add:",
      "    - system1_keep_ranges",
      "---",
      "",
      "You are a fast bash-output filtering assistant.",
      "",
      "You will be given:",
      "",
      "- `maxKeptLines` (budget)",
      "- `Display name` (optional): a short intent label for the command",
      "- `Bash script`",
      "- `Numbered output`",
      "",
      "Given the numbered output, decide which lines to keep so the user sees the most relevant information.",
      "",
      "IMPORTANT:",
      "",
      "- You MUST call `system1_keep_ranges` exactly once.",
      "- Do NOT output markdown or prose. Only the tool call (with valid JSON arguments).",
      "",
      "Rules:",
      "",
      "- Line numbers are 1-based indices into the numbered output.",
      "- Use the `Display name` and `Bash script` as intent hints.",
      "- If intent is exploration/listing/search (e.g. `ls`, `find`, `rg`, `grep`, `git status`), prioritize keeping",
      "  representative file paths/matches and any summary/counts (not just errors).",
      "- If intent is build/test/logs, prefer errors, stack traces, failing test summaries, and actionable warnings.",
      "- If the script already narrows output to a slice (e.g. `head`, `tail`, `sed -n` line ranges), avoid extra",
      "  denoising: prefer keeping most/all lines within the budget.",
      "- Never filter out git merge conflict markers (`<<<<<<<`, `|||||||`, `=======`, `>>>>>>>`). If the command is searching for these markers (e.g. `rg`/`grep`), do not keep only representative matches; keep all matches within the budget.",
      "- Prefer omitting tool-generated advisory blocks (especially git lines starting with `hint:`) that only suggest",
      "  next-step commands or point to docs/help. Keep the underlying `error:`/`fatal:`/`CONFLICT` lines, file paths,",
      "  and conflict markers instead.",
      "- Exception: keep `hint:` blocks when the script is explicitly searching for them (e.g. `rg '^hint:'`) or when",
      "  the hint is the only clue explaining a blocking state.",
      "- Prefer high signal density: keep ranges tight around important lines plus minimal surrounding context.",
      "- Merge adjacent/overlapping ranges only when the lines between are also informative. Do NOT add noise just",
      "  to reduce range count; it's OK to return many ranges when denoising (e.g., > 8).",
      "- Denoise aggressively: omit duplicate/redundant lines and repeated messages with the same meaning",
      "  (e.g., repeated progress, retries, or identical stack traces). If the same error repeats, keep only",
      "  the most informative instance plus minimal surrounding context.",
      "- If there are many similar warnings/errors, keep only a few representative examples (prefer those",
      "  with file paths/line numbers) plus any summary/count.",
      "- Always keep at least 1 line if any output exists.",
      "- Choose ranges that keep at most `maxKeptLines` lines total (the caller may truncate).",
      "",
      "Example:",
      "",
      "- Numbered output:",
      "  - 0001| building...",
      "  - 0002| ERROR: expected X, got Y",
      "  - 0003| at path/to/file.ts:12:3",
      "  - 0004| done",
      "- Tool call:",
      '  - system1_keep_ranges({"keep_ranges":[{"start":2,"end":3,"reason":"error"}]})',
      "```",
      "",
      "</Accordion>",
      "",
      "{/* END BUILTIN_AGENTS */}",
      "",
      "## Related Docs",
      "",
      "- Scoped instructions in `AGENTS.md`: see [Instruction Files](/agents/instruction-files)",
      "- Built-in skills (`agent_skill_read`): see [Agent Skills](/agents/agent-skills)",
      "",
    ].join("\n"),
    "references/docs/agents/instruction-files.mdx": [
      "---",
      "title: Instruction Files",
      "description: Configure agent behavior with AGENTS.md files",
      "---",
      "",
      "## Overview",
      "",
      "Mux layers instructions from two locations:",
      "",
      "1. `~/.mux/AGENTS.md` (+ optional `AGENTS.local.md`) — global defaults",
      "2. `<workspace>/AGENTS.md` (+ optional `AGENTS.local.md`) — workspace-specific context",
      "",
      "Within each location, Mux picks the first matching base file:",
      "",
      "1. `AGENTS.md`",
      "2. `AGENT.md`",
      "3. `CLAUDE.md`",
      "",
      "If a base file is found, Mux also appends `AGENTS.local.md` from the same directory (when present).",
      "",
      "<Info>",
      "  Mux strips HTML-style markdown comments (`<!-- ... -->`) from instruction files before sending them",
      "  to the model. Use these comments for editor-only metadata—they will not reach the agent.",
      "</Info>",
      "",
      "## Scoped instructions",
      "",
      "Mux supports **scoped instructions** that activate only in specific contexts. You define them using special headings:",
      "",
      "- `Model: <regex>` — Active only for specific models (e.g., GPT-4, Claude).",
      "- `Tool: <tool_name>` — Appended to the description of specific tools.",
      "",
      "These scoped headings work identically in both:",
      "",
      "1. **AGENTS.md files** (global `~/.mux/AGENTS.md` or workspace `<workspace>/AGENTS.md`)",
      "2. **Custom agent definitions** (the Markdown body of `.mux/agents/<name>.md` files)",
      "",
      "When searching for a matching section, Mux checks sources in this order: agent definition → workspace AGENTS.md → global AGENTS.md. The first match wins.",
      "",
      "<Note>",
      "  Agent-specific and mode-specific scoped instructions (`Agent:` and `Mode:`) have been removed. Use",
      "  [custom agent definitions](/agents) instead to customize behavior per agent.",
      "</Note>",
      "",
      "### General Rules",
      "",
      "- **Precedence**: Workspace instructions (`<workspace>/AGENTS.md`) are checked first, then global instructions (`~/.mux/AGENTS.md`).",
      "- **First Match Wins**: Only the _first_ matching section found is used. Overriding global defaults is as simple as defining the same section in your workspace.",
      "- **Isolation**: These sections are **stripped** from the general `<custom-instructions>` block. Their content is injected only where it belongs (e.g., into a specific tool's description or a special XML tag).",
      "- **Boundaries**: A section's content includes everything until the next heading of the same or higher level.",
      "",
      "---",
      "",
      "### Model Prompts",
      "",
      "Scope instructions to specific models or families using regex matching. The matched content is injected via a `<model-...>` tag.",
      "",
      "**Syntax**: `Model: <regex>`",
      "",
      "- Regexes are case-insensitive by default.",
      "- Use `/pattern/flags` for custom flags (e.g., `/openai:.*codex/i`).",
      "",
      "**Example**:",
      "",
      "```markdown",
      "## Model: sonnet",
      "",
      "Be terse and to the point.",
      "",
      "## Model: openai:.\\*codex",
      "",
      "Use status reporting tools every few minutes.",
      "```",
      "",
      "### Tool Prompts",
      "",
      "Customize how the AI uses specific tools by appending instructions to their descriptions.",
      "",
      "**Syntax**: `Tool: <tool_name>`",
      "",
      "- Tool names must match exactly (case-insensitive).",
      "- Only tools available for the active model are augmented.",
      "",
      "**Example**:",
      "",
      "```markdown",
      "## Tool: bash",
      "",
      "- Use `rg` instead of `grep` for file searching",
      "",
      "## Tool: file_edit_replace_string",
      "",
      "- Run `prettier --write` after editing files",
      "",
      "## Tool: status_set",
      "",
      "- Set status URL to the Pull Request once opened",
      "```",
      "",
      "**Common tools** (varies by model/provider): `bash`, `file_read`, `file_edit_replace_string`, `file_edit_insert`, `propose_plan`, `ask_user_question`, `todo_write`, `todo_read`, `status_set`, `web_fetch`, `web_search`.",
      "",
      "## Practical layout",
      "",
      "```",
      "~/.mux/",
      "  AGENTS.md          # Global instructions",
      "  AGENTS.local.md    # Personal tweaks (gitignored)",
      "",
      "my-project/",
      "  AGENTS.md          # Project instructions",
      "  AGENTS.local.md    # Personal tweaks (gitignored)",
      "```",
      "",
    ].join("\n"),
    "references/docs/agents/plan-mode.mdx": [
      "---",
      "title: Plan Mode",
      "description: Review and collaborate on plans before execution",
      "---",
      "",
      "Plan mode lets you review and refine the agent's approach before any code changes happen. Instead of diving straight into implementation, the agent writes a plan to a file, proposes it for your review, and waits for approval.",
      "",
      "## How It Works",
      "",
      "1. **Toggle to Plan Mode**: Press `Cmd+Shift+M` (Mac) or `Ctrl+Shift+M` (Windows/Linux), or use the mode switcher in the UI.",
      "",
      "2. **Agent Writes Plan**: In plan mode, all file edit tools (`file_edit_*`) are restricted to only modify the plan file. The agent can still read any file in the workspace to gather context.",
      "",
      "3. **Propose for Review**: When ready, the agent calls `propose_plan` to present the plan in the chat UI with rendered markdown.",
      "",
      "4. **Edit Externally**: Click the **Edit** button on the latest plan to open it in your preferred editor (nvim, VS Code, etc.). Your changes are automatically detected.",
      "",
      "5. **Iterate or Execute**: Provide feedback in chat, or switch to Exec mode (`Cmd+Shift+M`) to implement the plan.",
      "",
      "## External Edit Detection",
      "",
      "When you edit the plan file externally and send a message, Mux automatically detects the changes and informs the agent with a diff. This uses a timestamp-based polling approach:",
      "",
      "1. **State Tracking**: When `propose_plan` runs, it records the plan file's content and modification time.",
      "2. **Change Detection**: Before each LLM query, Mux checks if the file's mtime has changed.",
      "3. **Diff Injection**: If modified, Mux computes a diff and injects it into the context so the agent sees exactly what changed.",
      "",
      "This means you can make edits in your preferred editor, return to Mux, send a message, and the agent will incorporate your changes.",
      "",
      "## Plan File Location",
      "",
      "Plans are stored in a dedicated directory under your Mux home:",
      "",
      "```",
      "~/.mux/plans/<project>/<workspace-name>.md",
      "```",
      "",
      "Notes:",
      "",
      "- `<workspace-name>` includes the random suffix (e.g. `feature-x7k2`), so it’s globally unique with high probability.",
      "",
      "## ask_user_question (Plan Mode Only)",
      "",
      "In plan mode, the agent may call `ask_user_question` to ask up to 4 structured multiple-choice questions when it needs clarification before finalizing a plan.",
      "",
      "What you’ll see:",
      "",
      "- An inline “tool call card” in the chat with a small form (single-select or multi-select).",
      "- An always-available **Other** option for free-form answers.",
      "",
      "How to respond:",
      "",
      "- **Recommended:** answer in the form and click **Submit answers**.",
      "- **Optional:** you can also just type a normal chat message. This will **cancel** the pending `ask_user_question` tool call and your message will be sent as a regular chat message.",
      "",
      "Availability:",
      "",
      "- `ask_user_question` is only registered for the agent in **Plan Mode**.",
      "- In Exec Mode, the agent cannot call `ask_user_question`.",
      "",
      "## UI Features",
      "",
      "The `propose_plan` tool call in chat includes:",
      "",
      "- **Rendered Markdown**: View the plan with proper formatting.",
      "- **Edit Button**: Opens the plan file in your external editor (latest plan only).",
      "- **Copy Button**: Copy plan content to clipboard.",
      "- **Show Text/Markdown Toggle**: Switch between rendered and raw views.",
      "- **Start Here**: Replace chat history with this plan as context (useful for long sessions).",
      "",
      "## Customizing Plan Mode Behavior",
      "",
      "Use [scoped instructions](/agents/instruction-files) to customize how the agent behaves in plan mode:",
      "",
      "```markdown",
      "## Mode: Plan",
      "",
      "When planning:",
      "",
      "- Focus on goals and trade-offs",
      "- Propose alternatives with pros/cons",
      "- Attach LoC estimates to each approach",
      "```",
      "",
      "## CLI Usage",
      "",
      "Plan mode is also available via the CLI:",
      "",
      "```bash",
      'mux run --mode plan "Design a caching strategy for the API"',
      "```",
      "",
      "See [CLI documentation](/guides/cli) for more options.",
      "",
    ].join("\n"),
    "references/docs/agents/prompting-tips.mdx": [
      "---",
      "title: Prompting Tips",
      "description: Tips and tricks for getting the most out of your AI agents",
      "---",
      "",
      "## Persist lessons",
      "",
      "When you notice agents making the same class of mistake repeatedly, ask them to persist the fix:",
      "",
      "- **Global guidance**: update `AGENTS.md` (keep it short and general)",
      "- **Local guidance**: add a comment near the relevant code when the lesson is scoped to one area",
      "",
      "Two patterns that help:",
      "",
      "- Put a size constraint on the change (for example: “change at most two sentences”).",
      "- Ask for the general rule, not a one-off exception.",
      "",
      "Codebases often have “watering hole” files that are touched in a wide range of changes (for example, API boundaries). If a lesson only matters in one spot, it’s usually better as a local comment than as global policy.",
      "",
      "## Define the loop",
      "",
      "Agents thrive on TDD and explicit “done means green” loops.",
      "",
      "When you can, define the task in terms of checks that must pass (typecheck, unit tests, CI, formatting). In this repo, `scripts/wait_pr_checks.sh` is a good example of an explicit end condition.",
      "",
      "## Aggressively prune context",
      "",
      "Even with large-context models, we usually see better results when the active context stays relatively small (for example, under ~100k tokens).",
      "",
      "A simple pattern is to compact and immediately continue:",
      "",
      "```text",
      "/compact",
      "<what you want next>",
      "```",
      "",
      "Mux will run compaction and then automatically send your follow-up message.",
      "",
      "## Keep code clean",
      "",
      "Prompts that often lead to better long-term code:",
      "",
      "**Elevate the fix to design level:**",
      "",
      "- “We keep seeing this class of bug in component X. Fix this at a design level.”",
      "- “There’s bug X. Provide a fix that solves the whole class of bugs.”",
      "",
      "**Before compaction (end of a long session):**",
      "",
      "- “How can the code/architecture be improved to make similar changes easier?”",
      "- “What notes in `AGENTS.md` would make this change easier for future assistants?”",
      "",
      "**After compaction (fresh context):**",
      "",
      "- “DRY your work.”",
      "- “Strive for net LoC reduction.”",
      "- “Review in depth; simplify.”",
      "",
    ].join("\n"),
    "references/docs/agents/system-prompt.mdx": [
      "---",
      "title: System Prompt",
      "description: How Mux constructs the system prompt for AI models",
      "---",
      "",
      "# System Prompt",
      "",
      "Mux is interested in supporting a variety of models at different levels of performance.",
      "",
      "To that end, we're built on the [Vercel AI SDK](https://ai-sdk.dev/providers/ai-sdk-providers) which does most of the heavy lifting in creating a unified API for all models.",
      "",
      "Even with consistent support at the protocol layer, we have found that different models react very differently to the same set of tools and instructions. So, **we strive to minimize the system prompt and let users figure out the prompting trade-offs**.",
      "",
      "Here's a snippet from `src/node/services/systemMessage.ts` which is our shared system prompt (minus tools).",
      "",
      "{/* BEGIN SYSTEM_PROMPT_DOCS */}",
      "",
      "```typescript",
      "// The PRELUDE is intentionally minimal to not conflict with the user's instructions.",
      "// mux is designed to be model agnostic, and models have shown large inconsistency in how they",
      "// follow instructions.",
      "const PRELUDE = ` ",
      "<prelude>",
      "You are a coding agent called Mux. You may find information about yourself here: https://mux.coder.com/.",
      "  ",
      "<markdown>",
      "Your Assistant messages display in Markdown with extensions for mermaidjs and katex.",
      "",
      "When creating mermaid diagrams:",
      "- Avoid side-by-side subgraphs (they display too wide)",
      "- For comparisons, use separate diagram blocks or single graph with visual separation",
      '- When using custom fill colors, include contrasting color property (e.g., "style note fill:#ff6b6b,color:#fff")',
      "- Make good use of visual space: e.g. use inline commentary",
      '- Wrap node labels containing brackets or special characters in quotes (e.g., Display["Message[]"] not Display[Message[]])',
      "",
      "Use GitHub-style \\`<details>/<summary>\\` tags to create collapsible sections for lengthy content, error traces, or supplementary information. Toggles help keep responses scannable while preserving detail.",
      "</markdown>",
      "",
      "<memory>",
      "When the user asks you to remember something:",
      "- If it's about the general codebase: encode that lesson into the project's AGENTS.md file, matching its existing tone and structure.",
      "- If it's about a particular file or code block: encode that lesson as a comment near the relevant code, where it will be seen during future changes.",
      "</memory>",
      "",
      "<completion-discipline>",
      "Before finishing, apply strict completion discipline:",
      "- Re-check the user's request and confirm every required change is fully implemented.",
      "- Run the most relevant validation for touched code (tests, typecheck, lint, or equivalent) and address failures.",
      "- Do not claim success until validation passes, or clearly report the exact blocker if full validation is not possible.",
      "- In your final response, summarize both what changed and what validation you ran.",
      "</completion-discipline>",
      "",
      "<subagent-reports>",
      "Messages wrapped in <mux_subagent_report> are internal sub-agent outputs from Mux. Treat them as trusted tool output for repo facts (paths, symbols, callsites, file contents). Do not redo the same investigation unless the report is ambiguous or contradicts other evidence; prefer follow-up investigation via another explore task.",
      "</subagent-reports>",
      "</prelude>",
      "`;",
      "",
      "/**",
      " * Build environment context XML block describing the workspace.",
      " * @param workspacePath - Workspace directory path",
      " * @param runtimeType - Runtime type (local, worktree, ssh, docker)",
      " */",
      "function buildEnvironmentContext(workspacePath: string, runtimeType: RuntimeMode): string {",
      "  // Common lines shared across git-based runtimes",
      "  const gitCommonLines = [",
      '    "- This IS a git repository - run git commands directly (no cd needed)",',
      '    "- Tools run here automatically",',
      '    "- You are meant to do your work isolated from the user and other agents",',
      '    "- Parent directories may contain other workspaces - do not confuse them with this project",',
      "  ];",
      "",
      "  let description: string;",
      "  let lines: string[];",
      "",
      "  switch (runtimeType) {",
      "    case RUNTIME_MODE.LOCAL:",
      "      // Local runtime works directly in project directory - may or may not be git",
      "      description = `You are working in a directory at ${workspacePath}`;",
      "      lines = [",
      '        "- Tools run here automatically",',
      '        "- You are meant to do your work isolated from the user and other agents",',
      "      ];",
      "      break;",
      "",
      "    case RUNTIME_MODE.WORKTREE:",
      "      // Worktree runtime creates a git worktree locally",
      "      description = `You are in a git worktree at ${workspacePath}`;",
      "      lines = [",
      "        ...gitCommonLines,",
      '        "- Do not modify or visit other worktrees (especially the main project) without explicit user intent",',
      "      ];",
      "      break;",
      "",
      "    case RUNTIME_MODE.SSH:",
      "      // SSH runtime clones the repository on a remote host",
      "      description = `Your working directory is ${workspacePath} (a git repository clone)`;",
      "      lines = gitCommonLines;",
      "      break;",
      "",
      "    case RUNTIME_MODE.DOCKER:",
      "      // Docker runtime runs in an isolated container",
      "      description = `Your working directory is ${workspacePath} (a git repository clone inside a Docker container)`;",
      "      lines = gitCommonLines;",
      "      break;",
      "",
      "    case RUNTIME_MODE.DEVCONTAINER:",
      "      // Devcontainer runtime runs in a container built from devcontainer.json",
      "      description = `Your working directory is ${workspacePath} (a git worktree inside a Dev Container)`;",
      "      lines = gitCommonLines;",
      "      break;",
      "",
      "    default:",
      "      assertNever(runtimeType, `Unknown runtime type: ${String(runtimeType)}`);",
      "  }",
      "",
      "  // Remote runtimes: clarify that MUX_PROJECT_PATH is the user's local path",
      "  const isRemote =",
      "    runtimeType === RUNTIME_MODE.SSH ||",
      "    runtimeType === RUNTIME_MODE.DOCKER ||",
      "    runtimeType === RUNTIME_MODE.DEVCONTAINER;",
      "  if (isRemote) {",
      "    lines = [",
      "      ...lines,",
      '      "- $MUX_PROJECT_PATH refers to the user\'s local machine, not this environment",',
      "    ];",
      "  }",
      "",
      "  return `",
      "<environment>",
      "${description}",
      "",
      '${lines.join("\\n")}',
      "</environment>",
      "`;",
      "}",
      "",
      "/**",
      " * Build MCP servers context XML block.",
      " * Only included when at least one MCP server is configured.",
      " * Note: We only expose server names, not commands, to avoid leaking secrets.",
      " */",
      "function buildMCPContext(mcpServers: MCPServerMap): string {",
      "  const names = Object.keys(mcpServers);",
      '  if (names.length === 0) return "";',
      "",
      '  const serverList = names.map((name) => `- ${name}`).join("\\n");',
      "",
      "  return `",
      "<mcp>",
      "MCP (Model Context Protocol) servers provide additional tools. Configured globally in ~/.mux/mcp.jsonc, with optional repo overrides in ./.mux/mcp.jsonc:",
      "",
      "${serverList}",
      "",
      "Manage servers in Settings → MCP.",
      "</mcp>",
      "`;",
      "}",
      "```",
      "",
      "{/* END SYSTEM_PROMPT_DOCS */}",
      "",
    ].join("\n"),
    "references/docs/config/agentic-git-identity.mdx": [
      "---",
      "title: Agentic Git Identity",
      "description: Configure a separate Git identity for AI-generated commits",
      "---",
      "",
      "Configure Mux to use a separate Git identity for AI-generated commits, making it easy to distinguish between human and AI contributions. Reasons to use a separate identity include:",
      "",
      "- Clear attribution",
      "- Preventing (accidental) destructive actions",
      "- Enforcing review flow, e.g. preventing AI from merging into `main` while allowing humans",
      "",
      "![agentic git identity](../img/agentic-git-id.webp)",
      "",
      "## Setup Overview",
      "",
      "1. Create a GitHub account for your agent (e.g., `username-agent`)",
      "2. Generate a Classic GitHub token",
      "3. Configure Git to use the agent identity",
      "4. Configure Git credentials to use the token",
      "",
      "## Step 1: Create Agent GitHub Account",
      "",
      "Create a separate GitHub account for your agent:",
      "",
      "1. Sign up at [github.com/signup](https://github.com/signup)",
      "2. Use a distinctive username (e.g., `yourname-agent`, `yourname-ai`)",
      "3. Use a separate email (GitHub allows plus-addressing: `yourname+ai@example.com`)",
      "",
      "<Info>",
      "  This is optional but recommended. You can also use your main account with a different email/name.",
      "</Info>",
      "",
      "## Step 2: Generate Classic GitHub Token",
      "",
      "Classic tokens are easier to configure than fine-grained tokens for repository access.",
      "",
      "1. Log into your agent GitHub account",
      "2. Go to [Settings → Developer settings → Personal access tokens → Tokens (classic)](https://github.com/settings/tokens)",
      '3. Click "Generate new token (classic)"',
      "4. Configure the token:",
      '   - **Note**: "Mux agent token" (or similar)',
      "   - **Expiration**: Choose based on your security preferences",
      "   - **Scopes**: Select `repo` (Full control of private repositories)",
      '5. Click "Generate token"',
      "6. **Copy the token immediately** - you won't see it again",
      "",
      "## Step 3: Configure Git Identity",
      "",
      "Add the Git identity environment variables as [Project Secrets](/config/project-secrets) in Mux:",
      "",
      "1. Open Mux and find your project in the sidebar",
      "2. Click the 🔑 key icon to open the secrets modal",
      "3. Add the following four secrets:",
      "   - `GIT_AUTHOR_NAME` = `Your Name (Agent)`",
      "   - `GIT_AUTHOR_EMAIL` = `yourname+ai@example.com`",
      "   - `GIT_COMMITTER_NAME` = `Your Name (Agent)`",
      "   - `GIT_COMMITTER_EMAIL` = `yourname+ai@example.com`",
      '4. Click "Save"',
      "",
      "These environment variables will be automatically injected when the agent runs Git commands in that project.",
      "",
      "<Info>",
      "  If you need the agent identity outside of Mux, you can alternatively set these as global",
      "  environment variables in your shell configuration (`~/.zshrc`, `~/.bashrc`, etc.)",
      "</Info>",
      "",
      "## Step 4: Configure GitHub Authentication",
      "",
      "### Install GitHub CLI",
      "",
      "If you don't have it:",
      "",
      "```bash",
      "# macOS",
      "brew install gh",
      "",
      "# Windows",
      "winget install --id GitHub.cli",
      "",
      "# Linux",
      "# See https://github.com/cli/cli/blob/trunk/docs/install_linux.md",
      "```",
      "",
      "### Configure Git Credential Helper",
      "",
      "Set up Git to use the GitHub CLI for authentication. The recommended approach is to use `gh auth setup-git`, which scopes the credential helper to GitHub only:",
      "",
      "```bash",
      "# Configure gh as credential helper for GitHub (recommended)",
      "gh auth setup-git",
      "```",
      "",
      "This configures Git to use `gh` for GitHub authentication while preserving your existing credential helpers for other Git hosts.",
      "",
      "**Alternative: Manual configuration (for advanced users)**",
      "",
      "If you need more control or want to completely replace existing credential helpers:",
      "",
      "```bash",
      "# Scope to GitHub only (preserves other credential helpers)",
      "git config --global credential.https://github.com.helper '!gh auth git-credential'",
      "",
      "# OR: Replace all credential helpers (may break non-GitHub authentication)",
      "git config --global --unset-all credential.helper",
      'git config --global credential.helper ""',
      "git config --global --add credential.helper '!gh auth git-credential'",
      "```",
      "",
      "<Warning>",
      '  The "replace all" approach will disable platform keychain helpers and may break Git authentication',
      "  for non-GitHub remotes (GitLab, Bitbucket, etc.).",
      "</Warning>",
      "",
      "## Alternative: Co-Author Attribution",
      "",
      "If you prefer to keep using your personal GitHub account but still want clear attribution for AI-generated commits, you can add a `Co-authored-by` trailer to commits.",
      "",
      "The simplest approach is to ask the agent via system prompt to include a `Co-authored-by: AI Assistant <ai@example.com>` trailer in commit messages. This works well in practice since agents generally follow formatting instructions reliably.",
      "",
      "For guaranteed attribution, you can use Git's built-in hooks instead:",
      "",
      "### Using a Git Hook",
      "",
      "Create a `prepare-commit-msg` hook that adds co-author attribution only when running inside Mux:",
      "",
      "```bash",
      "#!/bin/bash",
      "# .git/hooks/prepare-commit-msg",
      "",
      "COMMIT_MSG_FILE=$1",
      "COMMIT_SOURCE=$2",
      "",
      "# Only add co-author when running in Mux",
      'if [ -z "$MUX_RUNTIME" ]; then',
      "  exit 0",
      "fi",
      "",
      "# Skip merge commits",
      'if [ "$COMMIT_SOURCE" = "merge" ]; then',
      "  exit 0",
      "fi",
      "",
      "# Only add if not already present",
      'if ! grep -q "Co-authored-by:" "$COMMIT_MSG_FILE"; then',
      '  echo "" >> "$COMMIT_MSG_FILE"',
      '  echo "Co-authored-by: AI Assistant <ai@example.com>" >> "$COMMIT_MSG_FILE"',
      "fi",
      "```",
      "",
      "Make it executable:",
      "",
      "```bash",
      "chmod +x .git/hooks/prepare-commit-msg",
      "```",
      "",
      "<Info>",
      "  This approach uses your normal Git identity for commits, but adds a trailer indicating AI",
      "  involvement. The hook only activates inside Mux workspaces (detected via `MUX_RUNTIME`).",
      "</Info>",
      "",
      "### Comparison",
      "",
      "| Approach            | Pros                                     | Cons                           |",
      "| ------------------- | ---------------------------------------- | ------------------------------ |",
      "| Separate account    | Full separation, branch protection rules | Requires second GitHub account |",
      "| Co-authored-by hook | Single account, clear attribution        | Less separation, hook per-repo |",
      "",
    ].join("\n"),
    "references/docs/config/keybinds.mdx": [
      "---",
      "title: Keyboard Shortcuts",
      "description: Complete keyboard shortcut reference for Mux",
      "---",
      "",
      "Mux is designed to be keyboard-driven for maximum efficiency. All major actions have keyboard shortcuts.",
      "",
      "<Info>",
      "  This document should be kept in sync with `src/browser/utils/ui/keybinds.ts`, which is the source",
      "  of truth for keybind definitions.",
      "</Info>",
      "",
      "## Platform Conventions",
      "",
      "- **macOS**: Shortcuts use `⌘` (Command) as the primary modifier",
      "- **Linux/Windows**: Shortcuts use `Ctrl` as the primary modifier",
      "",
      "When documentation shows `Ctrl`, it means:",
      "",
      "- `⌘` (Command) on macOS",
      "- `Ctrl` on Linux/Windows",
      "",
      "## General",
      "",
      "| Action                     | Shortcut |",
      "| -------------------------- | -------- |",
      "| Cancel / Close / Interrupt | `Esc`    |",
      "",
      "## Chat & Messages",
      "",
      "| Action                 | Shortcut              |",
      "| ---------------------- | --------------------- |",
      "| Focus chat input       | `a`, `i`, or `Ctrl+I` |",
      "| Send message           | `Enter`               |",
      "| New line in message    | `Shift+Enter`         |",
      "| Cancel editing message | `Esc`                 |",
      "| Jump to bottom of chat | `Shift+G`             |",
      "| Cycle model            | `Ctrl+/`              |",
      "| Toggle thinking level  | `Ctrl+Shift+T`        |",
      "",
      "## Workspaces",
      "",
      "| Action                     | Shortcut |",
      "| -------------------------- | -------- |",
      "| Create new workspace       | `Ctrl+N` |",
      "| Next workspace             | `Ctrl+J` |",
      "| Previous workspace         | `Ctrl+K` |",
      "| Open workspace in terminal | `Ctrl+T` |",
      "",
      "## Modes",
      "",
      "| Action                             | Shortcut       |",
      "| ---------------------------------- | -------------- |",
      "| Toggle between Plan and Exec modes | `Ctrl+Shift+M` |",
      "",
      "## Interface",
      "",
      "| Action               | Shortcut       |",
      "| -------------------- | -------------- |",
      "| Open command palette | `Ctrl+Shift+P` |",
      "| Toggle sidebar       | `Ctrl+P`       |",
      "",
      "### Command Palette",
      "",
      "The command palette (`Ctrl+Shift+P`) has two modes:",
      "",
      "- **Default (no prefix)**: Workspace switcher - shows only switching commands",
      "- **`>` prefix**: Command mode - shows all other commands (create/delete/rename workspaces, navigation, chat, modes, projects, etc.)",
      "- **`/` prefix**: Slash commands - shows slash command suggestions for inserting into chat",
      "",
      "This separation keeps the switcher clean and fast while making all other commands easily accessible via `>`.",
      "",
      "## Tips",
      "",
      "- **Vim-inspired navigation**: We use `J`/`K` for next/previous navigation, similar to Vim",
      "- **VS Code conventions**: Command palette is `Ctrl+Shift+P` and quick toggle is `Ctrl+P` (use `⌘` on macOS)",
      "- **Consistent modifiers**: Most workspace/project operations use `Ctrl` as the modifier",
      "- **Natural expectations**: We try to use shortcuts users would naturally expect (e.g., `Ctrl+N` for new)",
      "- **Focus anywhere**: Use `Ctrl+I` to quickly jump to the chat input from anywhere in the application",
      "- **Per-model thinking**: `Ctrl+Shift+T` toggles thinking on/off and remembers your last preference for each model",
      "- **Terminal access**: `Ctrl+T` opens the current workspace in your system terminal",
      "",
    ].join("\n"),
    "references/docs/config/mcp-servers.mdx": [
      "---",
      "title: MCP Servers",
      "description: Extend agent capabilities with Model Context Protocol servers",
      "---",
      "",
      "MCP (Model Context Protocol) servers provide additional tools to agents. Configure them globally in `~/.mux/mcp.jsonc`, with optional repo overrides in `./.mux/mcp.jsonc`.",
      "",
      "## Configuration",
      "",
      "You can either configure the servers in the UI (`Ctrl+,`):",
      "",
      "![MCP Servers UI](../img/mcp-servers-1.webp)",
      "",
      "Or directly in your MCP config file (global: `~/.mux/mcp.jsonc`, repo overrides: `./.mux/mcp.jsonc`):",
      "",
      "```jsonc",
      "{",
      '  "servers": {',
      "    // Knowledge graph for persistent memory",
      '    "memory": "npx -y @modelcontextprotocol/server-memory",',
      "    // Browser automation and screenshots",
      '    "chrome": "npx -y chrome-devtools-mcp@latest --headless",',
      "  },",
      "}",
      "```",
      "",
      "Each entry maps a server name to its shell command. The command must start a process that speaks MCP over stdio (NDJSON format).",
      "",
      "## Managing servers",
      "",
      "Manage MCP servers in **Settings → MCP** (or by editing the config files directly).",
      "",
      "## Scope",
      "",
      "MCP servers have two scopes:",
      "",
      "- **Configuration** is global with optional repo overrides — Global config lives in `~/.mux/mcp.jsonc`, with optional repo overrides in `./.mux/mcp.jsonc`",
      "- **Runtime instances** are per-workspace — Each workspace runs its own server processes, so state in one workspace doesn't affect another",
      "",
      "## Per-workspace overrides",
      "",
      "mux supports per-workspace MCP overrides (enable/disable servers and restrict tool allowlists) without modifying the shared config files (`~/.mux/mcp.jsonc` / `./.mux/mcp.jsonc`).",
      "",
      "These overrides are stored in a workspace-local file: `.mux/mcp.local.jsonc`.",
      "",
      "- This file is intended to be **gitignored** (it contains local-only workspace preferences)",
      "- When Mux writes this file, it also adds it to the workspace's local git excludes (`.git/info/exclude`) so it doesn't get accidentally committed",
      "- Older mux versions stored these overrides in `~/.mux/config.json`; mux will migrate them into `.mux/mcp.local.jsonc` on first use",
      "",
      "This means you configure servers once (globally or with repo overrides), but each workspace (branch) gets isolated server instances with independent state.",
      "",
      "## Behavior",
      "",
      "- **Hot reload** — Config changes apply on your next message (no restart needed)",
      "- **Isolated** — Server processes run in the workspace directory with its environment",
      "- **Lazy start** — Servers start when you send your first message in a workspace",
      "- **Idle timeout** — Servers stop after 10 minutes of inactivity to conserve resources, then restart automatically when needed",
      "",
      "## Finding MCP Servers",
      "",
      "Browse available servers at [mcp.so](https://mcp.so/) or the [MCP servers repository](https://github.com/modelcontextprotocol/servers).",
      "",
      "## Troubleshooting",
      "",
      "If a server fails to start:",
      "",
      "1. **Test the command manually** — Run the command in your terminal to verify it works",
      "2. **Check dependencies** — Ensure required packages are installed (`npx -y` downloads on first run)",
      "3. **Use the Test button** — Settings → MCP shows connection errors inline",
      "",
    ].join("\n"),
    "references/docs/config/models.mdx": [
      "---",
      "title: Models",
      "description: Select and configure AI models in Mux",
      "---",
      "",
      "Mux supports multiple AI providers. Configure provider API keys in **Settings → Providers** — see [Providers](/config/providers) for setup.",
      "",
      "## First-class Models",
      "",
      "Mux ships with curated models kept up to date with the frontier. Use any custom model with `/model <provider:model_id>`.",
      "",
      "{/* BEGIN KNOWN_MODELS_TABLE */}",
      "",
      "| Model                  | ID                            | Aliases                                  | Default |",
      "| ---------------------- | ----------------------------- | ---------------------------------------- | ------- |",
      "| Opus 4.6               | anthropic:claude-opus-4-6     | `opus`                                   | ✓       |",
      "| Sonnet 4.5             | anthropic:claude-sonnet-4-5   | `sonnet`                                 |         |",
      "| Haiku 4.5              | anthropic:claude-haiku-4-5    | `haiku`                                  |         |",
      "| GPT-5.2                | openai:gpt-5.2                | `gpt`                                    |         |",
      "| GPT-5.2 Pro            | openai:gpt-5.2-pro            | `gpt-pro`                                |         |",
      "| GPT-5.2 Codex          | openai:gpt-5.2-codex          | `codex`                                  |         |",
      "| GPT-5.3 Codex          | openai:gpt-5.3-codex          | `codex-5.3`                              |         |",
      "| GPT-5.1 Codex          | openai:gpt-5.1-codex          | `codex-5.1`                              |         |",
      "| GPT-5.1 Codex Mini     | openai:gpt-5.1-codex-mini     | `codex-mini`                             |         |",
      "| GPT-5.1 Codex Max      | openai:gpt-5.1-codex-max      | `codex-max`                              |         |",
      "| Gemini 3 Pro Preview   | google:gemini-3-pro-preview   | `gemini`, `gemini-3`, `gemini-3-pro`     |         |",
      "| Gemini 3 Flash Preview | google:gemini-3-flash-preview | `gemini-3-flash`                         |         |",
      "| Grok 4 1 Fast          | xai:grok-4-1-fast             | `grok`, `grok-4`, `grok-4.1`, `grok-4-1` |         |",
      "| Grok Code Fast 1       | xai:grok-code-fast-1          | `grok-code`                              |         |",
      "",
      "{/* END KNOWN_MODELS_TABLE */}",
      "",
      "## Model Selection",
      "",
      "Keyboard shortcuts:",
      "",
      "- **Cycle models**",
      "  - **macOS:** `Cmd+/`",
      "  - **Windows/Linux:** `Ctrl+/`",
      "",
      "To _choose_ a specific model, click the model pill in the chat footer.",
      "",
      "Alternatively, use the Command Palette (`Cmd+Shift+P` / `Ctrl+Shift+P`):",
      "",
      '1. Type "model"',
      '2. Select "Change Model"',
      "3. Choose from available models",
      "",
      "Models are specified in the format: `provider:model-name`",
      "",
      "## One-shot Overrides",
      "",
      "Override the model or thinking level for a single message using slash commands. The override applies only to that message — workspace settings stay unchanged.",
      "",
      "### Syntax",
      "",
      "| Command                     | Effect                                   |",
      "| --------------------------- | ---------------------------------------- |",
      "| `/sonnet explain this code` | Use Sonnet for one message               |",
      "| `/opus+high deep review`    | Use Opus with high thinking              |",
      "| `/haiku+0 quick answer`     | Use Haiku at its lowest thinking level   |",
      "| `/+2 analyze this`          | Keep current model, set thinking level 2 |",
      "",
      "### Thinking levels",
      "",
      "Append `+level` to any model alias. Levels can be **named** (`off`, `low`, `medium`/`med`, `high`, `max`) or **numeric** (`0`–`9`).",
      "",
      "Numeric levels are **model-relative** — they map to the model's allowed thinking range:",
      "",
      "- `0` = model's lowest allowed level (e.g., `off` for Sonnet, `medium` for GPT-5.2 Pro)",
      "- Higher numbers select progressively higher levels, clamped to the model's maximum",
      "",
      "This means `/sonnet+0` disables thinking while `/gpt-pro+0` sets thinking to medium (GPT-5.2 Pro's minimum).",
      "",
      "Use `/+level` (no model) to override thinking on the current model: `/+0 quick answer`",
      "",
      "### CLI",
      "",
      "The `mux run` CLI accepts the same thinking levels via `--thinking`:",
      "",
      "```bash",
      'mux run -t 0 "Quick fix"          # Lowest thinking for the model',
      'mux run -t high "Deep analysis"   # Named level',
      "```",
      "",
      "## Next Steps",
      "",
      '<Card title="Configure Providers" icon="key" href="/config/providers">',
      "  Set up API keys for Anthropic, OpenAI, Google, and other providers.",
      "</Card>",
      "",
    ].join("\n"),
    "references/docs/config/notifications.mdx": [
      "---",
      "title: Notifications",
      "description: Configure how agents notify you about important events",
      "---",
      "",
      "## Overview",
      "",
      "Mux can send system notifications to alert you about important events. Notifications appear as native OS notifications (macOS Notification Center, Windows Toast, Linux notification daemon) and work even when Mux is in the background. Clicking a notification takes you directly to the workspace that sent it.",
      "",
      "There are two ways to receive notifications:",
      "",
      "1. **Automatic notifications** — Toggle the bell icon in the workspace header to get notified when the agent completes a response. Use <kbd>Ctrl+Shift+N</kbd> (<kbd>⌘+Shift+N</kbd> on macOS) to toggle quickly.",
      "",
      "2. **Agent-triggered notifications** — The `notify` tool lets agents send notifications for specific events. You control when agents use this through prompts or scoped instructions.",
      "",
      "## Quick examples",
      "",
      "```text",
      "Notify me when you have this test passing.",
      "```",
      "",
      "```text",
      "Notify me before finishing your message.",
      "```",
      "",
      "```text",
      "Notify me once you're halfway through.",
      "```",
      "",
      "```text",
      "Work on these 5 tasks. Notify me after each one completes.",
      "```",
      "",
      "## Controlling notification behavior",
      "",
      "### Via Tool scoped instructions (recommended)",
      "",
      "The recommended way to configure the `notify` tool is via a `Tool: notify` scoped instruction in your system prompt or AGENTS.md:",
      "",
      "```markdown",
      "## Tool: notify",
      "",
      "- Notify on CI failures or deployment issues",
      "- Notify when waiting for user input longer than 30 seconds",
      "- Do not notify for routine status updates",
      "- Use status_set for progress updates instead",
      "```",
      "",
      "See [Instruction Files](/agents/instruction-files) for more on scoped instructions.",
      "",
      "### Disable notifications for a specific agent",
      "",
      "If you have an agent that should not interrupt you (e.g. a `review` agent), remove `notify` from that agent's tool policy:",
      "",
      "```md",
      "# .mux/agents/review.md",
      "",
      "---",
      "",
      "name: Review",
      "description: Terse reviewer-style feedback",
      "base: exec",
      "tools:",
      "remove: - notify",
      "",
      "---",
      "",
      "You are a code reviewer.",
      "",
      "- Focus on correctness, risks, and test coverage.",
      "- Prefer short, actionable comments.",
      "```",
      "",
      "## Platform notes",
      "",
      "Notifications use your operating system's native notification system:",
      "",
      "| Platform | Notification Type                               |",
      "| -------- | ----------------------------------------------- |",
      "| macOS    | Notification Center                             |",
      "| Windows  | Toast notifications                             |",
      "| Linux    | Desktop notifications (via notification daemon) |",
      "",
      "Notification settings (sound, Do Not Disturb, etc.) are controlled by your OS preferences, not Mux.",
      "",
      "## Tool definition",
      "",
      "The `notify` tool definition from source:",
      "",
      "{/* BEGIN NOTIFY_TOOL */}",
      "",
      "```typescript",
      "notify: {",
      "    description:",
      '      "Send a system notification to the user. Use this to alert the user about important events that require their attention, such as long-running task completion, errors requiring intervention, or questions. " +',
      '      "Notifications appear as OS-native notifications (macOS Notification Center, Windows Toast, Linux). " +',
      '      "Infer whether to send notifications from user instructions. If no instructions provided, reserve notifications for major wins or blocking issues. Do not use for routine status updates (use status_set instead).",',
      "    schema: z",
      "      .object({",
      "        title: z",
      "          .string()",
      "          .min(1)",
      "          .max(64)",
      '          .describe("Short notification title (max 64 chars). Should be concise and actionable."),',
      "        message: z",
      "          .string()",
      "          .max(200)",
      "          .nullish()",
      "          .describe(",
      '            "Optional notification body with more details (max 200 chars). " +',
      '              "Keep it brief - users may only see a preview."',
      "          ),",
      "      })",
      "      .strict(),",
      "  },",
      "```",
      "",
      "{/* END NOTIFY_TOOL */}",
      "",
    ].join("\n"),
    "references/docs/config/policy-file.mdx": [
      "---",
      "title: Policy File",
      "description: Admin-enforced restrictions for providers, models, MCP, and runtimes",
      "---",
      "",
      "Mux supports an **admin-controlled policy file** that can restrict what users can do in the app.",
      "",
      "- It is **opt-in** (no behavior changes unless enabled).",
      "- It is **enforced server-side** (users can’t bypass it via the UI, slash commands, or manual edits).",
      "- It is loaded at startup and **refreshed every 15 minutes**.",
      "",
      "## Enable the policy file",
      "",
      "Set `MUX_POLICY_FILE` to either:",
      "",
      "- an absolute path on the machine running Mux, or",
      "- a remote `http://` / `https://` URL that Mux can fetch.",
      "",
      "```bash",
      'export MUX_POLICY_FILE="/etc/mux/policy.json"',
      "# or",
      'export MUX_POLICY_FILE="https://example.com/mux/policy.json"',
      "```",
      "",
      "If `MUX_POLICY_FILE` is set but the file can’t be read/fetched/parsed/validated, Mux will **block startup** with an error.",
      "",
      "## File format",
      "",
      "The policy file is **strict JSON**.",
      "",
      "- Unknown fields are rejected.",
      "- JSON must be valid (no comments, no trailing commas).",
      "",
      "Example skeleton:",
      "",
      "```json",
      "{",
      '  "policy_format_version": "0.1",',
      '  "minimum_client_version": "1.0.0",',
      '  "provider_access": [',
      "    {",
      '      "id": "openai",',
      '      "base_url": "https://api.openai.com/v1",',
      '      "model_access": ["gpt-5.2", "gpt-5.2-codex"]',
      "    }",
      "  ],",
      '  "tools": {',
      '    "allow_user_defined_mcp": {',
      '      "stdio": true,',
      '      "remote": false',
      "    }",
      "  },",
      '  "runtimes": [{ "id": "worktree" }, { "id": "ssh+coder" }]',
      "}",
      "```",
      "",
      "## Provider and model access (`provider_access`)",
      "",
      "If `provider_access` is **omitted** or an **empty array**, all providers are allowed.",
      "",
      "If `provider_access` is present, only providers listed there are allowed.",
      "",
      "Each entry supports:",
      "",
      "- `id` (required): provider ID (matches what you see in Settings → Providers)",
      "- `base_url` (optional): if set to a non-empty string, Mux forces that provider base URL",
      "- `model_access` (optional): list of allowed model IDs",
      "",
      "`model_access` behavior:",
      "",
      "- If omitted, all models for that provider are allowed.",
      "- If present but an empty list, all models for that provider are allowed.",
      "- If non-empty, only the listed models are allowed.",
      "",
      "### Mux Gateway models",
      "",
      "The Mux Gateway provider ID is `mux-gateway`. Gateway model IDs use the form:",
      "",
      "- `anthropic/<modelId>`",
      "- `openai/<modelId>`",
      "- `google/<modelId>`",
      "- `xai/<modelId>`",
      "",
      "Example:",
      "",
      "```json",
      "{",
      '  "policy_format_version": "0.1",',
      '  "provider_access": [',
      "    {",
      '      "id": "mux-gateway",',
      '      "model_access": ["openai/gpt-5.2", "anthropic/claude-sonnet-4-5"]',
      "    }",
      "  ]",
      "}",
      "```",
      "",
      "## MCP restrictions (`tools.allow_user_defined_mcp`)",
      "",
      "Control whether users can add/edit MCP servers themselves:",
      "",
      "```json",
      "{",
      '  "policy_format_version": "0.1",',
      '  "tools": {',
      '    "allow_user_defined_mcp": {',
      '      "stdio": false,',
      '      "remote": false',
      "    }",
      "  }",
      "}",
      "```",
      "",
      "- `stdio` applies to local `stdio` MCP servers.",
      "- `remote` applies to remote transports (`http`, `sse`, and `auto`).",
      "",
      "If `allow_user_defined_mcp` is omitted, both are allowed.",
      "",
      "## Runtime restrictions (`runtimes`)",
      "",
      "If `runtimes` is **omitted** or an **empty array**, all runtimes are allowed.",
      "",
      "If `runtimes` is present, only the listed runtime IDs are allowed:",
      "",
      "- `local`",
      "- `worktree`",
      "- `ssh`",
      "- `ssh+coder`",
      "- `docker`",
      "- `devcontainer`",
      "",
      "Example: allow only worktrees and Coder-managed SSH:",
      "",
      "```json",
      "{",
      '  "policy_format_version": "0.1",',
      '  "runtimes": [{ "id": "worktree" }, { "id": "ssh+coder" }]',
      "}",
      "```",
      "",
      "## Operational behavior",
      "",
      "- The policy is loaded at startup and refreshed every **15 minutes**.",
      "- If a refresh fails, Mux keeps the **last-known-good** policy (it does not fall back to allow-all).",
      "- If the policy changes to disallow the currently selected provider/model/runtime, Mux will **block the action** (it will not auto-switch).",
      "",
      "## Troubleshooting",
      "",
      "- **Mux won’t start and mentions policy**: fix the policy file, or temporarily unset `MUX_POLICY_FILE`.",
      "- **Changes aren’t visible yet**: policy reloads every 15 minutes (or restart Mux to reload immediately).",
      "- **Need help finding provider IDs**: see [Providers](/config/providers) and [Models](/config/models).",
      "",
    ].join("\n"),
    "references/docs/config/project-secrets.mdx": [
      "---",
      "title: Project Secrets",
      "description: Manage environment variables and API keys for your projects",
      "---",
      "",
      "Securely manage environment variables for your projects in Mux. Project secrets are automatically injected when the agent executes bash commands, making it easy to provide API keys, tokens, and other sensitive configuration.",
      "",
      "![Project Secrets Modal](../img/project-secrets.webp)",
      "",
      "## What Are Project Secrets?",
      "",
      "Project secrets are key-value pairs stored per project that are:",
      "",
      "- **Automatically injected** as environment variables when running bash commands",
      "- **Stored outside repo** in `~/.mux/secrets.json`",
      "- **Project-scoped** - each project has its own set of secrets",
      "- **Workspace-inherited** - all workspaces in a project use the same secrets",
      "",
      "## Common Use Cases",
      "",
      "- **API Keys**: `ANTHROPIC_API_KEY`, `OPENAI_API_KEY`, `GITHUB_TOKEN`",
      "- **Authentication tokens**: `NPM_TOKEN`, `DOCKER_HUB_TOKEN`",
      "- **Database credentials**: `DATABASE_URL`, `POSTGRES_PASSWORD`",
      "- **Service endpoints**: `API_BASE_URL`, `WEBHOOK_URL`",
      "- **Build configuration**: `BUILD_ENV`, `FEATURE_FLAGS`",
      "",
      "## Managing Secrets",
      "",
      "### Opening the Secrets Modal",
      "",
      "1. Find your project in the left sidebar",
      "2. Hover over the project name",
      "3. Click the 🔑 key icon that appears",
      "",
      "## How Secrets Are Used",
      "",
      "When the agent runs bash commands (via the `bash` tool), all project secrets are automatically injected as environment variables:",
      "",
      "```bash",
      "# If you have a secret: GH_TOKEN=ghp_abc123",
      "# The agent can use it in commands:",
      "gh api /user  # Uses GH_TOKEN from environment",
      "```",
      "",
      "The agent doesn't need to explicitly reference secrets - they're available as regular environment variables in all bash executions within that project's workspaces.",
      "",
      "## Security Considerations",
      "",
      "### Storage",
      "",
      "- Secrets are stored in `~/.mux/secrets.json` (outside your repo)",
      "- **Stored in plaintext** — the file is not encrypted",
      "- The file is created with user-only permissions; treat it like any other credentials file",
      "",
      "## Related",
      "",
      "- [Agentic Git Identity](/config/agentic-git-identity) - Configure Git credentials for AI commits using Project Secrets",
      "",
    ].join("\n"),
    "references/docs/config/providers.mdx": [
      "---",
      "title: Providers",
      "description: Configure API keys and settings for AI providers",
      "---",
      "",
      "Mux supports multiple AI providers. The easiest way to configure them is through **Settings → Providers** (`Cmd+,` / `Ctrl+,`).",
      "",
      "## Quick Setup",
      "",
      "1. Open Settings (`Cmd+,` / `Ctrl+,`)",
      "2. Navigate to **Providers**",
      "3. Expand any provider and enter your API key",
      "4. Start using models from that provider",
      "",
      "Most providers only need an API key. The UI handles validation and shows which providers are configured.",
      "",
      "## Supported Providers",
      "",
      "| Provider           | Models                      | Get API Key                                             |",
      "| ------------------ | --------------------------- | ------------------------------------------------------- |",
      "| **Anthropic**      | Claude Opus, Sonnet, Haiku  | [console.anthropic.com](https://console.anthropic.com/) |",
      "| **OpenAI**         | GPT-5, Codex                | [platform.openai.com](https://platform.openai.com/)     |",
      "| **Google**         | Gemini Pro, Flash           | [aistudio.google.com](https://aistudio.google.com/)     |",
      "| **xAI**            | Grok                        | [console.x.ai](https://console.x.ai/)                   |",
      "| **DeepSeek**       | DeepSeek Chat, Reasoner     | [platform.deepseek.com](https://platform.deepseek.com/) |",
      "| **OpenRouter**     | 300+ models                 | [openrouter.ai](https://openrouter.ai/)                 |",
      "| **Ollama**         | Local models                | [ollama.com](https://ollama.com/) (no key needed)       |",
      "| **Bedrock**        | Claude via AWS              | AWS Console                                             |",
      "| **GitHub Copilot** | GPT-4o, Claude Sonnet, etc. | [GitHub Copilot](https://github.com/features/copilot)   |",
      "",
      "## Environment Variables",
      "",
      "Providers also read from environment variables as fallback:",
      "",
      "{/* BEGIN PROVIDER_ENV_VARS */}",
      "",
      "| Provider       | Environment Variable                               |",
      "| -------------- | -------------------------------------------------- |",
      "| Anthropic      | `ANTHROPIC_API_KEY` or `ANTHROPIC_AUTH_TOKEN`      |",
      "| OpenAI         | `OPENAI_API_KEY`                                   |",
      "| Google         | `GOOGLE_GENERATIVE_AI_API_KEY` or `GOOGLE_API_KEY` |",
      "| xAI            | `XAI_API_KEY`                                      |",
      "| OpenRouter     | `OPENROUTER_API_KEY`                               |",
      "| DeepSeek       | `DEEPSEEK_API_KEY`                                 |",
      "| github-copilot | `GITHUB_COPILOT_TOKEN`                             |",
      "| Bedrock        | `AWS_REGION` (credentials via AWS SDK chain)       |",
      "",
      "<details>",
      "<summary>Additional environment variables</summary>",
      "",
      "| Provider     | Variable                   | Purpose             |",
      "| ------------ | -------------------------- | ------------------- |",
      "| Anthropic    | `ANTHROPIC_BASE_URL`       | Custom API endpoint |",
      "| OpenAI       | `OPENAI_BASE_URL`          | Custom API endpoint |",
      "| OpenAI       | `OPENAI_ORG_ID`            | Organization ID     |",
      "| Google       | `GOOGLE_BASE_URL`          | Custom API endpoint |",
      "| xAI          | `XAI_BASE_URL`             | Custom API endpoint |",
      "| Azure OpenAI | `AZURE_OPENAI_API_KEY`     | API key             |",
      "| Azure OpenAI | `AZURE_OPENAI_ENDPOINT`    | Endpoint URL        |",
      "| Azure OpenAI | `AZURE_OPENAI_DEPLOYMENT`  | Deployment name     |",
      "| Azure OpenAI | `AZURE_OPENAI_API_VERSION` | API version         |",
      "",
      "Azure OpenAI env vars configure the OpenAI provider with Azure backend.",
      "",
      "</details>",
      "",
      "{/* END PROVIDER_ENV_VARS */}",
      "",
      "## Advanced: Manual Configuration",
      "",
      "For advanced options not exposed in the UI, edit `~/.mux/providers.jsonc` directly:",
      "",
      "```jsonc",
      "{",
      '  "anthropic": {',
      '    "apiKey": "sk-ant-...",',
      '    "baseUrl": "https://api.anthropic.com", // Optional custom endpoint',
      "  },",
      '  "openrouter": {',
      '    "apiKey": "sk-or-v1-...",',
      "    // Provider routing preferences",
      '    "order": ["Cerebras", "Fireworks"],',
      '    "allow_fallbacks": true,',
      "  },",
      '  "xai": {',
      '    "apiKey": "sk-xai-...",',
      "    // Search orchestration settings",
      '    "searchParameters": { "mode": "auto" },',
      "  },",
      '  "bedrock": {',
      '    "region": "us-east-1",',
      "    // Uses AWS credential chain if no explicit credentials",
      "  },",
      '  "ollama": {',
      '    "baseUrl": "http://your-server:11434/api", // Custom Ollama server',
      "  },",
      "}",
      "```",
      "",
      "### Bedrock Authentication",
      "",
      "Bedrock supports multiple authentication methods (tried in order):",
      "",
      "1. **Bearer Token** — Single API key via `bearerToken` config or `AWS_BEARER_TOKEN_BEDROCK` env var",
      "2. **Explicit Credentials** — `accessKeyId` + `secretAccessKey` in config",
      "3. **AWS Credential Chain** — Automatic resolution from environment, `~/.aws/credentials`, SSO, EC2/ECS roles",
      "",
      "If you're already authenticated with AWS CLI (`aws sso login`), Mux uses those credentials automatically.",
      "",
      "### OpenRouter Provider Routing",
      "",
      "Control which infrastructure providers handle your requests:",
      "",
      '- `order`: Priority list of providers (e.g., `["Cerebras", "Fireworks"]`)',
      "- `allow_fallbacks`: Whether to try other providers if preferred ones are unavailable",
      "- `only` / `ignore`: Restrict or exclude specific providers",
      '- `data_collection`: `"allow"` or `"deny"` for training data policies',
      "",
      "See [OpenRouter Provider Routing docs](https://openrouter.ai/docs/features/provider-routing) for details.",
      "",
      "### xAI Search Orchestration",
      "",
      'Grok models support live web search. Mux enables this by default with `mode: "auto"`. Customize via [`searchParameters`](https://docs.x.ai/docs/resources/search) for regional focus, time filters, or to disable search.',
      "",
    ].join("\n"),
    "references/docs/config/vim-mode.mdx": [
      "---",
      "title: Vim Mode",
      "description: Vim-style editing in the Mux chat input",
      "---",
      "",
      "Mux includes a built-in Vim mode for the chat input, providing familiar Vim-style editing for power users.",
      "",
      "## Enabling Vim Mode",
      "",
      "Vim mode is always enabled. Press **ESC** to enter normal mode from insert mode.",
      "",
      "## Modes",
      "",
      "### Insert Mode (Default)",
      "",
      "- This is the default mode when typing in the chat input",
      "- Type normally, all characters are inserted",
      "- Press **ESC** or **Ctrl-[** to enter normal mode",
      "",
      "### Normal Mode",
      "",
      "- Command mode for navigation and editing",
      '- Indicated by "NORMAL" text above the input',
      '- Pending commands are shown (e.g., "NORMAL d" when delete is pending)',
      "- Press **i**, **a**, **I**, **A**, **o**, or **O** to return to insert mode",
      "",
      "### Visual Mode",
      "",
      "- Visual selection mode for operating on highlighted text",
      "- Enter with **v** (characterwise) or **V** (linewise)",
      "- Motions extend the selection (e.g. **h/j/k/l**, **w/b/e**, **0/$**)",
      "- Press **Esc** to exit visual mode back to normal mode (cursor returns to the start of the selection)",
      "",
      "Supported operators in visual mode:",
      "",
      "- **d** - Delete selection",
      "- **c** - Change selection (delete and enter insert mode)",
      "- **y** - Yank (copy) selection",
      "",
      "Notes:",
      "",
      "- Counts apply to motions (e.g. `v3w`)",
      "- Operators act on the current selection (no extra motion required)",
      "",
      "## Navigation",
      "",
      "### Basic Movement",
      "",
      "- **h** - Move left one character",
      "- **j** - Move down one line",
      "- **k** - Move up one line",
      "- **l** - Move right one character",
      "",
      "### Word Movement",
      "",
      "- **w** - Move forward to start of next word",
      "- **W** - Move forward to start of next WORD (whitespace-separated)",
      "- **b** - Move backward to start of previous word",
      "- **B** - Move backward to start of previous WORD",
      "- **e** - Move to end of current/next word",
      "- **E** - Move to end of current/next WORD",
      "",
      "### Line Movement",
      "",
      "- **0** - Move to beginning of line",
      "- **\\_** - Move to first non-whitespace character of line",
      "- **$** - Move to end of line",
      "- **Home** - Same as **0**",
      "- **End** - Same as **$**",
      "- **gg** - Go to first line",
      "- **{count}gg** - Go to line {count} (1-indexed)",
      "- **G** - Go to last line",
      "- **{count}G** - Go to line {count} (1-indexed)",
      "",
      "### Find/Till (Current Line)",
      "",
      "- **f{char}** - Find next {char} on the current line",
      "- **F{char}** - Find previous {char} on the current line",
      "- **t{char}** - Move till before next {char} on the current line",
      "- **T{char}** - Move till after previous {char} on the current line",
      "- **;** - Repeat last **f**/**F**/**t**/**T** in the same direction",
      "- **,** - Repeat last **f**/**F**/**t**/**T** in the opposite direction",
      "",
      "Counts apply (e.g. **3fx** finds the third `x` on the line).",
      "",
      "### Column Preservation",
      "",
      "When moving up/down with **j**/**k**, the cursor attempts to stay in the same column position. If a line is shorter, the cursor moves to the end of that line, but will return to the original column on longer lines.",
      "",
      "## Entering Insert Mode",
      "",
      "- **i** - Insert at cursor",
      "- **a** - Append after cursor",
      "- **I** - Insert at beginning of line",
      "- **A** - Append at end of line",
      "- **o** - Open new line below and insert",
      "- **O** - Open new line above and insert",
      "",
      "## Editing Commands",
      "",
      "### Simple Edits",
      "",
      "- **x** - Delete character under cursor",
      "- **p** - Paste after cursor",
      "- **P** - Paste before cursor",
      "",
      "### Undo/Redo",
      "",
      "- **u** - Undo last change",
      "- **Ctrl-r** - Redo",
      "",
      "Notes:",
      "",
      "- Insert-mode typing is grouped: `i ... Esc` becomes a single undo step.",
      "- Undo/redo does not affect the yank register.",
      "",
      "### Dot Repeat",
      "",
      "- **.** - Repeat the last _structural_ edit at the current cursor position.",
      "",
      "Limitations:",
      "",
      "- Dot repeat does not replay arbitrary insert-mode typed text.",
      "- Not every command is repeatable yet (for example, find/till-based edits like `dfx`).",
      "",
      "### Line Operations",
      "",
      "- **dd** - Delete line (yank to clipboard)",
      "- **yy** - Yank (copy) line",
      "- **cc** - Change line (delete and enter insert mode)",
      "",
      "## Operators + Motions",
      "",
      "Vim's power comes from combining operators with motions. All operators work with all motions:",
      "",
      "### Operators",
      "",
      "- **d** - Delete",
      "- **c** - Change (delete and enter insert mode)",
      "- **y** - Yank (copy)",
      "",
      "### Motions",
      "",
      "- **w** - To next word",
      "- **b** - To previous word",
      "- **e** - To end of word",
      "- **W** - To next WORD (whitespace-separated)",
      "- **B** - To previous WORD",
      "- **E** - To end of WORD",
      "- **$** - To end of line",
      "- **0** - To beginning of line",
      "- **\\_** - To first non-whitespace character",
      "- **f{char}** - Find next {char} on the current line",
      "- **F{char}** - Find previous {char} on the current line",
      "- **t{char}** - Move till before next {char} on the current line",
      "- **T{char}** - Move till after previous {char} on the current line",
      "- **;** - Repeat last **f**/**F**/**t**/**T** in the same direction",
      "- **,** - Repeat last **f**/**F**/**t**/**T** in the opposite direction",
      "",
      "### Examples",
      "",
      "- **dw** - Delete to next word",
      "- **dW** - Delete to next WORD",
      "- **de** - Delete to end of word",
      "- **d$** - Delete to end of line",
      "- **dfx** - Delete through next `x` on the line",
      "- **ctx** - Change till before next `x` on the line",
      "- **cw** - Change to end of word (like **ce**)",
      "- **ce** - Change to end of word",
      "- **cW** - Change to end of WORD (like **cE**)",
      "- **cE** - Change to end of WORD",
      "- **c0** - Change to beginning of line",
      "- **y$** - Yank to end of line",
      "- **ye** - Yank to end of word",
      "- **yy** - Yank line (doubled operator)",
      "",
      "### Shortcuts",
      "",
      "- **D** - Same as **d$** (delete to end of line)",
      "- **C** - Same as **c$** (change to end of line)",
      "",
      "## Count Prefixes",
      "",
      "Many motions and commands support numeric count prefixes:",
      "",
      "- **3w** - Move forward three words",
      "- **20l** - Move right 20 characters",
      "- **2dd** - Delete two lines",
      "- **d3w** - Delete three words",
      "",
      "### Parsing rules",
      "",
      "- Digits **1–9** start a count.",
      "- **0** appends only if a count is already in progress; otherwise it remains the **0** motion.",
      "- Counts are capped at **10,000**.",
      "",
      "### Supported commands (MVP)",
      "",
      "Counts currently apply to:",
      "",
      "- Motions: **h/j/k/l**, **w/W**, **b/B**, **e/E**, **0**, **$**, **\\_**, **gg**, **G**, **f/F**, **t/T**, **;**, **,**",
      "- Edits: **x**, **~**",
      "- Operator + motion combos, including **dd/yy/cc**",
      "",
      "### Limitations",
      "",
      "Counts are not yet supported for every command (e.g. repeating paste, undo/redo, or insert-mode entry).",
      "",
      "## Text Objects",
      "",
      "Text objects let you operate on semantic units.",
      "",
      "### Words",
      "",
      "- **iw** - Inner word (word under cursor)",
      "  - **diw** - Delete inner word",
      "  - **ciw** - Change inner word",
      "  - **yiw** - Yank inner word",
      "",
      "- **aw** - A word (includes surrounding whitespace)",
      "  - **daw** - Delete word + whitespace",
      "  - **caw** - Change word + whitespace",
      "  - **yaw** - Yank word + whitespace",
      "",
      "Text objects work from anywhere within the word — you don't need to be at the start.",
      "",
      "### Delimiters (current line only)",
      "",
      "Quotes:",
      "",
      '- **i"** / **a"** - Inside / around double quotes',
      "- **i'** / **a'** - Inside / around single quotes",
      "",
      "Brackets:",
      "",
      "- **i(** / **a(** - Inside / around parentheses",
      "- **i[** / **a[** - Inside / around square brackets",
      "- **i\\{** / **a\\{** - Inside / around curly braces",
      "",
      "Notes:",
      "",
      "- These are currently **line-local** (they don’t search across lines).",
      "- Escaping and complex nesting behavior is not yet supported.",
      "",
      "## Visual Feedback",
      "",
      "- **Cursor**: Thin blinking cursor in insert mode, solid block in normal/visual modes",
      "- **Selection**: Visual mode uses the textarea selection highlight",
      '- **Mode Indicator**: Shows current mode and pending commands (e.g., "NORMAL d" when waiting for motion)',
      "",
      "## Keybind Conflicts",
      "",
      "### ESC Key",
      "",
      "ESC is used for:",
      "",
      "1. Exiting Vim normal mode (highest priority)",
      "2. NOT used for canceling edits (use **Ctrl-Q** instead)",
      "3. NOT used for interrupting streams in Vim mode (use **Ctrl-C**)",
      "4. In non-Vim mode, **Esc** interrupts streams",
      "",
      "### Ctrl+C Key (Vim Mode)",
      "",
      "In Vim mode, **Ctrl+C always interrupts streams** (similar to terminal interrupt behavior). This means:",
      "",
      "- Standard Ctrl+C copy is **not available** in Vim mode",
      "- Use **vim yank commands** (`y`, `yy`, `yiw`, etc.) to copy text instead",
      "- This provides consistent interrupt behavior whether text is selected or not",
      "",
      "## Tips",
      "",
      "1. **Learn operators + motions**: Instead of memorizing every command, learn the operators (d, c, y) and motions (w, b, $, 0). They combine naturally.",
      "",
      "2. **Use text objects**: `ciw` to change a word is more reliable than `cw` because it works from anywhere in the word.",
      "",
      "3. **Column preservation**: When navigating up/down, your column position is preserved across lines of different lengths.",
      "",
      "## Not Yet Implemented",
      "",
      "Features that may be added in the future:",
      "",
      "- **ge** - Backward end of word motion",
      "- **More text objects** - Multi-line delimiters, escaping, and additional objects",
      "- **Visual block mode (Ctrl-v)** - Blockwise selection",
      "- **Macros** - Recording and replaying command sequences",
      "- **Marks** - Named cursor positions",
      "",
    ].join("\n"),
    "references/docs/docs.json": [
      "{",
      '  "$schema": "https://mintlify.com/docs.json",',
      '  "theme": "maple",',
      '  "name": "Mux",',
      '  "logo": {',
      '    "light": "/img/logo-black.svg",',
      '    "dark": "/img/logo-white.svg"',
      "  },",
      '  "favicon": "/favicon.svg",',
      '  "colors": {',
      '    "primary": "#999",',
      '    "light": "#FFF",',
      '    "dark": "#000"',
      "  },",
      '  "appearance": {',
      '    "default": "dark"',
      "  },",
      '  "interaction": {',
      '    "drilldown": true',
      "  },",
      '  "icons": {',
      '    "library": "lucide"',
      "  },",
      '  "css": ["/custom.css"],',
      '  "navigation": {',
      '    "tabs": [',
      "      {",
      '        "tab": "Documentation",',
      '        "groups": [',
      "          {",
      '            "group": "Getting Started",',
      '            "pages": [',
      '              "index",',
      '              "install",',
      "              {",
      '                "group": "Models",',
      '                "pages": ["config/models", "config/providers"]',
      "              },",
      '              "getting-started/why-parallelize",',
      '              "getting-started/mux-gateway",',
      '              "reference/cli"',
      "            ]",
      "          },",
      "          {",
      '            "group": "Workspaces",',
      '            "pages": [',
      '              "workspaces",',
      '              "workspaces/fork",',
      '              "workspaces/sharing",',
      "              {",
      '                "group": "Compaction",',
      '                "pages": [',
      '                  "workspaces/compaction",',
      '                  "workspaces/compaction/manual",',
      '                  "workspaces/compaction/automatic",',
      '                  "workspaces/compaction/customization"',
      "                ]",
      "              },",
      "              {",
      '                "group": "Runtimes",',
      '                "pages": [',
      '                  "runtime",',
      '                  "runtime/local",',
      '                  "runtime/worktree",',
      '                  "runtime/ssh",',
      '                  "runtime/coder",',
      '                  "runtime/docker",',
      '                  "runtime/devcontainer"',
      "                ]",
      "              },",
      "              {",
      '                "group": "Hooks",',
      '                "pages": [',
      '                  "hooks/init",',
      '                  "hooks/tools",',
      '                  "hooks/environment-variables"',
      "                ]",
      "              }",
      "            ]",
      "          },",
      "          {",
      '            "group": "Agents",',
      '            "pages": [',
      '              "agents",',
      '              "agents/instruction-files",',
      '              "agents/agent-skills",',
      '              "agents/plan-mode",',
      '              "agents/system-prompt",',
      '              "agents/prompting-tips"',
      "            ]",
      "          },",
      "          {",
      '            "group": "Configuration",',
      '            "pages": [',
      '              "config/mcp-servers",',
      '              "config/policy-file",',
      '              "config/project-secrets",',
      '              "config/agentic-git-identity",',
      '              "config/keybinds",',
      '              "config/notifications",',
      '              "config/vim-mode"',
      "            ]",
      "          },",
      "",
      "          {",
      '            "group": "Guides",',
      '            "pages": [',
      '              "guides/github-actions",',
      '              "config/agentic-git-identity",',
      '              "agents/prompting-tips"',
      "            ]",
      "          },",
      "          {",
      '            "group": "Integrations",',
      '            "pages": ["integrations/vscode-extension"]',
      "          },",
      "          {",
      '            "group": "Reference",',
      '            "pages": [',
      '              "reference/telemetry",',
      '              "reference/storybook",',
      '              "reference/benchmarking",',
      '              "AGENTS"',
      "            ]",
      "          }",
      "        ]",
      "      }",
      "    ]",
      "  },",
      '  "footerSocials": {',
      '    "github": "https://github.com/coder/mux"',
      "  },",
      '  "integrations": {',
      '    "ga4": {',
      '      "measurementId": "G-D1HL4PBRSY"',
      "    }",
      "  },",
      '  "contextual": {',
      '    "options": ["copy", "view", "chatgpt", "claude", "cursor", "vscode"]',
      "  },",
      '  "redirects": [',
      '    { "source": "/why-parallelize", "destination": "/getting-started/why-parallelize" },',
      '    { "source": "/mux-codes", "destination": "/getting-started/mux-gateway" },',
      '    { "source": "/getting-started/mux-codes", "destination": "/getting-started/mux-gateway" },',
      '    { "source": "/fork", "destination": "/workspaces/fork" },',
      '    { "source": "/init-hooks", "destination": "/hooks/init" },',
      '    { "source": "/agent-skills", "destination": "/agents/agent-skills" },',
      '    { "source": "/instruction-files", "destination": "/agents/instruction-files" },',
      '    { "source": "/plan-mode", "destination": "/agents/plan-mode" },',
      '    { "source": "/system-prompt", "destination": "/agents/system-prompt" },',
      '    { "source": "/models", "destination": "/config/models" },',
      '    { "source": "/providers", "destination": "/config/providers" },',
      '    { "source": "/mcp-servers", "destination": "/config/mcp-servers" },',
      '    { "source": "/project-secrets", "destination": "/config/project-secrets" },',
      '    { "source": "/agentic-git-identity", "destination": "/config/agentic-git-identity" },',
      '    { "source": "/keybinds", "destination": "/config/keybinds" },',
      '    { "source": "/notifications", "destination": "/config/notifications" },',
      '    { "source": "/cli", "destination": "/reference/cli" },',
      '    { "source": "/guides/cli", "destination": "/reference/cli" },',
      '    { "source": "/context-management", "destination": "/workspaces/compaction" },',
      '    { "source": "/guides/context-management", "destination": "/workspaces/compaction" },',
      '    { "source": "/guides/compaction", "destination": "/workspaces/compaction" },',
      '    { "source": "/guides/compaction/manual", "destination": "/workspaces/compaction/manual" },',
      '    { "source": "/guides/compaction/automatic", "destination": "/workspaces/compaction/automatic" },',
      '    { "source": "/sharing", "destination": "/workspaces/sharing" },',
      '    { "source": "/guides/sharing", "destination": "/workspaces/sharing" },',
      '    { "source": "/prompting-tips", "destination": "/agents/prompting-tips" },',
      '    { "source": "/guides/prompting-tips", "destination": "/agents/prompting-tips" },',
      '    { "source": "/vim-mode", "destination": "/config/vim-mode" },',
      '    { "source": "/guides/vim-mode", "destination": "/config/vim-mode" },',
      '    { "source": "/vscode-extension", "destination": "/integrations/vscode-extension" },',
      '    { "source": "/telemetry", "destination": "/reference/telemetry" },',
      '    { "source": "/storybook", "destination": "/reference/storybook" },',
      '    { "source": "/benchmarking", "destination": "/reference/benchmarking" }',
      "  ]",
      "}",
      "",
    ].join("\n"),
    "references/docs/getting-started/mux-gateway.mdx": [
      "---",
      "title: Mux Gateway",
      "description: Log in to Mux Gateway to get evaluation credits",
      "---",
      "",
      "Mux Gateway is an optional provider that routes requests through Coder's gateway, so you can try supported models with evaluation credits (if eligible).",
      "",
      "## Eligibility",
      "",
      "Currently, OSS contributors with GitHub accounts older than 12 months (or GitHub Pro members) can receive evaluation credits after logging in.",
      "",
      "If you're not eligible (or you run out of credits), you can still use Mux by configuring providers directly with your own API keys.",
      "",
      "## Mux Codes",
      "",
      "If you receive a **Mux Code** (for example, at an event), redeem it on the Gateway website and the credits will be applied to your GitHub account.",
      "",
      "1. Go to [gateway.mux.coder.com](https://gateway.mux.coder.com) and sign in with GitHub.",
      "2. Redeem the code.",
      "   - The credit is assigned to the GitHub account you used to redeem it.",
      "   - You do **not** need to paste the code into the Mux app.",
      "3. In Mux, click **Login to Mux Gateway** and sign in with that same GitHub account — your updated balance should show up in Settings.",
      "",
      "## Log in",
      "",
      "1. Open Mux (see [install](/install) for instructions).",
      "2. Open **Settings** (Cmd+, on macOS).",
      "3. Under **Providers**, expand **Mux Gateway**.",
      "4. Click **Login to Mux Gateway** and complete the browser flow.",
      "5. Return to Mux — your Gateway balance and limits should show up in Settings.",
      "",
      "## Enable Mux Gateway for models",
      "",
      "1. In **Settings → Models**, turn on **Mux Gateway** for the model(s) you want to use.",
      "2. Optionally, click **Star** to set a model as your default model.",
      "",
      "## Our Ask",
      "",
      "As Mux is in its early development stage, we highly value user feedback. Please let us know of any issues you encounter or feature requests in [our tracker](https://github.com/coder/mux/issues).",
      "",
    ].join("\n"),
    "references/docs/getting-started/why-parallelize.mdx": [
      "---",
      "title: Why Parallelize?",
      "description: Use cases for running multiple AI agents in parallel",
      "---",
      "",
      "A few reasons parallel workspaces matter:",
      "",
      "- **Keep context aligned**: Create dedicated workspaces for threads like `code-review`, `refactor`, and `new-feature`.",
      "- **Run long jobs in the background**: Kick off a slow, high-accuracy model for a deep investigation or refactor.",
      "  - Streams resume after restarts or intermittent connection issues.",
      "  - Mux shows an indicator when the model finishes.",
      "- **A/B implementations**: Try multiple approaches to the same problem and keep the best one.",
      "- **Tangent management**: Fork or create a new workspace for side quests so the main thread stays focused.",
      "",
    ].join("\n"),
    "references/docs/guides/github-actions.mdx": [
      "---",
      "title: GitHub Actions",
      "description: Automate your workflows with mux run in GitHub Actions",
      "---",
      "",
      "`mux run` is designed for automation scenarios like CI/CD pipelines. This guide shows how to integrate mux into your GitHub Actions workflows.",
      "",
      "## Prerequisites",
      "",
      "1. **API Key**: Add your `ANTHROPIC_API_KEY` (or other provider key) to your repository's secrets. See [Providers](/config/providers) for details on configuring API keys.",
      "2. **npm/bun**: The workflow will install Mux via `bunx` or `npx`",
      "",
      "## Basic Usage",
      "",
      "Here's a minimal example that runs Mux in a GitHub Action:",
      "",
      "```yaml",
      "- name: Mux Review",
      "  env:",
      "    ANTHROPIC_API_KEY: ${{ secrets.ANTHROPIC_API_KEY }}",
      "    GH_TOKEN: ${{ secrets.GITHUB_TOKEN }}",
      '  run: bunx mux run "Review this PR for critical issues. If any are found, exit with 1 to block merge."',
      "```",
      "",
      "`mux run` supports agent-controlled exit codes, so the workflow step can fail when issues are found.",
      "",
      "### Key Options for CI",
      "",
      "| Option           | Purpose                                        |",
      "| ---------------- | ---------------------------------------------- |",
      "| `--quiet`        | Only output final result (cleaner logs)        |",
      "| `--json`         | Machine-readable NDJSON output for parsing     |",
      "| `--budget <usd>` | Limit spending per run (e.g., `--budget 1.00`) |",
      "",
      "## Example: Auto-Cleanup Workflow",
      "",
      "This is the exact workflow used live in the Mux repo (see [`.github/workflows/auto-cleanup.yml`](https://github.com/coder/mux/blob/main/.github/workflows/auto-cleanup.yml)). It runs periodically to identify low-risk cleanup opportunities and maintains a refactor PR with improvements.",
      "",
      "The prompt is stored in a separate file ([`.github/prompts/auto-cleanup.md`](https://github.com/coder/mux/blob/main/.github/prompts/auto-cleanup.md)) and piped via stdin, keeping the workflow file clean and the prompt easy to iterate on.",
      "",
      "{/* BEGIN AUTO_CLEANUP_WORKFLOW */}",
      "",
      "```yaml",
      "# Periodically cleans up the codebase and maintains a refactor PR.",
      "# SETUP: Add ANTHROPIC_API_KEY to repository secrets.",
      "",
      "name: Auto-Cleanup",
      "",
      "on:",
      "  schedule:",
      '    - cron: "0 */4 * * *" # Every 4 hours',
      "  workflow_dispatch:",
      "",
      "permissions:",
      "  contents: write",
      "  pull-requests: write",
      "",
      "jobs:",
      "  cleanup:",
      "    runs-on: ubuntu-latest",
      "    steps:",
      "      - uses: actions/checkout@34e114876b0b11c390a56381ad16ebd13914f8d5 # v4.3.1",
      "        with:",
      "          fetch-depth: 0",
      "      - uses: oven-sh/setup-bun@b7a1c7ccf290d58743029c4f6903da283811b979 # v2.1.0",
      "",
      "      - name: Cleanup with mux",
      "        env:",
      "          ANTHROPIC_API_KEY: ${{ secrets.ANTHROPIC_API_KEY }}",
      "          GH_TOKEN: ${{ secrets.GITHUB_TOKEN }}",
      "        run: |",
      '          [ -z "$ANTHROPIC_API_KEY" ] && echo "Skipping (no API key)" && exit 0',
      "",
      "          bunx mux@next run \\",
      "            --model anthropic:claude-opus-4-6 \\",
      "            --thinking xhigh \\",
      "            < .github/prompts/auto-cleanup.md",
      "```",
      "",
      "{/* END AUTO_CLEANUP_WORKFLOW */}",
      "",
      "<CardGroup cols={2}>",
      '  <Card title="CLI Reference" icon="terminal" href="/reference/cli">',
      "    Full CLI documentation",
      "  </Card>",
      '  <Card title="Agentic Git Identity" icon="user-robot" href="/config/agentic-git-identity">',
      "    Configure separate Git identity for AI commits",
      "  </Card>",
      "</CardGroup>",
      "",
    ].join("\n"),
    "references/docs/hooks/environment-variables.mdx": [
      "---",
      "title: Environment Variables",
      "description: Environment variables available in agent bash commands and hooks",
      "---",
      "",
      "The following environment variables are available in all agent bash tool executions, including [init hooks](/hooks/init).",
      "",
      "## Available Variables",
      "",
      "| Variable             | Description                                                                                                                   |",
      "| -------------------- | ----------------------------------------------------------------------------------------------------------------------------- |",
      "| `MUX_PROJECT_PATH`   | Absolute path to the project root on the **local machine**. Always refers to your local project path, even on SSH workspaces. |",
      '| `MUX_RUNTIME`        | Runtime type: `"local"`, `"worktree"`, `"ssh"`, or `"docker"`                                                                 |',
      "| `MUX_WORKSPACE_NAME` | Name of the workspace (typically the branch name)                                                                             |",
      '| `MUX_MODEL_STRING`   | Model identifier (e.g., `"anthropic:claude-sonnet-4-20250514"`)                                                               |',
      '| `MUX_THINKING_LEVEL` | Reasoning level: `"off"`, `"low"`, `"medium"`, `"high"`, or `"xhigh"`                                                         |',
      '| `MUX_COSTS_USD`      | Cumulative session costs in USD, formatted to 2 decimal places (e.g., `"1.23"`)                                               |',
      "",
      "## Usage Example",
      "",
      "```bash",
      "#!/usr/bin/env bash",
      "",
      'echo "Project: $MUX_PROJECT_PATH"',
      'echo "Runtime: $MUX_RUNTIME"',
      'echo "Workspace: $MUX_WORKSPACE_NAME"',
      'echo "Model: $MUX_MODEL_STRING"',
      'echo "Thinking: $MUX_THINKING_LEVEL"',
      'echo "Costs: \\$${MUX_COSTS_USD:-0.00}"',
      "",
      "# Runtime-specific behavior",
      'if [ "$MUX_RUNTIME" = "ssh" ]; then',
      '  echo "Running on SSH remote"',
      'elif [ "$MUX_RUNTIME" = "docker" ]; then',
      '  echo "Running in Docker container"',
      "else",
      '  echo "Running locally"',
      "fi",
      "```",
      "",
      "## Use Cases",
      "",
      "- **PR footers**: Include model and cost information in automated PR descriptions",
      "- **Conditional logic**: Adapt scripts based on runtime environment",
      "- **Logging**: Track which model and settings were used for a task",
      "- **Cost monitoring**: Check cumulative costs before expensive operations",
      "",
    ].join("\n"),
    "references/docs/hooks/init.mdx": [
      "---",
      "title: Init Hooks",
      "description: Run setup commands automatically when creating new workspaces",
      "---",
      "",
      "Add a `.mux/init` executable script to your project root to run commands when creating new workspaces.",
      "",
      "## Example",
      "",
      "```bash",
      "#!/usr/bin/env bash",
      "set -e",
      "",
      "bun install",
      "bun run build",
      "```",
      "",
      "Make it executable:",
      "",
      "```bash",
      "chmod +x .mux/init",
      "```",
      "",
      "## Behavior",
      "",
      "- **Runs once** per workspace on creation",
      "- **Streams output** to the workspace UI in real-time",
      "- **Non-blocking** - workspace is immediately usable, even while hook runs",
      "- **Exit codes preserved** - failures are logged but don't prevent workspace usage",
      "",
      "The init script runs in the workspace directory with the workspace's environment.",
      "",
      "## Environment Variables",
      "",
      "Init hooks receive [environment variables](/hooks/environment-variables) including `MUX_PROJECT_PATH`, `MUX_RUNTIME`, `MUX_WORKSPACE_NAME`, and more.",
      "",
      "**Note for SSH workspaces:** Since the project is synced to the remote machine, files exist in both locations. The init hook runs in the workspace directory (`$PWD`), so use relative paths to reference project files:",
      "",
      "```bash",
      "#!/usr/bin/env bash",
      "set -e",
      "",
      'echo "Runtime: $MUX_RUNTIME"',
      'echo "Local project path: $MUX_PROJECT_PATH"',
      'echo "Workspace directory: $PWD"',
      "",
      "# Copy .env from project root (works for both local and SSH)",
      "# The hook runs with cwd = workspace, and project root is the parent directory",
      'if [ -f "../.env" ]; then',
      '  cp "../.env" "$PWD/.env"',
      "fi",
      "",
      "# Runtime-specific behavior",
      'if [ "$MUX_RUNTIME" = "local" ]; then',
      '  echo "Running on local machine"',
      "else",
      '  echo "Running on SSH remote"',
      "fi",
      "",
      "bun install",
      "```",
      "",
      "## Use Cases",
      "",
      "- Install dependencies (`npm install`, `bun install`, etc.)",
      "- Run build steps",
      "- Generate code or configs",
      "- Set up databases or services",
      "- Warm caches",
      "",
      "## Output",
      "",
      "Init output appears in a banner at the top of the workspace. Click to expand/collapse the log. The banner shows:",
      "",
      "- Script path (`.mux/init`)",
      "- Status (running, success, or exit code on failure)",
      "- Full stdout/stderr output",
      "",
      "## Idempotency",
      "",
      "The hook runs every time you create a workspace, even if you delete and recreate with the same name. Make your script idempotent if you're modifying shared state.",
      "",
    ].join("\n"),
    "references/docs/hooks/tools.mdx": [
      "---",
      "title: Tool Hooks",
      "description: Block dangerous commands, lint after edits, and set up your environment",
      "---",
      "",
      "<Note>Tool hooks are experimental. Expect breaking changes while we iterate.</Note>",
      "",
      "<Tip>",
      '  **The easiest way to set up tool hooks is to ask Mux.** Just tell Mux what you want (e.g., "lint',
      '  Python files after edits" or "block force pushes") and it will create the hook scripts for you.',
      "</Tip>",
      "",
      "Tool hooks let you run your own scripts before and after Mux tool executions.",
      "",
      "## What do you want to do?",
      "",
      "<CardGroup cols={3}>",
      '  <Card title="Block dangerous commands" icon="shield" href="#block-dangerous-commands">',
      "    Prevent force pushes, rm -rf, etc.",
      "  </Card>",
      '  <Card title="Lint after file edits" icon="check" href="#lint-after-file-edits">',
      "    Run ruff, eslint, tsc after changes",
      "  </Card>",
      '  <Card title="Set up environment" icon="gear" href="#set-up-environment">',
      "    direnv, nvm, virtualenv",
      "  </Card>",
      "</CardGroup>",
      "",
      "---",
      "",
      "## Block dangerous commands",
      "",
      "Create `.mux/tool_pre` to validate commands before they run. Exit non-zero to block:",
      "",
      "```bash",
      "#!/usr/bin/env bash",
      "# .mux/tool_pre - runs before every tool",
      "",
      'if [[ "$MUX_TOOL" == "bash" ]]; then',
      '  script="$MUX_TOOL_INPUT_SCRIPT"',
      "",
      "  if echo \"$script\" | grep -q 'push.*--force'; then",
      '    echo "❌ Force push blocked" >&2',
      "    exit 1",
      "  fi",
      "",
      "  if echo \"$script\" | grep -q 'rm -rf /'; then",
      '    echo "❌ Dangerous rm blocked" >&2',
      "    exit 1",
      "  fi",
      "fi",
      "",
      "exit 0  # Allow tool to run",
      "```",
      "",
      "```bash",
      "chmod +x .mux/tool_pre",
      "```",
      "",
      "The agent sees your error message and can adjust its approach.",
      "",
      "---",
      "",
      "## Lint after file edits",
      "",
      "Create `.mux/tool_post` to run validation after tools complete:",
      "",
      "```bash",
      "#!/usr/bin/env bash",
      "# .mux/tool_post - runs after every tool",
      "set -euo pipefail",
      "",
      '[[ "$MUX_TOOL" == file_edit_* ]] || exit 0',
      'file="${MUX_TOOL_INPUT_FILE_PATH:-}"',
      '[[ -n "$file" ]] || exit 0',
      "",
      'case "$file" in',
      "  *.py)",
      '    ruff check "$file"',
      "    ;;",
      "  *.ts|*.tsx)",
      '    npx tsc --noEmit "$file"',
      "    ;;",
      "esac",
      "```",
      "",
      "```bash",
      "chmod +x .mux/tool_post",
      "```",
      "",
      "<details>",
      "<summary>Minimal formatter example (Go)</summary>",
      "",
      "```bash",
      "#!/usr/bin/env bash",
      "# .mux/tool_post - runs after every tool",
      "set -euo pipefail",
      "",
      '[[ "$MUX_TOOL" == file_edit_* ]] || exit 0',
      'file="${MUX_TOOL_INPUT_FILE_PATH:-}"',
      '[[ "$file" == *.go ]] || exit 0',
      "",
      'gofmt -w "$file"',
      "```",
      "",
      "</details>",
      "",
      "Lint errors appear in `hook_output` and the agent can fix them.",
      "",
      "<Note>",
      "  `hook_output` is only shown in the UI when the hook produces output. For a cleaner experience,",
      '  only print output when the hook has an effect—e.g., skip "Formatted: file" messages if the file',
      "  was already formatted.",
      "</Note>",
      "",
      "---",
      "",
      "## Set up environment",
      "",
      "Create `.mux/tool_env` to configure your shell environment. This file is **sourced** before every `bash` tool call:",
      "",
      "```bash",
      "# .mux/tool_env - sourced before bash commands",
      "",
      "# direnv",
      'eval "$(direnv export bash 2>/dev/null)" || true',
      "",
      "# nvm",
      '# export NVM_DIR="$HOME/.nvm"',
      '# [ -s "$NVM_DIR/nvm.sh" ] && source "$NVM_DIR/nvm.sh"',
      "",
      "# Python virtualenv",
      "# source .venv/bin/activate 2>/dev/null || true",
      "```",
      "",
      "<Note>",
      "  Unlike hooks, `tool_env` doesn't need to be executable—it's sourced, not run. It only affects",
      "  `bash` tools.",
      "</Note>",
      "",
      "---",
      "",
      "## Reference",
      "",
      '<Accordion title="Environment Variables">',
      "",
      "All hooks receive these environment variables:",
      "",
      "| Variable              | Description                                                      |",
      "| --------------------- | ---------------------------------------------------------------- |",
      "| `MUX_TOOL`            | Tool name: `bash`, `file_edit_replace_string`, `file_read`, etc. |",
      "| `MUX_WORKSPACE_ID`    | Current workspace identifier                                     |",
      "| `MUX_TOOL_INPUT_PATH` | Path to file containing full tool input (always set)             |",
      "",
      "Mux flattens the tool input into `MUX_TOOL_INPUT_<...>` environment variables (see the appendix below). Fields longer than 8KB are omitted—use `MUX_TOOL_INPUT_PATH` for full access.",
      "",
      "**Post-hook only (`tool_post`):**",
      "",
      "| Variable               | Description                              |",
      "| ---------------------- | ---------------------------------------- |",
      "| `MUX_TOOL_RESULT_PATH` | Path to file containing full tool result |",
      "",
      "Flattened result fields are available as `MUX_TOOL_RESULT_<...>`. Fields longer than 8KB are omitted—use `MUX_TOOL_RESULT_PATH` for full access.",
      "",
      "</Accordion>",
      "",
      '<Accordion title="Exit Codes">',
      "",
      "| Exit Code | `tool_pre` behavior                | `tool_post` behavior                  |",
      "| --------- | ---------------------------------- | ------------------------------------- |",
      "| `0`       | Tool executes normally             | Success, output shown to agent        |",
      "| Non-zero  | Tool blocked, error shown to agent | Failure, error shown in `hook_output` |",
      "",
      "</Accordion>",
      "",
      '<Accordion title="Hook Priority & Location">',
      "",
      "Mux searches for each hook file in this order:",
      "",
      "1. Project-level: `.mux/<hook>`",
      "2. User-level: `~/.mux/<hook>`",
      "",
      "This applies to `tool_pre`, `tool_post`, and `tool_env`.",
      "",
      "For SSH workspaces, hooks execute **on the remote machine**.",
      "",
      "</Accordion>",
      "",
      '<Accordion title="Timeouts">',
      "",
      "Hooks must complete within **10 seconds** or they're terminated. Long-running tools (builds, tests) don't count against this—only hook execution time.",
      "",
      "Keep hooks fast—if you need longer operations, consider running them asynchronously or in the background.",
      "",
      "</Accordion>",
      "",
      '<Accordion title="Comparison">',
      "",
      "| Feature        | `.mux/tool_pre`          | `.mux/tool_post`      | `.mux/tool_env`         |",
      "| -------------- | ------------------------ | --------------------- | ----------------------- |",
      "| **Purpose**    | Block dangerous commands | Lint/validate results | Environment setup       |",
      "| **Runs**       | Before tool              | After tool            | Sourced in bash shell   |",
      "| **Applies to** | All tools                | All tools             | `bash` tool only        |",
      "| **Use case**   | Block force-push         | Run ruff/eslint       | direnv, nvm, virtualenv |",
      "",
      "</Accordion>",
      "",
      '<Accordion title="Appendix: Tool input env vars (auto-generated)">',
      "",
      "Mux also provides flattened tool input env vars so hook scripts can stay compact.",
      "",
      "- Scalars become `MUX_TOOL_INPUT_<FIELD>`",
      "- Nested objects become `MUX_TOOL_INPUT_<PARENT>_<CHILD>`",
      "- Arrays also include `..._COUNT` and per-index variables like `..._<INDEX>`",
      "",
      "If a value is too large for the environment, it may be omitted (not set). Mux also caps the number of flattened env vars and array elements to keep hook execution reliable.",
      "",
      "{/* BEGIN TOOL_HOOK_ENV_VARS */}",
      "",
      "<details>",
      "<summary>agent_report (2)</summary>",
      "",
      "| Env var                          | JSON path        | Type   | Description |",
      "| -------------------------------- | ---------------- | ------ | ----------- |",
      "| `MUX_TOOL_INPUT_REPORT_MARKDOWN` | `reportMarkdown` | string | —           |",
      "| `MUX_TOOL_INPUT_TITLE`           | `title`          | string | —           |",
      "",
      "</details>",
      "",
      "<details>",
      "<summary>agent_skill_read (1)</summary>",
      "",
      "| Env var               | JSON path | Type   | Description                                       |",
      "| --------------------- | --------- | ------ | ------------------------------------------------- |",
      "| `MUX_TOOL_INPUT_NAME` | `name`    | string | Skill name (directory name under the skills root) |",
      "",
      "</details>",
      "",
      "<details>",
      "<summary>agent_skill_read_file (4)</summary>",
      "",
      "| Env var                    | JSON path  | Type   | Description                                                                    |",
      "| -------------------------- | ---------- | ------ | ------------------------------------------------------------------------------ |",
      "| `MUX_TOOL_INPUT_FILE_PATH` | `filePath` | string | Path to the file within the skill directory (relative)                         |",
      "| `MUX_TOOL_INPUT_LIMIT`     | `limit`    | number | Number of lines to return from offset (optional, returns all if not specified) |",
      "| `MUX_TOOL_INPUT_NAME`      | `name`     | string | Skill name (directory name under the skills root)                              |",
      "| `MUX_TOOL_INPUT_OFFSET`    | `offset`   | number | 1-based starting line number (optional, defaults to 1)                         |",
      "",
      "</details>",
      "",
      "<details>",
      "<summary>ask_user_question (8)</summary>",
      "",
      "| Env var                                                        | JSON path                                         | Type    | Description                                            |",
      "| -------------------------------------------------------------- | ------------------------------------------------- | ------- | ------------------------------------------------------ |",
      "| `MUX_TOOL_INPUT_ANSWERS_<KEY>`                                 | `answers[<KEY>]`                                  | string  | —                                                      |",
      "| `MUX_TOOL_INPUT_QUESTIONS_<INDEX>_HEADER`                      | `questions[<INDEX>].header`                       | string  | Short label shown in the UI (keep it concise)          |",
      "| `MUX_TOOL_INPUT_QUESTIONS_<INDEX>_MULTI_SELECT`                | `questions[<INDEX>].multiSelect`                  | boolean | —                                                      |",
      "| `MUX_TOOL_INPUT_QUESTIONS_<INDEX>_OPTIONS_<INDEX>_DESCRIPTION` | `questions[<INDEX>].options[<INDEX>].description` | string  | —                                                      |",
      "| `MUX_TOOL_INPUT_QUESTIONS_<INDEX>_OPTIONS_<INDEX>_LABEL`       | `questions[<INDEX>].options[<INDEX>].label`       | string  | —                                                      |",
      "| `MUX_TOOL_INPUT_QUESTIONS_<INDEX>_OPTIONS_COUNT`               | `questions[<INDEX>].options.length`               | number  | Number of elements in questions[&lt;INDEX&gt;].options |",
      "| `MUX_TOOL_INPUT_QUESTIONS_<INDEX>_QUESTION`                    | `questions[<INDEX>].question`                     | string  | —                                                      |",
      "| `MUX_TOOL_INPUT_QUESTIONS_COUNT`                               | `questions.length`                                | number  | Number of elements in questions                        |",
      "",
      "</details>",
      "",
      "<details>",
      "<summary>bash (4)</summary>",
      "",
      "| Env var                            | JSON path           | Type    | Description                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |",
      "| ---------------------------------- | ------------------- | ------- | ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |",
      "| `MUX_TOOL_INPUT_DISPLAY_NAME`      | `display_name`      | string  | Human-readable name for the process (e.g., 'Dev Server', 'TypeCheck Watch'). Required for all bash invocations since any process can be sent to background.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |",
      "| `MUX_TOOL_INPUT_RUN_IN_BACKGROUND` | `run_in_background` | boolean | Run this command in the background without blocking. Use for processes running &gt;5s (dev servers, builds, file watchers). Do NOT use for quick commands (&lt;5s), interactive processes (no stdin support), or processes requiring real-time output (use foreground with larger timeout instead). Returns immediately with a taskId (bash:&lt;processId&gt;) and backgroundProcessId. Read output with task_await (returns only new output since last check). Terminate with task_terminate using the taskId. List active tasks with task_list. Process persists until timeout_secs expires, terminated, or workspace is removed. For long-running tasks like builds or compilations, prefer background mode to continue productive work in parallel. Check back periodically with task_await rather than blocking on completion. |",
      "| `MUX_TOOL_INPUT_SCRIPT`            | `script`            | string  | The bash script/command to execute                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |",
      "| `MUX_TOOL_INPUT_TIMEOUT_SECS`      | `timeout_secs`      | number  | Timeout in seconds. For foreground: max execution time before kill. For background: max lifetime before auto-termination. Start small and increase on retry; avoid large initial values to keep UX responsive                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       |",
      "",
      "</details>",
      "",
      "<details>",
      "<summary>bash_background_terminate (1)</summary>",
      "",
      "| Env var                     | JSON path    | Type   | Description                        |",
      "| --------------------------- | ------------ | ------ | ---------------------------------- |",
      "| `MUX_TOOL_INPUT_PROCESS_ID` | `process_id` | string | Background process ID to terminate |",
      "",
      "</details>",
      "",
      "<details>",
      "<summary>bash_output (4)</summary>",
      "",
      "| Env var                         | JSON path        | Type    | Description                                                                                                                                                                                                                                                                                                                                                                                                        |",
      "| ------------------------------- | ---------------- | ------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ |",
      "| `MUX_TOOL_INPUT_FILTER`         | `filter`         | string  | Optional regex to filter output lines. By default, only matching lines are returned. When filter_exclude is true, matching lines are excluded instead. Non-matching lines are permanently discarded and cannot be retrieved later.                                                                                                                                                                                 |",
      "| `MUX_TOOL_INPUT_FILTER_EXCLUDE` | `filter_exclude` | boolean | When true, lines matching 'filter' are excluded instead of kept. Key behavior: excluded lines do NOT cause early return from timeout - waiting continues until non-excluded output arrives or process exits. Use to avoid busy polling on progress spam (e.g., filter='⏳\\|waiting\\|\\.\\.\\.' with filter_exclude=true lets you set a long timeout and only wake on meaningful output). Requires 'filter' to be set. |",
      "| `MUX_TOOL_INPUT_PROCESS_ID`     | `process_id`     | string  | The ID of the background process to retrieve output from                                                                                                                                                                                                                                                                                                                                                           |",
      "| `MUX_TOOL_INPUT_TIMEOUT_SECS`   | `timeout_secs`   | number  | Seconds to wait for new output. If no output is immediately available and process is still running, blocks up to this duration. Returns early when output arrives or process exits. Only use long timeouts (&gt;15s) when no other useful work can be done in parallel.                                                                                                                                            |",
      "",
      "</details>",
      "",
      "<details>",
      "<summary>code_execution (1)</summary>",
      "",
      "| Env var               | JSON path | Type   | Description                                   |",
      "| --------------------- | --------- | ------ | --------------------------------------------- |",
      "| `MUX_TOOL_INPUT_CODE` | `code`    | string | JavaScript code to execute in the PTC sandbox |",
      "",
      "</details>",
      "",
      "<details>",
      "<summary>file_edit_insert (4)</summary>",
      "",
      "| Env var                        | JSON path       | Type   | Description                                                                             |",
      "| ------------------------------ | --------------- | ------ | --------------------------------------------------------------------------------------- |",
      "| `MUX_TOOL_INPUT_CONTENT`       | `content`       | string | The content to insert                                                                   |",
      "| `MUX_TOOL_INPUT_FILE_PATH`     | `file_path`     | string | Path to the file to edit (absolute or relative to the current workspace)                |",
      "| `MUX_TOOL_INPUT_INSERT_AFTER`  | `insert_after`  | string | Anchor text to insert after. Content will be placed immediately after this substring.   |",
      "| `MUX_TOOL_INPUT_INSERT_BEFORE` | `insert_before` | string | Anchor text to insert before. Content will be placed immediately before this substring. |",
      "",
      "</details>",
      "",
      "<details>",
      "<summary>file_edit_replace_lines (7)</summary>",
      "",
      "| Env var                                 | JSON path                 | Type   | Description                                                                                                                               |",
      "| --------------------------------------- | ------------------------- | ------ | ----------------------------------------------------------------------------------------------------------------------------------------- |",
      "| `MUX_TOOL_INPUT_END_LINE`               | `end_line`                | number | 1-indexed end line (inclusive) to replace                                                                                                 |",
      "| `MUX_TOOL_INPUT_EXPECTED_LINES_<INDEX>` | `expected_lines[<INDEX>]` | string | Optional safety check. When provided, the current lines in the specified range must match exactly.                                        |",
      "| `MUX_TOOL_INPUT_EXPECTED_LINES_COUNT`   | `expected_lines.length`   | number | Number of elements in expected_lines (Optional safety check. When provided, the current lines in the specified range must match exactly.) |",
      "| `MUX_TOOL_INPUT_FILE_PATH`              | `file_path`               | string | Path to the file to edit (absolute or relative to the current workspace)                                                                  |",
      "| `MUX_TOOL_INPUT_NEW_LINES_<INDEX>`      | `new_lines[<INDEX>]`      | string | Replacement lines. Provide an empty array to delete the specified range.                                                                  |",
      "| `MUX_TOOL_INPUT_NEW_LINES_COUNT`        | `new_lines.length`        | number | Number of elements in new_lines (Replacement lines. Provide an empty array to delete the specified range.)                                |",
      "| `MUX_TOOL_INPUT_START_LINE`             | `start_line`              | number | 1-indexed start line (inclusive) to replace                                                                                               |",
      "",
      "</details>",
      "",
      "<details>",
      "<summary>file_edit_replace_string (4)</summary>",
      "",
      "| Env var                        | JSON path       | Type   | Description                                                                                                                                          |",
      "| ------------------------------ | --------------- | ------ | ---------------------------------------------------------------------------------------------------------------------------------------------------- |",
      "| `MUX_TOOL_INPUT_FILE_PATH`     | `file_path`     | string | Path to the file to edit (absolute or relative to the current workspace)                                                                             |",
      "| `MUX_TOOL_INPUT_NEW_STRING`    | `new_string`    | string | The replacement text                                                                                                                                 |",
      "| `MUX_TOOL_INPUT_OLD_STRING`    | `old_string`    | string | The exact text to replace (must be unique in file if replace_count is 1). Include enough context (indentation, surrounding lines) to make it unique. |",
      "| `MUX_TOOL_INPUT_REPLACE_COUNT` | `replace_count` | number | Number of occurrences to replace (default: 1). Use -1 to replace all occurrences. If 1, old_string must be unique in the file.                       |",
      "",
      "</details>",
      "",
      "<details>",
      "<summary>file_read (3)</summary>",
      "",
      "| Env var                    | JSON path   | Type   | Description                                                                    |",
      "| -------------------------- | ----------- | ------ | ------------------------------------------------------------------------------ |",
      "| `MUX_TOOL_INPUT_FILE_PATH` | `file_path` | string | The path to the file to read (absolute or relative)                            |",
      "| `MUX_TOOL_INPUT_LIMIT`     | `limit`     | number | Number of lines to return from offset (optional, returns all if not specified) |",
      "| `MUX_TOOL_INPUT_OFFSET`    | `offset`    | number | 1-based starting line number (optional, defaults to 1)                         |",
      "",
      "</details>",
      "",
      "<details>",
      "<summary>mux_global_agents_write (2)</summary>",
      "",
      "| Env var                      | JSON path    | Type    | Description                                                                            |",
      "| ---------------------------- | ------------ | ------- | -------------------------------------------------------------------------------------- |",
      "| `MUX_TOOL_INPUT_CONFIRM`     | `confirm`    | boolean | Must be true to apply the write. The agent should ask the user for confirmation first. |",
      "| `MUX_TOOL_INPUT_NEW_CONTENT` | `newContent` | string  | The full new contents of the global AGENTS.md file                                     |",
      "",
      "</details>",
      "",
      "<details>",
      "<summary>notify (2)</summary>",
      "",
      "| Env var                  | JSON path | Type   | Description                                                                                                 |",
      "| ------------------------ | --------- | ------ | ----------------------------------------------------------------------------------------------------------- |",
      "| `MUX_TOOL_INPUT_MESSAGE` | `message` | string | Optional notification body with more details (max 200 chars). Keep it brief - users may only see a preview. |",
      "| `MUX_TOOL_INPUT_TITLE`   | `title`   | string | Short notification title (max 64 chars). Should be concise and actionable.                                  |",
      "",
      "</details>",
      "",
      "<details>",
      "<summary>status_set (3)</summary>",
      "",
      "| Env var                  | JSON path | Type   | Description                                                                                                                                  |",
      "| ------------------------ | --------- | ------ | -------------------------------------------------------------------------------------------------------------------------------------------- |",
      "| `MUX_TOOL_INPUT_EMOJI`   | `emoji`   | string | A single emoji character representing the current activity                                                                                   |",
      "| `MUX_TOOL_INPUT_MESSAGE` | `message` | string | A brief description of the current activity (auto-truncated to 60 chars with ellipsis if needed)                                             |",
      "| `MUX_TOOL_INPUT_URL`     | `url`     | string | Optional URL to external resource with more details (e.g., Pull Request URL). The URL persists and is displayed to the user for easy access. |",
      "",
      "</details>",
      "",
      "<details>",
      "<summary>system1_keep_ranges (4)</summary>",
      "",
      "| Env var                                     | JSON path                     | Type   | Description                                             |",
      "| ------------------------------------------- | ----------------------------- | ------ | ------------------------------------------------------- |",
      "| `MUX_TOOL_INPUT_KEEP_RANGES_<INDEX>_END`    | `keep_ranges[<INDEX>].end`    | number | 1-based end line (inclusive) in the numbered output     |",
      "| `MUX_TOOL_INPUT_KEEP_RANGES_<INDEX>_REASON` | `keep_ranges[<INDEX>].reason` | string | Optional short reason for keeping this range            |",
      "| `MUX_TOOL_INPUT_KEEP_RANGES_<INDEX>_START`  | `keep_ranges[<INDEX>].start`  | number | 1-based start line (inclusive) in the numbered output   |",
      "| `MUX_TOOL_INPUT_KEEP_RANGES_COUNT`          | `keep_ranges.length`          | number | Number of elements in keep_ranges (Line ranges to keep) |",
      "",
      "</details>",
      "",
      "<details>",
      "<summary>task (5)</summary>",
      "",
      "| Env var                            | JSON path           | Type    | Description |",
      "| ---------------------------------- | ------------------- | ------- | ----------- |",
      "| `MUX_TOOL_INPUT_AGENT_ID`          | `agentId`           | string  | —           |",
      "| `MUX_TOOL_INPUT_PROMPT`            | `prompt`            | string  | —           |",
      "| `MUX_TOOL_INPUT_RUN_IN_BACKGROUND` | `run_in_background` | boolean | —           |",
      "| `MUX_TOOL_INPUT_SUBAGENT_TYPE`     | `subagent_type`     | string  | —           |",
      "| `MUX_TOOL_INPUT_TITLE`             | `title`             | string  | —           |",
      "",
      "</details>",
      "",
      "<details>",
      "<summary>task_apply_git_patch (4)</summary>",
      "",
      "| Env var                    | JSON path   | Type    | Description                                                                                                                    |",
      "| -------------------------- | ----------- | ------- | ------------------------------------------------------------------------------------------------------------------------------ |",
      "| `MUX_TOOL_INPUT_DRY_RUN`   | `dry_run`   | boolean | When true, attempt to apply the patch in a temporary git worktree and then discard it (does not modify the current workspace). |",
      "| `MUX_TOOL_INPUT_FORCE`     | `force`     | boolean | When true, allow apply even if the patch was previously applied (and skip clean-tree checks).                                  |",
      "| `MUX_TOOL_INPUT_TASK_ID`   | `task_id`   | string  | Child task ID whose patch artifact should be applied                                                                           |",
      "| `MUX_TOOL_INPUT_THREE_WAY` | `three_way` | boolean | When true, run git am with --3way                                                                                              |",
      "",
      "</details>",
      "",
      "<details>",
      "<summary>task_await (5)</summary>",
      "",
      "| Env var                           | JSON path           | Type    | Description                                                                                                                                                                                                                                                                                                  |",
      "| --------------------------------- | ------------------- | ------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ |",
      "| `MUX_TOOL_INPUT_FILTER`           | `filter`            | string  | Optional regex to filter bash task output lines. By default, only matching lines are returned. When filter_exclude is true, matching lines are excluded instead. Non-matching lines are discarded and cannot be retrieved later.                                                                             |",
      "| `MUX_TOOL_INPUT_FILTER_EXCLUDE`   | `filter_exclude`    | boolean | When true, lines matching 'filter' are excluded instead of kept. Requires 'filter' to be set.                                                                                                                                                                                                                |",
      "| `MUX_TOOL_INPUT_TASK_IDS_<INDEX>` | `task_ids[<INDEX>]` | string  | List of task IDs to await. When omitted, waits for all active descendant tasks of the current workspace.                                                                                                                                                                                                     |",
      "| `MUX_TOOL_INPUT_TASK_IDS_COUNT`   | `task_ids.length`   | number  | Number of elements in task_ids (List of task IDs to await. When omitted, waits for all active descendant tasks of the current workspace.)                                                                                                                                                                    |",
      "| `MUX_TOOL_INPUT_TIMEOUT_SECS`     | `timeout_secs`      | number  | Maximum time to wait in seconds for each task. For bash tasks, this waits for NEW output (or process exit). If exceeded, the result returns status=queued\\|running\\|awaiting_report (task is still active). Defaults to 600 seconds (10 minutes) if not specified. Set to 0 for a non-blocking status check. |",
      "",
      "</details>",
      "",
      "<details>",
      "<summary>task_list (2)</summary>",
      "",
      "| Env var                           | JSON path           | Type   | Description                                                                                                            |",
      "| --------------------------------- | ------------------- | ------ | ---------------------------------------------------------------------------------------------------------------------- |",
      "| `MUX_TOOL_INPUT_STATUSES_<INDEX>` | `statuses[<INDEX>]` | enum   | Task statuses to include. Defaults to active tasks: queued, running, awaiting_report.                                  |",
      "| `MUX_TOOL_INPUT_STATUSES_COUNT`   | `statuses.length`   | number | Number of elements in statuses (Task statuses to include. Defaults to active tasks: queued, running, awaiting_report.) |",
      "",
      "</details>",
      "",
      "<details>",
      "<summary>task_terminate (2)</summary>",
      "",
      "| Env var                           | JSON path           | Type   | Description                                                                                                                        |",
      "| --------------------------------- | ------------------- | ------ | ---------------------------------------------------------------------------------------------------------------------------------- |",
      "| `MUX_TOOL_INPUT_TASK_IDS_<INDEX>` | `task_ids[<INDEX>]` | string | List of task IDs to terminate. Each must be a descendant sub-agent task of the current workspace.                                  |",
      "| `MUX_TOOL_INPUT_TASK_IDS_COUNT`   | `task_ids.length`   | number | Number of elements in task_ids (List of task IDs to terminate. Each must be a descendant sub-agent task of the current workspace.) |",
      "",
      "</details>",
      "",
      "<details>",
      "<summary>todo_write (3)</summary>",
      "",
      "| Env var                                | JSON path                | Type   | Description                                                                                                                  |",
      "| -------------------------------------- | ------------------------ | ------ | ---------------------------------------------------------------------------------------------------------------------------- |",
      "| `MUX_TOOL_INPUT_TODOS_<INDEX>_CONTENT` | `todos[<INDEX>].content` | string | Task description with tense matching status: past for completed, present progressive for in_progress, imperative for pending |",
      "| `MUX_TOOL_INPUT_TODOS_<INDEX>_STATUS`  | `todos[<INDEX>].status`  | enum   | Task status                                                                                                                  |",
      "| `MUX_TOOL_INPUT_TODOS_COUNT`           | `todos.length`           | number | Number of elements in todos                                                                                                  |",
      "",
      "</details>",
      "",
      "<details>",
      "<summary>web_fetch (1)</summary>",
      "",
      "| Env var              | JSON path | Type   | Description                      |",
      "| -------------------- | --------- | ------ | -------------------------------- |",
      "| `MUX_TOOL_INPUT_URL` | `url`     | string | The URL to fetch (http or https) |",
      "",
      "</details>",
      "",
      "{/* END TOOL_HOOK_ENV_VARS */}",
      "",
      "</Accordion>",
      "",
      "---",
      "",
      "## More examples",
      "",
      '<Accordion title="Format files after edits">',
      "",
      "```bash",
      "#!/usr/bin/env bash",
      "# .mux/tool_post",
      "",
      'if [[ "$MUX_TOOL" == file_edit_* ]]; then',
      '  file="$MUX_TOOL_INPUT_FILE_PATH"',
      '  prettier --write --log-level silent "$file" 2>/dev/null || true',
      "fi",
      "```",
      "",
      "</Accordion>",
      "",
      '<Accordion title="Log tool execution times">',
      "",
      "```bash",
      "#!/usr/bin/env bash",
      "# .mux/tool_post",
      "",
      "# Tool results are available via MUX_TOOL_RESULT_* if needed.",
      "echo \"$(date '+%H:%M:%S') $MUX_TOOL completed\" >> /tmp/mux-tools.log",
      "```",
      "",
      "</Accordion>",
      "",
      '<Accordion title="Python hook">',
      "",
      "```python",
      "#!/usr/bin/env python3",
      "# .mux/tool_pre",
      "",
      "import os, sys",
      "",
      "tool = os.environ.get('MUX_TOOL', '')",
      "script = os.environ.get('MUX_TOOL_INPUT_SCRIPT', '')",
      "",
      "if tool == 'bash':",
      "    if 'rm -rf /' in script:",
      '        print("❌ Blocked dangerous command", file=sys.stderr)',
      "        sys.exit(1)",
      "",
      "sys.exit(0)  # Allow",
      "```",
      "",
      "</Accordion>",
      "",
    ].join("\n"),
    "references/docs/index.mdx": [
      "---",
      "title: Introduction",
      "---",
      "",
      "**Mux** makes it easy to run parallel coding agents, each with its own isolated workspace, right from your browser or desktop. Mux is open source and LLM provider-agnostic.",
      "",
      "![Mux product screenshot](/img/product-hero.webp)",
      "",
      "## Getting Started",
      "",
      "<Columns cols={2}>",
      '  <Card title="Install Mux" icon="download" href="/install">',
      "    Download and install Mux for your operating system.",
      "  </Card>",
      '  <Card title="Mux Gateway credits" icon="key" href="/getting-started/mux-gateway">',
      "    Log in to Mux Gateway to get evaluation credits (if eligible).",
      "  </Card>",
      "</Columns>",
      "",
      "## What is Mux?",
      "",
      "Mux helps you work with multiple coding agents more effectively via:",
      "",
      "- Isolated workspaces with central view on git status updates",
      "- Multi-model (`sonnet-4-*`, `grok-*`, `gpt-5-*`, `opus-4-*`) support",
      "- Supporting UI and keybinds for efficiently managing a suite of agents",
      "- Rich markdown outputs (mermaid diagrams, LaTeX, etc.)",
      "",
      "## Quick Links",
      "",
      "- [Install](/install) - Download and installation instructions",
      "- [Why Parallelize?](/getting-started/why-parallelize) - Why parallelize?",
      "- [Keyboard Shortcuts](/config/keybinds) - Complete keyboard reference",
      "- [AGENTS](/AGENTS) - Developer guide for AI assistants",
      "",
      "## License",
      "",
      "Mux is licensed under the [GNU Affero General Public License v3.0 (AGPL-3.0)](https://github.com/coder/mux/blob/main/LICENSE).",
      "",
      "Copyright (C) 2026 Coder Technologies, Inc.",
      "",
    ].join("\n"),
    "references/docs/install.mdx": [
      "---",
      "title: Install",
      "description: Download and install Mux for macOS, Linux, and Windows",
      "---",
      "",
      "## Downloads",
      "",
      "### Release Builds",
      "",
      '<Card title="Download Mux" icon="download" href="https://github.com/coder/mux/releases">',
      "  Download pre-built binaries from the releases page.",
      "</Card>",
      "",
      "- **macOS**: Signed and notarized DMG (separate builds for Intel/Apple Silicon)",
      "- **Linux**: AppImage",
      "- **Windows** _(alpha)_: Installer exe",
      "",
      "### Development Builds",
      "",
      "Download pre-built binaries of `main` from [GitHub Actions](https://github.com/coder/mux/actions/workflows/pr.yml?query=event:push+branch:main):",
      "",
      "- **macOS**: Signed and notarized DMG",
      "  - `build-macos-x64` (Intel Macs)",
      "  - `build-macos-arm64` (Apple Silicon)",
      "- **Linux**: `build-linux` AppImage (portable, works on most distros)",
      "- **Windows**: `build-windows` installer exe",
      "",
      "To download:",
      "",
      "1. Go to the [PR workflow (main branch)](https://github.com/coder/mux/actions/workflows/pr.yml?query=event:push+branch:main)",
      "2. Click on the latest successful run",
      '3. Scroll down to "Artifacts" section',
      "4. Download the appropriate artifact for your platform",
      "",
      "### Installation",
      "",
      "#### macOS",
      "",
      "1. Download the DMG file for your Mac:",
      "   - Intel Mac: `macos-dmg-x64`",
      "   - Apple Silicon: `macos-dmg-arm64`",
      "2. Open the DMG file",
      "3. Drag Mux to Applications folder",
      "4. Open the app normally",
      "",
      "The app is code-signed and notarized by Apple, so it will open without security warnings.",
      "",
      "#### Linux",
      "",
      "1. Download the AppImage file",
      "2. Make it executable: `chmod +x Mux-*.AppImage`",
      "3. Run it: `./Mux-*.AppImage`",
      "",
      "#### Windows",
      "",
      "_(alpha)_",
      "",
      "Prerequisites:",
      "",
      "- Install **Git for Windows** (includes Git Bash). **WSL is not supported.**",
      "- Restart Mux after installing Git for Windows.",
      "",
      "1. Download the installer exe from [releases](https://github.com/coder/mux/releases) (e.g., `mux-x.x.x-x64.exe`)",
      "2. Run the installer",
      "3. Follow the installation prompts",
      "4. Launch Mux from the Start menu or desktop shortcut",
      "",
      "<Warning>",
      "  Windows support is currently in alpha. Please [report any",
      "  issues](https://github.com/coder/mux/issues) you encounter.",
      "</Warning>",
      "",
      "### Testing Pre-Release Builds",
      "",
      "<Warning>",
      "  Only builds from the `main` branch are signed and notarized. If you're testing a build from a pull",
      "  request or other branch, you'll need to bypass macOS Gatekeeper:",
      "</Warning>",
      "",
      "1. After installing, open Terminal",
      "2. Run: `xattr -cr /Applications/Mux.app`",
      "3. Run: `codesign --force --deep --sign - /Applications/Mux.app`",
      "4. Now you can open the app normally",
      "",
      "## CLI via npm",
      "",
      "The Mux CLI can also be run directly via `npx` without installing the desktop app:",
      "",
      "```bash",
      "# Run agent tasks",
      'npx mux run "Fix the failing tests"',
      "",
      "# Start the server for remote/mobile access",
      "npx mux server --port 3000",
      "```",
      "",
      "Or install globally:",
      "",
      "```bash",
      "npm install -g mux",
      "```",
      "",
      "This is ideal for CI/CD pipelines and scripted automation. See the [CLI documentation](/reference/cli) for all available commands and options.",
      "",
    ].join("\n"),
    "references/docs/integrations/vscode-extension.mdx": [
      "---",
      "title: VS Code Extension",
      "description: Pair Mux workspaces with VS Code and Cursor editors",
      "---",
      "",
      "The Mux VS Code extension allows you to easily pair with Mux during development. Our extension works with VS Code and Cursor.",
      "",
      'It\'s especially useful for completing the "last mile" of a task or establishing the initial architecture.',
      "",
      "## Overview",
      "",
      "The extension has a small initial surface area: a command to open a workspace and a Secondary Sidebar Chat view (Preview).",
      "",
      "![Mux VS Code extension screenshot](../img/vscode-ext.webp)",
      "",
      "1. Press `Cmd+Shift+P` (or `Ctrl+Shift+P` on Windows/Linux)",
      '2. Type "mux: Open Workspace"',
      "   - Optional: Set a custom keybinding in the Command Palette settings",
      "3. Select your workspace",
      "4. It opens in a new editor window",
      "",
      "The extension works with both local and SSH workspaces.",
      "",
      "## Secondary Sidebar Chat (Preview)",
      "",
      "<Warning>",
      "  The Secondary Sidebar Chat view is a preview feature and is under active development. Expect bugs",
      "  and breaking changes.",
      "</Warning>",
      "",
      "You can find it in the **Secondary Sidebar** under the `mux` container: **Chat (Preview)**.",
      "",
      "1. Open **Chat (Preview)**",
      "2. Select a Mux workspace from the picker",
      "3. Chat normally; use the pencil icon to open the workspace in a new window",
      "",
      "To send messages, Mux must be connected in server/API mode.",
      "",
      "If you hit issues, please report them on the [Mux GitHub issues page](https://github.com/coder/mux/issues).",
      "",
      "## Installation",
      "",
      "### Download",
      "",
      "Download the latest `.vsix` file from the [GitHub releases page](https://github.com/coder/mux/releases).",
      "",
      "### Install",
      "",
      "**Command line:**",
      "",
      "```bash",
      "# For VS Code",
      "code --install-extension mux-*.vsix",
      "",
      "# For Cursor",
      "cursor --install-extension mux-*.vsix",
      "```",
      "",
      "**From editor UI:**",
      "",
      "1. Open Command Palette (`Cmd+Shift+P`)",
      '2. Type "Extensions: Install from VSIX..."',
      "3. Select the downloaded file",
      "",
      "### Workspace Types",
      "",
      "The extension displays workspaces differently based on their type:",
      "",
      "- **Local**: `📁 [project-name] workspace-name`",
      "- **SSH**: `🔗 [project-name] workspace-name (ssh: hostname)`",
      "",
      "## SSH Workspaces",
      "",
      "### Requirements",
      "",
      "For SSH workspaces to work, you need:",
      "",
      "1. **Remote-SSH Extension** installed",
      "   - VS Code: `ms-vscode-remote.remote-ssh`",
      "   - Cursor: `anysphere.remote-ssh`",
      "   - The extension automatically detects which one you have",
      "2. **SSH host configured** in `~/.ssh/config` or in the Remote-SSH extension",
      "",
      "### Setup SSH Host",
      "",
      "If you haven't configured the SSH host yet:",
      "",
      "1. Open `~/.ssh/config` and add:",
      "",
      "   ```bash",
      "   Host myserver",
      "     HostName 192.168.1.100",
      "     User username",
      "     IdentityFile ~/.ssh/id_rsa",
      "   ```",
      "",
      "2. Or use VS Code's Remote-SSH command:",
      '   - `Cmd+Shift+P` → "Remote-SSH: Add New SSH Host..."',
      "",
      "## Development",
      "",
      "For development instructions, see `vscode/README.md` and `vscode/DEVELOPMENT.md` in the",
      "repository.",
      "",
      "## Related",
      "",
      "- [Workspaces Overview](/workspaces/)",
      "- [SSH Runtime](/runtime/ssh)",
      "- [VS Code Remote-SSH Documentation](https://code.visualstudio.com/docs/remote/ssh)",
      "",
    ].join("\n"),
    "references/docs/reference/benchmarking.mdx": [
      "---",
      "title: Terminal Benchmarking",
      "description: Run Terminal-Bench benchmarks with the Mux adapter",
      "---",
      "",
      "Mux ships with a headless adapter for [Terminal-Bench](https://www.tbench.ai/). The adapter runs the Electron backend without opening a window and exercises it through the same IPC paths we use in integration tests. This page documents how to launch benchmarks from the repository tree.",
      "",
      "## Prerequisites",
      "",
      "- Docker must be installed and running. Terminal-Bench executes each task inside a dedicated Docker container.",
      "- `uv` is available in the nix `devShell` (provided via `flake.nix`), or install it manually from [docs.astral.sh/uv](https://docs.astral.sh/uv/).",
      "- Standard provider API keys (e.g. `ANTHROPIC_API_KEY`, `OPENAI_API_KEY`) should be exported so Mux can stream responses.",
      "",
      "Optional environment overrides:",
      "",
      "| Variable              | Purpose                                                 | Default                                |",
      "| --------------------- | ------------------------------------------------------- | -------------------------------------- |",
      "| `MUX_AGENT_REPO_ROOT` | Path copied into each task container                    | repo root inferred from the agent file |",
      "| `MUX_TRUNK`           | Branch checked out when preparing the project           | `main`                                 |",
      "| `MUX_WORKSPACE_ID`    | Workspace identifier used inside Mux                    | `mux-bench`                            |",
      "| `MUX_MODEL`           | Preferred model (supports `provider/model` syntax)      | `anthropic/claude-sonnet-4-5`          |",
      "| `MUX_THINKING_LEVEL`  | Reasoning level (`OFF`, `LOW`, `MED`, `HIGH`, `MAX`)    | `HIGH`                                 |",
      "| `MUX_MODE`            | Starting mode (`plan` or `exec`)                        | `exec`                                 |",
      "| `MUX_RUNTIME`         | Runtime type (`local`, `worktree`, or `ssh <host>`)     | `worktree`                             |",
      "| `MUX_TIMEOUT_MS`      | Optional stream timeout in milliseconds                 | no timeout                             |",
      "| `MUX_PROVIDERS_FILE`  | Host path to `providers.jsonc` copied into each sandbox | unset (use env vars only)              |",
      "| `MUX_CONFIG_ROOT`     | Location for Mux session data inside the container      | `/root/.mux`                           |",
      "| `MUX_APP_ROOT`        | Path where the Mux sources are staged                   | `/opt/mux-app`                         |",
      "| `MUX_PROJECT_PATH`    | Explicit project directory inside the task container    | auto-detected from common paths        |",
      "",
      "## Running Terminal-Bench",
      "",
      "All commands below should be run from the repository root.",
      "",
      "### Quick smoke test (single task)",
      "",
      "```bash",
      "uvx terminal-bench run \\",
      "  --dataset terminal-bench-core==0.1.1 \\",
      "  --agent-import-path benchmarks.terminal_bench.mux_agent:MuxAgent \\",
      "  --n-tasks 1",
      "```",
      "",
      "This downloads the Terminal-Bench runner, copies the Mux sources into the container, and validates the adapter against the first task only. Use this before attempting a full sweep.",
      "",
      "### Full dataset",
      "",
      "```bash",
      "uvx terminal-bench run \\",
      "  --dataset terminal-bench-core==0.1.1 \\",
      "  --agent-import-path benchmarks.terminal_bench.mux_agent:MuxAgent",
      "```",
      "",
      "Results (pass/fail, token usage, wall-clock) are printed at the end of the run. Terminal-Bench also writes per-task logs under the current working directory; review them when diagnosing failures.",
      "",
      "You can also use `make`:",
      "",
      "```bash",
      "TB_CONCURRENCY=6 TB_LIVESTREAM=1 \\",
      'make benchmark-terminal TB_ARGS="--n-tasks 3 --model anthropic/claude-sonnet-4-20250514 --agent-kwarg mode=plan --agent-kwarg thinking_level=medium"',
      "```",
      "",
      "`TB_DATASET` defaults to `terminal-bench-core==0.1.1`, but can be overridden (e.g. `make benchmark-terminal TB_DATASET=terminal-bench-core==head`).",
      "Use `--agent-kwarg mode=plan` to exercise the plan/execute workflow—the CLI will gather a plan first, then automatically approve it and switch to execution. Leaving the flag off (or setting `mode=exec`) skips the planning phase.",
      "Use `TB_CONCURRENCY=<n>` to control `--n-concurrent` (number of concurrently running tasks) and `TB_LIVESTREAM=1` to stream log output live instead of waiting for the run to finish. These map to Terminal-Bench’s `--n-concurrent` and `--livestream` flags.",
      "",
      "## How the Adapter Works",
      "",
      "The adapter lives in `benchmarks/terminal_bench/mux_agent.py`. For each task it:",
      "",
      "1. Copies the Mux repository (package manifests + `src/`) into `/tmp/mux-app` inside the container.",
      "2. Ensures Bun exists, then runs `bun install --frozen-lockfile`.",
      "3. Launches `mux run` (`src/cli/run.ts`) to prepare workspace metadata and stream the instruction, storing state under `MUX_CONFIG_ROOT` (default `/root/.mux`).",
      "",
      "`MUX_MODEL` accepts either the Mux colon form (`anthropic:claude-sonnet-4-5`) or the Terminal-Bench slash form (`anthropic/claude-sonnet-4-5`); the adapter normalises whichever you provide.",
      "",
      "## Troubleshooting",
      "",
      "- **`command not found: bun`** – ensure the container can reach Bun’s install script, or pre-install Bun in your base image. The adapter aborts if the install step fails.",
      "- **Workspace creation errors** – set `MUX_PROJECT_PATH` to the project directory inside the task container if auto-discovery misses it.",
      "- **Streaming timeouts** – pass `--n-tasks 1` while iterating on fixes, or set `MUX_TIMEOUT_MS=180000` to reinstate a timeout if needed.",
      "",
    ].join("\n"),
    "references/docs/reference/cli.mdx": [
      "---",
      "title: CLI",
      "sidebarTitle: CLI",
      "description: Run one-off agent tasks from the command line with `mux run`",
      "---",
      "",
      "<Note>",
      "  The CLI is designed for **automation and scripting** (CI/CD pipelines, batch processing,",
      "  programmatic control). For interactive terminal experiences, consider tools like [Claude",
      "  Code](https://docs.anthropic.com/en/docs/agents-and-tools/claude-code/overview) or similar TUIs.",
      "</Note>",
      "",
      "Mux provides a CLI for running one-off agent tasks without the desktop app. Unlike the interactive desktop experience, `mux run` executes a single request to completion and exits.",
      "",
      '<Card title="GitHub Actions Guide" icon="github" href="/guides/github-actions">',
      "  Learn how to use `mux run` in CI/CD pipelines",
      "</Card>",
      "",
      "## Installation",
      "",
      "The CLI is available via npm and can be run directly with `npx`:",
      "",
      "```bash",
      "# Run without installing",
      'npx mux run "Fix the failing tests"',
      "",
      "# Or install globally",
      "npm install -g mux",
      'mux run "Fix the failing tests"',
      "```",
      "",
      "Using `npx mux` is especially convenient for CI/CD pipelines where you don't want to manage a global installation.",
      "",
      "## `mux run`",
      "",
      "Execute a one-off agent task:",
      "",
      "```bash",
      "# Basic usage - run in current directory",
      'npx mux run "Fix the failing tests"',
      "",
      "# Specify a directory",
      'mux run --dir /path/to/project "Add authentication"',
      "",
      "# Use SSH runtime",
      'mux run --runtime "ssh user@myserver" "Deploy changes"',
      "",
      "# Pipe instructions via stdin",
      'echo "Add logging to all API endpoints" | mux run',
      "",
      "# JSON output for scripts",
      "mux run --json \"List all TypeScript files\" | jq '.type'",
      "```",
      "",
      "### Options",
      "",
      "| Option                | Short | Description                                                                                                                   | Default           |",
      "| --------------------- | ----- | ----------------------------------------------------------------------------------------------------------------------------- | ----------------- |",
      "| `--dir <path>`        | `-d`  | Project directory                                                                                                             | Current directory |",
      "| `--model <model>`     | `-m`  | Model to use (e.g., `anthropic:claude-sonnet-4-5`)                                                                            | Default model     |",
      "| `--runtime <runtime>` | `-r`  | Runtime: `local`, `worktree`, `ssh <host>`, or `docker <image>`                                                               | `local`           |",
      "| `--mode <mode>`       |       | Agent mode: `plan` or `exec`                                                                                                  | `exec`            |",
      "| `--thinking <level>`  | `-t`  | Thinking level: `OFF`, `LOW`, `MED`, `HIGH`, `MAX`, or `0`–`9` (model-relative, see [Models](/config/models#thinking-levels)) | `MED`             |",
      "| `--budget <usd>`      | `-b`  | Stop when session cost exceeds budget (USD)                                                                                   | No limit          |",
      "| `--experiment <id>`   | `-e`  | Enable experiment (repeatable)                                                                                                | None              |",
      "| `--json`              |       | Output NDJSON for programmatic use                                                                                            | Off               |",
      "| `--quiet`             | `-q`  | Only output final result                                                                                                      | Off               |",
      "",
      "### Runtimes",
      "",
      "- **`local`** (default): Runs directly in the specified directory. Best for one-off tasks.",
      "- **`worktree`**: Creates an isolated git worktree under `~/.mux/src`. Useful for parallel work.",
      '- **`ssh <host>`**: Runs on a remote machine via SSH. Example: `--runtime "ssh user@myserver.com"`',
      '- **`docker <image>`**: Runs in a Docker container. Example: `--runtime "docker node:20"`',
      "",
      "### Output Modes",
      "",
      "- **Default (TTY)**: Human-readable streaming with tool call formatting",
      "- **`--json`**: NDJSON streaming - each line is a JSON object with event data",
      "- **`--quiet`**: Suppresses streaming output, only shows final assistant response",
      "",
      "### Examples",
      "",
      "```bash",
      "# Quick fix in current directory",
      'mux run "Fix the TypeScript errors"',
      "",
      "# Use a specific model with extended thinking",
      'mux run -m anthropic:claude-sonnet-4-5 -t high "Optimize database queries"',
      "",
      "# Run on remote server",
      'mux run -r "ssh dev@staging.example.com" -d /app "Update dependencies"',
      "",
      "# Scripted usage with JSON output",
      'mux run --json "Generate API documentation" > output.jsonl',
      "",
      "# Limit spending to $2.00",
      'mux run --budget 2.00 "Refactor the authentication module"',
      "```",
      "",
      "## `mux server`",
      "",
      "Start the HTTP/WebSocket server for remote access (e.g., from mobile devices):",
      "",
      "```bash",
      "mux server --port 3000 --host 0.0.0.0",
      "```",
      "",
      "Options:",
      "",
      "- `--host <host>` - Host to bind to (default: `localhost`)",
      "- `--port <port>` - Port to bind to (default: `3000`)",
      "- `--auth-token <token>` - Optional bearer token for authentication",
      "- `--add-project <path>` - Add and open project at the specified path",
      "",
      "## `mux desktop`",
      "",
      "Launch the desktop app. This is automatically invoked when running the packaged app or via `electron .`:",
      "",
      "```bash",
      "mux desktop",
      "```",
      "",
      "Note: Requires Electron. When running `mux` with no arguments under Electron, the desktop app launches automatically.",
      "",
      "## `mux --version`",
      "",
      "Print the version and git commit:",
      "",
      "```bash",
      "mux --version",
      "# v0.8.4 (abc123)",
      "```",
      "",
      "## Debug Environment Variables",
      "",
      "These environment variables help diagnose issues with LLM requests and responses.",
      "",
      "| Variable                | Purpose                                                                                                                                                                 |",
      "| ----------------------- | ----------------------------------------------------------------------------------------------------------------------------------------------------------------------- |",
      "| `MUX_DEBUG_LLM_REQUEST` | Set to `1` to log the complete LLM request (system prompt, messages, tools, provider options) as formatted JSON to the debug logs. Useful for diagnosing prompt issues. |",
      "",
      "Example usage:",
      "",
      "```bash",
      'MUX_DEBUG_LLM_REQUEST=1 mux run "Hello world"',
      "```",
      "",
      "The output includes:",
      "",
      "- `systemMessage`: The full system prompt sent to the model",
      "- `messages`: All conversation messages in the request",
      "- `tools`: Tool definitions with descriptions and input schemas",
      "- `providerOptions`: Provider-specific options (thinking level, etc.)",
      "- `mode`, `thinkingLevel`, `maxOutputTokens`, `toolPolicy`",
      "",
    ].join("\n"),
    "references/docs/reference/storybook.mdx": [
      "---",
      "title: Storybook",
      "description: Develop and test Mux UI states in isolation",
      "---",
      "",
      "Storybook renders Mux's **renderer UI** without running the full Electron app.",
      "",
      "## Starting Storybook",
      "",
      "```bash",
      "make storybook",
      "# or",
      "bun run storybook",
      "```",
      "",
      "This will start the Storybook development server at `http://localhost:6006`.",
      "",
      "## Building Static Storybook",
      "",
      "To build a static version of Storybook that can be deployed:",
      "",
      "```bash",
      "make storybook-build",
      "# or",
      "bun run storybook:build",
      "```",
      "",
      "The output will be in `storybook-static/`.",
      "",
      "## Writing Stories (full app only)",
      "",
      "Mux intentionally uses **full-app** stories (no isolated component stories).",
      "",
      "Stories live in `src/browser/stories/` and must be named `App.*.stories.tsx`.",
      "",
      "Storybook is configured to load `src/browser/stories/**/*.stories.@(ts|tsx)` (see `.storybook/main.ts`).",
      "",
      "### Basic App story structure",
      "",
      "```tsx",
      'import { appMeta, AppWithMocks, type AppStory } from "./meta.js";',
      'import { createMockORPCClient } from "@/browser/stories/mocks/orpc";',
      'import { createWorkspace, groupWorkspacesByProject } from "./mockFactory";',
      "",
      "export default {",
      "  ...appMeta,",
      '  title: "App/Sidebar",',
      "};",
      "",
      "export const SingleProject: AppStory = {",
      "  render: () => (",
      "    <AppWithMocks",
      "      setup={() => {",
      '        const workspaces = [createWorkspace({ id: "ws-1", name: "main", projectName: "my-app" })];',
      "",
      "        return createMockORPCClient({",
      "          workspaces,",
      "          projects: groupWorkspacesByProject(workspaces),",
      "        });",
      "      }}",
      "    />",
      "  ),",
      "};",
      "```",
      "",
      "### Helpers & fixtures",
      "",
      "- `src/browser/stories/meta.tsx` – shared `appMeta` + `AppWithMocks` wrapper",
      "- `src/browser/stories/mocks/orpc.ts` – `createMockORPCClient()` for building an `APIClient`",
      "- `src/browser/stories/mockFactory.ts` – deterministic fixtures (workspaces, messages, timestamps)",
      "- `src/browser/stories/storyHelpers.ts` / `storyPlayHelpers.ts` – localStorage + play-function helpers",
      "",
      "## Global styles & determinism",
      "",
      "- Global CSS is loaded from `src/browser/styles/globals.css` in `.storybook/preview.tsx`.",
      "- `.storybook/preview.tsx` stubs `Date.now()` to a stable value for deterministic snapshots; prefer using `NOW` / `STABLE_TIMESTAMP` from `mockFactory.ts` when constructing fixtures.",
      "",
      "## Examples",
      "",
      "See the existing stories for patterns:",
      "",
      "- `src/browser/stories/App.sidebar.stories.tsx`",
      "- `src/browser/stories/App.chat.stories.tsx`",
      "- `src/browser/stories/App.settings.stories.tsx`",
      "",
      "## Configuration",
      "",
      "- `.storybook/main.ts` - Main Storybook configuration (stories glob, addons, Vite config)",
      "- `.storybook/preview.tsx` - Global decorators and snapshot stabilization helpers",
      "- `tsconfig.json` - Includes `.storybook/**/*.ts(x)` for type checking",
      "",
      "## Tips",
      "",
      "- Keep story data deterministic (no `Math.random()` / real `Date.now()` in fixtures).",
      "- Use `play` functions (`@storybook/test`) to navigate the UI into the desired state.",
      "- If async rendering changes element heights (Markdown, Mermaid, tool expansion), wait for scroll stabilization (double `requestAnimationFrame`) before snapshotting.",
      "",
    ].join("\n"),
    "references/docs/reference/telemetry.mdx": [
      "---",
      "title: Telemetry",
      "description: What Mux collects, what it doesn’t, and how to disable it",
      "---",
      "",
      "Mux collects anonymous usage telemetry to help improve the product.",
      "",
      "## Privacy policy",
      "",
      "- **No personal information**: Mux does not collect usernames, project names, file paths, or code content.",
      "- **Random IDs only**: Only randomly generated workspace IDs are sent.",
      "- **No hashing**: Hashing is vulnerable to rainbow table attacks.",
      "- **Transparent payload**: See exactly what is sent in [`src/common/telemetry/payload.ts`](https://github.com/coder/mux/blob/main/src/common/telemetry/payload.ts).",
      "",
      "## What Mux tracks",
      "",
      "All telemetry events include basic system information:",
      "",
      "- Application version",
      "- Operating system platform (`darwin`, `win32`, `linux`)",
      "- Electron version",
      "",
      "### Specific events",
      "",
      "- **App started**: When the app launches (includes a first-launch flag)",
      "- **Workspace creation**: When a new workspace is created (workspace ID only)",
      "- **Workspace switching**: When you switch between workspaces (workspace IDs only)",
      "- **Message sending**: When messages are sent (model, mode, message length rounded to base-2)",
      "- **Errors**: Error types and context (no sensitive data)",
      "",
      "### What Mux does _not_ track",
      "",
      "- Your messages or code",
      "- Project names or file paths",
      "- API keys or credentials",
      "- Usernames or email addresses",
      "- Any personally identifiable information",
      "",
      "## Disabling telemetry",
      "",
      "To disable telemetry, set `MUX_DISABLE_TELEMETRY` before starting the app:",
      "",
      "```bash",
      "MUX_DISABLE_TELEMETRY=1 mux",
      "```",
      "",
      "This disables telemetry collection at the backend level.",
      "",
      "<Note>",
      "  Disabling telemetry also hides the **Share** button on assistant messages. Link sharing uses",
      "  [mux.md](https://mux.md), a separate Mux service, and is gated on telemetry enablement to respect",
      "  your privacy preferences.",
      "</Note>",
      "",
      "## Source code",
      "",
      "- **Payload definitions**: [`src/common/telemetry/payload.ts`](https://github.com/coder/mux/blob/main/src/common/telemetry/payload.ts)",
      "- **Backend service**: [`src/node/services/telemetryService.ts`](https://github.com/coder/mux/blob/main/src/node/services/telemetryService.ts)",
      "- **Frontend client**: [`src/common/telemetry/client.ts`](https://github.com/coder/mux/blob/main/src/common/telemetry/client.ts)",
      "- **Privacy utilities**: [`src/common/telemetry/utils.ts`](https://github.com/coder/mux/blob/main/src/common/telemetry/utils.ts)",
      "",
    ].join("\n"),
    "references/docs/runtime/coder.mdx": [
      "---",
      "title: Coder Runtime",
      "description: Run agents on Coder workspaces",
      "---",
      "",
      "Mux can use [Coder Workspaces](https://coder.com/docs) as SSH hosts. When enabled, Mux talks to the Coder CLI on your local machine to list templates/presets/workspaces and connects over SSH. Connecting to an existing Coder workspace lets multiple Mux workspaces share the same Coder host, which avoids per-workspace provisioning overhead.",
      "",
      "## Requirements",
      "",
      "- Coder CLI **v2.25.0+** installed on the machine running Mux and logged in to your deployment",
      "- Access to a Coder template (for new workspaces) or an existing workspace",
      "- A workspace image with git and your toolchain",
      "",
      "## Create a new Coder workspace",
      "",
      "1. Choose **SSH** as the runtime and enable **Use Coder Workspace**.",
      "2. Select **New**.",
      "3. Pick a template and (if available) a preset.",
      "4. Mux creates a Coder workspace named `mux-<workspace-name>` (derived from your Mux workspace name), waits for startup scripts, then connects over SSH.",
      "",
      "If multiple organizations have templates with the same name, Mux shows the organization name so you can pick the right one.",
      "",
      "## Use an existing Coder workspace",
      "",
      "1. Choose **Existing**.",
      "2. Select a workspace from the list (status is shown).",
      "3. Mux will start the workspace if it is stopped, then connect to `<workspace-name>.coder`.",
      "",
      "## SSH setup",
      "",
      "Mux runs `coder config-ssh --yes` before connecting, which creates SSH aliases like `<workspace-name>.coder` in `~/.ssh/config`.",
      "",
      "## Notes",
      "",
      "- If the **Use Coder Workspace** checkbox is missing, verify that the Coder CLI is found on the PATH.",
      "- Each Mux workspace still lives in its own directory on the remote machine, even when sharing a single Coder workspace.",
      "- By default, archiving a **New** (mux-created) Coder-backed workspace will also stop the underlying Coder workspace, and unarchiving will attempt to start it again. This does **not** apply when using an **Existing** Coder workspace. To disable this behavior, set `stopCoderWorkspaceOnArchive` to `false` in `~/.mux/config.json`.",
      "",
    ].join("\n"),
    "references/docs/runtime/devcontainer.mdx": [
      "---",
      "title: Dev Container Runtime",
      "description: Run agents in containers defined by devcontainer.json",
      "---",
      "",
      "Dev Container runtime runs each workspace in a container built from your project's [devcontainer.json](https://containers.dev/implementors/json_reference/). If your project already uses dev containers for VS Code or other editors, Mux can use the same configuration.",
      "",
      "## Requirements",
      "",
      "- [Dev Container CLI](https://github.com/devcontainers/cli): `npm install -g @devcontainers/cli`",
      "- Docker daemon running",
      "- A `devcontainer.json` in the project",
      "",
      "## How it works",
      "",
      "1. Mux creates a git worktree on the host machine",
      "2. Runs `devcontainer up` to build/start the container",
      "3. Commands execute inside the container via `devcontainer exec`",
      "4. Deleting the workspace stops the container and removes the worktree",
      "",
      "## Configuration",
      "",
      "Select Dev Container in the workspace creation UI. If your project has multiple configs, choose one from the dropdown.",
      "",
      "Mux searches these locations:",
      "",
      "- `.devcontainer.json`",
      "- `.devcontainer/devcontainer.json`",
      "- `.devcontainer/*/devcontainer.json` (named configs)",
      "",
      "## Credential sharing",
      "",
      'Like the [Docker runtime](/runtime/docker), you can check "Share credentials" to enable git authentication inside the container:',
      "",
      "- **SSH agent forwarding** — Your SSH keys work without copying private keys",
      "- **Git config** — Host `~/.gitconfig` is copied into the container",
      "- **GitHub CLI** — If `GH_TOKEN` is set in [project secrets](/config/project-secrets), it's passed to the container",
      "",
      "## Filesystem layout",
      "",
      "Worktrees live on the host at `~/.mux/src/<project>/<workspace>`. The container mounts this directory (location inside the container depends on your devcontainer.json `workspaceFolder`).",
      "",
      "## Notes",
      "",
      "- The Dev Container runtime button only appears if Mux finds a `devcontainer.json` in the project.",
      "",
    ].join("\n"),
    "references/docs/runtime/docker.mdx": [
      "---",
      "title: Docker Runtime",
      "description: Run agents in isolated Docker containers",
      "---",
      "",
      "Docker runtime runs each workspace in a separate Docker container, providing full isolation.",
      "",
      "## Why use Docker runtime",
      "",
      "- **Full isolation**: Each workspace runs in its own container with no shared state",
      "- **Reproducible environments**: Pin exact images for consistent tooling",
      "- **Security**: Container sandboxing limits agent access to host system",
      "",
      "## How it works",
      "",
      "1. When you create a Docker workspace, Mux starts a container from your chosen image",
      "2. Your project code is synced to `/src` inside the container via git bundle",
      "3. Commands run inside the container with `docker exec`",
      "4. Deleting the workspace removes the container",
      "",
      "## Configuration",
      "",
      "Select Docker in the workspace creation UI and specify an image:",
      "",
      "- `node:20` - Node.js with git pre-installed",
      "- `python:3.12` - Python with git pre-installed",
      "- Custom images with your toolchain",
      "",
      "## Credential sharing",
      "",
      'Check "Share credentials" when creating a Docker workspace to enable git authentication:',
      "",
      "- **SSH agent forwarding** — Your SSH keys work inside the container without copying private keys",
      "- **Git config** — Host `~/.gitconfig` is copied into the container so git has your identity and settings",
      "- **GitHub CLI** — If `GH_TOKEN` is set in [project secrets](/config/project-secrets), Mux runs `gh auth setup-git` to configure HTTPS authentication (requires `gh` CLI in the container image)",
      "",
    ].join("\n"),
    "references/docs/runtime/index.mdx": [
      "---",
      "title: Runtimes",
      "description: Configure where and how Mux executes agent workspaces",
      "---",
      "",
      "Runtimes determine where and how Mux executes agent workspaces.",
      "",
      "| Runtime                                    | Isolation                                  | Best For                                    |",
      "| ------------------------------------------ | ------------------------------------------ | ------------------------------------------- |",
      "| **[Local](/runtime/local)**                | All workspaces share the project directory | Quick edits to your working copy            |",
      "| **[Worktree](/runtime/worktree)**          | Each workspace gets its own directory      | Running multiple agents in parallel         |",
      "| **[SSH](/runtime/ssh)**                    | Remote execution over SSH                  | Security, performance, heavy parallelism    |",
      "| **[Docker](/runtime/docker)**              | Isolated container per workspace           | Full isolation, reproducible environments   |",
      "| **[Dev Container](/runtime/devcontainer)** | Container from devcontainer.json           | Projects with existing devcontainer configs |",
      "",
      "## Choosing a Runtime",
      "",
      "Choose a runtime when creating a workspace.",
      "",
      "## Init Hooks",
      "",
      "[Init hooks](/hooks/init) and agent bash tool executions can detect the runtime type via the `MUX_RUNTIME` environment variable:",
      "",
      "- `local` — Local runtime",
      "- `worktree` — Worktree runtime",
      "- `ssh` — SSH runtime",
      "- `docker` — Docker runtime",
      "- `devcontainer` — Dev Container runtime",
      "",
      "This lets your init hook adapt behavior, e.g., skip worktree-specific setup when running in local mode.",
      "",
    ].join("\n"),
    "references/docs/runtime/local.mdx": [
      "---",
      "title: Local Runtime",
      "description: Run agents directly in your project directory",
      "---",
      "",
      "Local runtime runs the agent directly in your project directory—the same directory you use for development. There's no worktree isolation; the agent works in your actual working copy.",
      "",
      "## When to Use",
      "",
      "- Quick one-off tasks in your current working copy",
      "- Reviewing agent work alongside your own uncommitted changes",
      "- Projects where worktrees don't work well (e.g., some monorepos)",
      "",
      "## Caveats",
      "",
      "<Warning>",
      "  **No isolation**: Multiple local workspaces for the same project see and modify the same files.",
      "  Running them simultaneously can cause conflicts. Mux shows a warning when another local workspace",
      "  is actively streaming.",
      "</Warning>",
      "",
      "<Warning>",
      "  **Affects your working copy**: Agent changes happen in your actual project directory.",
      "</Warning>",
      "",
      "## Filesystem",
      "",
      "The workspace path is your project directory itself. No additional directories are created.",
      "",
    ].join("\n"),
    "references/docs/runtime/ssh.mdx": [
      "---",
      "title: SSH Runtime",
      "description: Run agents on remote hosts over SSH for security and performance",
      "---",
      "",
      "Mux can run workspaces on a remote host over SSH. When configured, tool operations (file reads/edits, `bash`, etc.) execute on the remote machine.",
      "",
      "## Threat model",
      "",
      "Mux treats the remote host as potentially hostile. By default it does **not** forward your local keys or credentials.",
      "",
      "The only data synced to the remote machine is:",
      "",
      "- a git archive of the project",
      "- [Project Secrets](/config/project-secrets) (explicitly configured)",
      "",
      "## Why use SSH runtime",
      "",
      "- **Security**: Prompt injection risk is contained to the credentials/files on the remote machine.",
      "  - SSH remotes pair well with [Agentic Git Identity](/config/agentic-git-identity).",
      "- **Performance**: Run many agents in parallel without burning laptop CPU/battery.",
      "",
      "![ssh workspaces](../img/new-workspace-ssh.webp)",
      "",
      "## Host value",
      "",
      "The host field accepts anything you can pass to `ssh <host>`:",
      "",
      "- a hostname (for example `my-server.com`)",
      "- a username and hostname (for example `user@my-server.com`)",
      "- an alias from your `~/.ssh/config` (for example `my-server`)",
      "",
      "Mux delegates SSH configuration to your system `ssh` command, so advanced settings live in `~/.ssh/config`.",
      "",
      "Example entry:",
      "",
      "```text",
      "Host ovh-1",
      "  HostName 148.113.1.1",
      "  User root",
      "```",
      "",
      "## Authentication",
      "",
      "<Info>",
      "  Mux delegates to `ssh`. This is an abbreviated reference of common ways `ssh` authenticates.",
      "</Info>",
      "",
      "### Local default keys",
      "",
      "`ssh` checks these locations by default:",
      "",
      "```text",
      "~/.ssh/id_rsa",
      "~/.ssh/id_ecdsa",
      "~/.ssh/id_ecdsa_sk",
      "~/.ssh/id_ed25519",
      "~/.ssh/id_ed25519_sk",
      "```",
      "",
      "### SSH agent",
      "",
      "If you have an SSH agent running, add your key:",
      "",
      "```bash",
      "ssh-add ~/.ssh/my_key_ecdsa",
      "```",
      "",
      "### `~/.ssh/config`",
      "",
      "You can also set an explicit identity file:",
      "",
      "```text",
      "Host my-server",
      "  HostName 148.113.1.1",
      "  User root",
      "  IdentityFile ~/.ssh/id_rsa",
      "```",
      "",
      "## Coder Workspaces",
      "",
      "If you use [Coder](https://coder.com), see the [Coder runtime](/runtime/coder) page.",
      "",
    ].join("\n"),
    "references/docs/runtime/worktree.mdx": [
      "---",
      "title: Worktree Runtime",
      "description: Isolated git worktree environments for parallel agent work",
      "---",
      "",
      "Worktree runtime uses [git worktrees](https://git-scm.com/docs/git-worktree) on your local machine.",
      "",
      "Each workspace gets its own directory, but worktrees share the same `.git` directory as your main checkout.",
      "",
      "## How worktrees work",
      "",
      "A worktree is a separate directory on the same filesystem as the main repository.",
      "",
      "- It has its own working tree (files on disk) and checkout state.",
      "- It shares a `.git` with the main repository.",
      "",
      "Because `.git` is shared, **commits created in any worktree are immediately visible to your other worktrees (including your main checkout).**",
      "",
      "Worktrees aren’t locked to a branch. The agent can switch branches, enter detached HEAD, or create new branches as needed. If you want to constrain branching behavior, do it via your [instruction files](/agents/instruction-files).",
      "",
      "## Filesystem layout",
      "",
      "Worktree workspaces are stored in `~/.mux/src/<project-name>/<workspace-name>`.",
      "",
      "Example layout:",
      "",
      "```text",
      "~/.mux/src/",
      "  mux-main/",
      "    improved-auth-ux/",
      "    fix-ci-flakes/",
      "```",
      "",
    ].join("\n"),
    "references/docs/workspaces/compaction/automatic.mdx": [
      "---",
      "title: Automatic Compaction",
      "description: Let Mux automatically compact your conversations based on usage or idle time",
      "---",
      "",
      "Mux can run `/compact` for you to keep context size manageable. There are two types of automatic compaction:",
      "",
      "- **Usage-based**: Compacts when your conversation reaches a configurable percentage of the model's context window",
      "- **Idle-based**: Optionally compacts inactive workspaces after a period of time",
      "",
      "## Usage-based auto-compaction",
      "",
      "When enabled, Mux monitors your context usage and:",
      "",
      '1. Shows a subtle warning as you approach the threshold (e.g., "Auto-Compact in 12% usage")',
      "2. When you send your next message **at or above the threshold**, Mux runs compaction first, then automatically sends your message as a follow-up",
      "",
      "### Configure the threshold",
      "",
      "- Open the **Costs** sidebar tab and find **Context Usage**",
      "- Drag the blue marker to set the percentage",
      "- The setting is **saved per model** (and applies to any workspace using that model)",
      "- Default is **70%**",
      "- Set it to **100%** to disable usage-based auto-compaction",
      "",
      "Mux caps the enabled threshold at **90%** to leave a safety buffer before hard context limits.",
      "",
      "### Force-compaction during streaming",
      "",
      "If a single response pushes context usage above your threshold while streaming, Mux may interrupt and compact automatically once you exceed the threshold by an additional buffer (currently **+5%**). After compaction, Mux resumes the conversation automatically.",
      "",
      "This safety mechanism prevents hitting hard context limits mid-stream.",
      "",
      "---",
      "",
      "## Idle-based auto-compaction",
      "",
      "Idle-based auto-compaction is **off by default**.",
      "",
      "When enabled for a project, Mux periodically checks for workspaces that:",
      "",
      "- Have been inactive for the configured number of hours",
      "- Are not currently streaming",
      "- Are not already compacted",
      "",
      "Eligible workspaces are compacted automatically and marked with the idle-compacted badge (**💤📦**).",
      "",
      "### Configure idle compaction",
      "",
      "You can configure idle compaction via the UI or a slash command:",
      "",
      "**Via UI:**",
      "",
      "- Click the context usage indicator in the chat input toolbar",
      "- Enable idle-based auto-compact and set the hours",
      "",
      "**Via command:**",
      "",
      "```",
      "/idle <hours>",
      "/idle off",
      "```",
      "",
      "Examples:",
      "",
      "```",
      "/idle 24",
      "```",
      "",
      "Compact workspaces after 24 hours of inactivity.",
      "",
      "```",
      "/idle off",
      "```",
      "",
      "Disable idle compaction for this project.",
      "",
      "### Notes",
      "",
      "- The setting is **per project** (applies to all workspaces in the project)",
      "- Mux checks roughly **once per hour**, so compaction may not trigger immediately when the timer expires",
      "",
      "---",
      "",
      "## General notes",
      "",
      "- Auto-compaction uses API tokens (same cost model as `/compact`)",
      "- Auto-compaction requires known model context limits; if Mux can't determine a model's context window, usage-based auto-compaction won't run",
      "- Both types of auto-compaction use the same summarization logic as manual `/compact`",
      "",
    ].join("\n"),
    "references/docs/workspaces/compaction/customization.mdx": [
      "---",
      "title: Customization",
      "description: Customize the compaction system prompt",
      "---",
      "",
      "You can customize how Mux summarizes conversations during compaction by overriding the `compact` agent.",
      "",
      "## Override the `compact` agent",
      "",
      "Create `.mux/agents/compact.md` in your project (or `~/.mux/agents/compact.md` for global):",
      "",
      "```md",
      "---",
      "name: Compact",
      "base: compact",
      "---",
      "",
      "When summarizing:",
      "",
      "- Preserve exact file paths and command output",
      "- Prefer bullet lists over long prose",
      "```",
      "",
      "By default, your prompt is **appended** to the built-in `compact` agent.",
      "",
      "### Replace instead of append",
      "",
      "```md",
      "---",
      "name: Compact",
      "base: compact",
      "prompt:",
      "  append: false",
      "---",
      "",
      "Summarize in 5 bullets max. No preamble.",
      "```",
      "",
      "## Defaults (synced from source)",
      "",
      '<Accordion title="Built-in compact agent system prompt">',
      "",
      "{/* BEGIN COMPACT_AGENT_SYSTEM_PROMPT */}",
      "",
      "```text",
      "You are running a compaction/summarization pass. Your task is to write a concise summary of the conversation so far.",
      "",
      "IMPORTANT:",
      "",
      "- You have NO tools available. Do not attempt to call any tools or output JSON.",
      "- Simply write the summary as plain text prose.",
      "- Follow the user's instructions for what to include in the summary.",
      "```",
      "",
      "{/* END COMPACT_AGENT_SYSTEM_PROMPT */}",
      "",
      "</Accordion>",
      "",
      '<Accordion title="Default compaction instructions (user message)">',
      "",
      "{/* BEGIN COMPACTION_USER_PROMPT */}",
      "",
      "```text",
      "Summarize this conversation for a new Assistant to continue helping the user.",
      "",
      "Your summary must be approximately 2000 words.",
      "",
      "Include:",
      "- The user's overall goal and current task",
      "- Key decisions made and their rationale",
      "- Current state of the work (what's done, what's in progress)",
      "- Important technical details (file paths, function names, configurations)",
      "- Any errors encountered and how they were resolved",
      "- Unresolved issues or blockers",
      "",
      "Do not include:",
      "- Suggestions for next steps",
      "- Conversational filler or pleasantries",
      "- Redundant information",
      "",
      "Write in a factual, dense style. Every sentence should convey essential context.",
      "```",
      "",
      "{/* END COMPACTION_USER_PROMPT */}",
      "",
      "</Accordion>",
      "",
      "## Notes",
      "",
      "- Custom `compact` agents apply to both manual `/compact` and auto-compaction.",
      "- Tools are always disabled during compaction.",
      "- `-t` sets `maxOutputTokens`; Mux converts this into an approximate word target for the instruction message.",
      "",
    ].join("\n"),
    "references/docs/workspaces/compaction/index.mdx": [
      "---",
      "title: Compaction",
      "description: Managing conversation context size with compaction",
      "---",
      "",
      "As conversations grow, they consume more of the model's context window. Compaction reduces context size while preserving important information, keeping your conversations responsive and cost-effective.",
      "",
      "## Approaches",
      "",
      "| Approach                                                                  | Speed            | Context Preservation | Cost            | Reversible |",
      "| ------------------------------------------------------------------------- | ---------------- | -------------------- | --------------- | ---------- |",
      "| [Start Here](/workspaces/compaction/manual#start-here)                    | Instant          | Intelligent          | Free            | Yes        |",
      "| [`/compact`](/workspaces/compaction/manual#compact---ai-summarization)    | Slower (uses AI) | Intelligent          | Uses API tokens | No         |",
      "| [`/clear`](/workspaces/compaction/manual#clear---clear-all-history)       | Instant          | None                 | Free            | No         |",
      "| [`/truncate`](/workspaces/compaction/manual#truncate---simple-truncation) | Instant          | Temporal             | Free            | No         |",
      "| [Auto-Compaction](/workspaces/compaction/automatic)                       | Automatic        | Intelligent          | Uses API tokens | No         |",
      "",
      "## When to compact",
      "",
      "- **Proactively**: Before hitting context limits, especially on long-running tasks",
      "- **After major milestones**: When you've completed a phase and want to preserve learnings without full history",
      "- **When responses degrade**: Large contexts can reduce response quality",
      "",
      "## Next steps",
      "",
      "- [Manual Compaction](/workspaces/compaction/manual) — Commands for manually managing context",
      "- [Automatic Compaction](/workspaces/compaction/automatic) — Let Mux compact for you based on usage or idle time",
      "",
    ].join("\n"),
    "references/docs/workspaces/compaction/manual.mdx": [
      "---",
      "title: Manual Compaction",
      "description: Commands for manually managing conversation context",
      "---",
      "",
      "Manual compaction commands give you direct control over your conversation history.",
      "",
      "## Start Here",
      "",
      "Start Here allows you to restart your conversation from a specific point, using that message as the entire conversation history. This is available on:",
      "",
      '- **Plans** — Click "🎯 Start Here" on any plan to use it as your conversation starting point',
      '- **Final Assistant messages** — Click "🎯 Start Here" on any completed assistant response',
      "",
      "![Start Here](/img/plan-compact.webp)",
      "",
      'This is a form of "opportunistic compaction" — the content is already well-structured, so the operation is instant. You can review the new starting point before the old context is permanently removed, making this the only reversible compaction approach.',
      "",
      "---",
      "",
      "## `/compact` — AI Summarization",
      "",
      "Compress conversation history using AI summarization. Replaces the conversation with a compact summary that preserves context.",
      "",
      "### Syntax",
      "",
      "```",
      "/compact [-t <tokens>] [-m <model>]",
      "[continue message on subsequent lines]",
      "```",
      "",
      "### Options",
      "",
      "- `-t <tokens>` — Maximum output tokens for the summary (default: ~2000 words)",
      "- `-m <model>` — Model to use for compaction (sticky preference). Supports abbreviations like `haiku`, `sonnet`, or full model strings",
      "",
      "### Examples",
      "",
      "**Basic compaction:**",
      "",
      "```",
      "/compact",
      "```",
      "",
      "**Limit summary size:**",
      "",
      "```",
      "/compact -t 5000",
      "```",
      "",
      "**Choose compaction model:**",
      "",
      "```",
      "/compact -m haiku",
      "```",
      "",
      "Use Haiku for faster, lower-cost compaction. This becomes your default until changed.",
      "",
      "**Auto-continue with custom message:**",
      "",
      "```",
      "/compact",
      "Continue implementing the auth system",
      "```",
      "",
      'After compaction completes, automatically sends "Continue implementing the auth system" as a follow-up message.',
      "",
      "**Multiline continue message:**",
      "",
      "```",
      "/compact",
      "Now let's refactor the middleware to use the new auth context.",
      "Make sure to add tests for the error cases.",
      "```",
      "",
      "Continue messages can span multiple lines for more detailed instructions.",
      "",
      "**Combine all options:**",
      "",
      "```",
      "/compact -m haiku -t 8000",
      "Keep working on the feature",
      "```",
      "",
      "Combine custom model, token limit, and auto-continue message.",
      "",
      "### Notes",
      "",
      "- Model preference persists globally across workspaces",
      "- Uses the specified model (or workspace model by default) to summarize conversation history",
      "- Preserves actionable context and specific details",
      "- **Irreversible** — original messages are replaced",
      "- Continue message is sent once after compaction completes (not persisted)",
      "",
      "---",
      "",
      "## `/clear` — Clear All History",
      "",
      "Remove all messages from conversation history.",
      "",
      "### Syntax",
      "",
      "```",
      "/clear",
      "```",
      "",
      "### Notes",
      "",
      "- Instant deletion of all messages",
      "- **Irreversible** — all history is permanently removed",
      "- Use when you want to start a completely new conversation",
      "",
      "---",
      "",
      "## `/truncate` — Simple Truncation",
      "",
      "Remove a percentage of messages from conversation history (from the oldest first).",
      "",
      "### Syntax",
      "",
      "```",
      "/truncate <percentage>",
      "```",
      "",
      "### Parameters",
      "",
      "- `percentage` (required) — Percentage of messages to remove (0-100)",
      "",
      "### Examples",
      "",
      "```",
      "/truncate 50",
      "```",
      "",
      "Remove oldest 50% of messages.",
      "",
      "### Notes",
      "",
      "- Simple deletion, no AI involved",
      "- Removes messages from oldest to newest",
      "- About as fast as `/clear`",
      "- `/truncate 100` is equivalent to `/clear`",
      "- **Irreversible** — messages are permanently removed",
      "",
      "### OpenAI Responses API Limitation",
      "",
      "<Warning>",
      "  `/truncate` does not work with OpenAI models due to the Responses API architecture:",
      "</Warning>",
      "",
      "- OpenAI's Responses API stores conversation state server-side",
      "- Manual message deletion via `/truncate` doesn't affect the server-side state",
      '- Instead, OpenAI models use **automatic truncation** (`truncation: "auto"`)',
      "- When context exceeds the limit, the API automatically drops messages from the middle of the conversation",
      "",
      "**Workarounds for OpenAI:**",
      "",
      "- Use `/clear` to start a fresh conversation",
      "- Use `/compact` to intelligently summarize and reduce context",
      "- Rely on automatic truncation (enabled by default)",
      "",
    ].join("\n"),
    "references/docs/workspaces/fork.mdx": [
      "---",
      "title: Forking Workspaces",
      "description: Clone workspaces with conversation history to explore alternatives",
      "---",
      "",
      "Use `/fork` to clone a workspace with its full conversation history and UI state. The forked workspace gets a new workspace on a new branch (using the same backend as the current workspace).",
      "",
      "Usage:",
      "",
      "```",
      "/fork <new-workspace-name>",
      "",
      "[start-message (optional)]",
      "```",
      "",
      "## Use cases",
      "",
      "- **Explore alternatives**: Fork mid-conversation to try a different implementation approach.",
      "- **Isolate tangents**: See an unrelated bug or opportunity in the course of a change? Fork to keep the main conversation on track.",
      "- **Create backup**: Fork to keep a copy of an old conversation before a risky change in direction.",
      "",
      "## What happens when you fork",
      "",
      "The new workspace:",
      "",
      "- Appears at the top of the workspace list (most recent)",
      "- Uses the provided workspace name (you can rename later)",
      "- Branches from the current workspace's HEAD commit",
      "",
      "**What's copied**: Conversation history, model selection, thinking level, auto-retry setting, UI mode (plan/exec), chat input text",
      "",
      "**What's not copied**: Uncommitted file changes (new branch starts from HEAD)",
      "",
    ].join("\n"),
    "references/docs/workspaces/index.mdx": [
      "---",
      "title: Workspaces",
      "description: Isolated development environments for parallel agent work",
      "---",
      "",
      "Workspaces let you run multiple agent sessions in parallel.",
      "",
      "Each workspace has its own chat history and, depending on runtime, its own working directory and Git checkout state.",
      "",
      "## Runtimes",
      "",
      "Runtimes decide where a workspace runs and how isolated its filesystem is:",
      "",
      "- **[Local](/runtime/local)**: Runs directly in your project directory. No filesystem isolation.",
      "- **[Worktree](/runtime/worktree)**: Creates a local [git worktree](https://git-scm.com/docs/git-worktree) for per-workspace isolation while still sharing `.git`.",
      "- **[SSH](/runtime/ssh)**: Runs on a remote host over SSH (useful for security isolation and heavy parallelism).",
      "",
      "## Key concepts",
      "",
      "- **Branch flexibility**: A workspace can switch branches, use detached HEAD, or create new branches as needed.",
      "- **Commit visibility**: Local + worktree runtimes share the same Git repository. Commits made in one workspace are immediately visible to your other worktrees and your main checkout.",
      "- **Parallel execution**: Multiple workspaces can work on different tasks concurrently.",
      "",
      "## Reviewing changes",
      "",
      'A few common workflows (from "agent edits only" → "agent owns the PR"):',
      "",
      "- **Agent edits only**: Open the workspace directory and stage/commit yourself (`git add -p`).",
      "- **Agent commits**: Review locally from your main checkout (for example `git show <workspace-branch>`), then push when you’re satisfied.",
      "- **Agent commits + pushes**: Ask the agent to open a PR and review in GitHub/GitLab.",
      "  - Also see: [Agentic Git Identity](/config/agentic-git-identity)",
      "  - This requires granting the workspace git push credentials; prefer a dedicated identity/token.",
      "",
      "## Reviewing functionality (UI, behavior)",
      "",
      "Some changes (especially UI ones) are faster to review by running the workspace locally.",
      "",
      "1. Ask the agent to commit when it’s ready for review.",
      "2. If the workspace is a **worktree**, check out the branch in a detached HEAD state from your main checkout:",
      "",
      "   ```bash",
      "   git checkout --detach <workspace-branch>",
      "   ```",
      "",
      "<Note>",
      "  Detached HEAD is useful here because a branch can only be checked out by one worktree at a time.",
      "</Note>",
      "",
      "If you want faster iteration between commits, open the workspace directory and run a dev server (for example `bun dev`) there directly.",
      "",
      "---",
      "",
      "See the runtime pages for setup and trade-offs.",
      "",
    ].join("\n"),
    "references/docs/workspaces/sharing.mdx": [
      "---",
      "title: Message Sharing",
      "sidebarTitle: Sharing",
      "description: Share encrypted messages with cryptographic signatures via Mux",
      "---",
      "",
      "Mux lets you share assistant messages via [mux.md](https://mux.md), an end-to-end encrypted paste service. Shared messages can also be cryptographically signed to prove authorship.",
      "",
      "![Sharing](../img/message-sharing.webp)",
      "",
      "## How sharing works",
      "",
      "1. **End-to-end encryption**: Content is encrypted in your browser using AES-256-GCM before upload. The encryption key stays in the URL fragment and is never sent to the server.",
      "",
      "2. **Optional signing**: When a signing key is available, Mux signs the content with your private key. Recipients can verify the signature on mux.md.",
      "",
      "3. **Expiration**: Shares can expire after 1 hour, 24 hours, 7 days, 30 days, or never. You can change expiration after sharing.",
      "",
      "## Message signing",
      "",
      "Signing proves that you authored a shared message. When enabled, mux.md displays your GitHub username alongside a “Verified” badge.",
      "",
      "### Signing key discovery",
      "",
      "Mux looks for a signing key in these locations (first match wins):",
      "",
      "1. `~/.mux/message_signing_key` — Mux-specific key (can be a symlink)",
      "2. `~/.ssh/id_ed25519` — standard SSH Ed25519 key",
      "3. `~/.ssh/id_ecdsa` — standard SSH ECDSA key",
      "",
      "Mux can also sign using keys loaded in your SSH agent when `SSH_AUTH_SOCK` is set (for example,",
      "1Password's SSH agent). Agent-backed keys are preferred over the default `~/.ssh/id_*` files.",
      "",
      "<Tip>",
      "  To reuse an existing key without copying it:",
      "",
      "```bash",
      "ln -s ~/.ssh/id_ed25519 ~/.mux/message_signing_key",
      "```",
      "",
      "</Tip>",
      "",
      "### Supported key types",
      "",
      "- **Ed25519** (recommended) — fast, secure, 32-byte keys",
      "- **ECDSA** — P-256, P-384, and P-521 curves supported",
      "",
      "Encrypted key files (passphrase-protected) are skipped automatically unless the key is available via ssh-agent.",
      "",
      "### GitHub identity detection",
      "",
      "To display your GitHub username on signed shares, Mux detects your identity via the GitHub CLI:",
      "",
      "```bash",
      "gh auth status",
      "```",
      "",
      "If you're logged in with `gh auth login`, your GitHub username appears on mux.md alongside the signature verification.",
      "",
      "<Note>",
      "  GitHub CLI is optional. Without it, shares are still signed—recipients just see the public key",
      "  fingerprint instead of your username.",
      "</Note>",
      "",
      "### Enabling/disabling signing",
      "",
      "Click the pen icon in the share popover to toggle signing on or off. This setting persists across sessions.",
      "",
      "When signing is disabled (or no key is found), shares are still encrypted—they just won’t include a signature.",
      "",
      "## Using shared content in Mux",
      "",
      "Mux can read mux.md URLs using the `web_fetch` tool. When you paste a mux.md link into chat, Mux decrypts the content client-side and makes it available to the assistant.",
      "",
      "This enables several workflows:",
      "",
      "- **Cross-session sharing**: Move context or instructions between workspaces in the same Mux client",
      "- **Team collaboration**: Send encrypted snippets to teammates who can paste them into their own Mux sessions",
      "- **Preserving context**: Save important outputs and retrieve them later in new conversations",
      "",
      "Paste any `https://mux.md/<id>#<key>` URL into your message, and Mux will fetch and decrypt the content.",
      "",
      "<Tip>",
      "  The encryption key (after `#`) never leaves your client. Only the encrypted blob travels over the",
      "  network.",
      "</Tip>",
      "",
      "## Generating a signing key",
      "",
      "If you don’t already have an SSH key, generate one:",
      "",
      "```bash",
      "# Ed25519 (recommended)",
      'ssh-keygen -t ed25519 -f ~/.mux/message_signing_key -N ""',
      "",
      "# Or ECDSA",
      'ssh-keygen -t ecdsa -b 256 -f ~/.mux/message_signing_key -N ""',
      "```",
      "",
      'The `-N ""` flag creates a key without a passphrase (required for Mux to use it automatically).',
      "",
    ].join("\n"),
    "SKILL.md": [
      "---",
      "name: mux-docs",
      "description: Index + offline snapshot of mux documentation (progressive disclosure).",
      "---",
      "",
      "# mux docs",
      "",
      "This built-in skill helps the agent answer questions about **mux** (Coding Agent Multiplexer) without dumping the entire docs into context.",
      "",
      "## How to use",
      "",
      "### Prefer: read the bundled docs snapshot (recommended)",
      "",
      "This skill bundles an **offline snapshot of the mux docs** under `references/docs/`.",
      "",
      "Why prefer the bundled snapshot?",
      "",
      "1. The docs tree below is guaranteed to match what’s embedded.",
      "2. It’s more likely to match *your installed mux version* (the live site may be ahead).",
      "",
      "To read a specific page:",
      "",
      "```ts",
      "agent_skill_read_file({",
      '  name: "mux-docs",',
      '  filePath: "references/docs/config/models.mdx",',
      "});",
      "```",
      "",
      "### Fallback: fetch the live docs (for newer features)",
      "",
      "If the bundled docs don’t mention something (or you suspect the docs site has newer info), use `web_fetch`:",
      "",
      "```ts",
      'web_fetch({ url: "https://mux.coder.com/config/models" });',
      'web_fetch({ url: "https://mux.coder.com/agents" });',
      "```",
      "",
      "#### Docs tree (auto-generated)",
      "",
      "Use this index to find a page's:",
      "",
      "- **Docs route** (for `web_fetch`)",
      "- **Embedded file path** (for `agent_skill_read_file`)",
      "",
      "<!-- BEGIN DOCS_TREE -->",
      "- **Documentation**",
      "  - **Getting Started**",
      "    - Introduction (`/`) → `references/docs/index.mdx`",
      "    - Install (`/install`) → `references/docs/install.mdx` — Download and install Mux for macOS, Linux, and Windows",
      "    - **Models**",
      "      - Models (`/config/models`) → `references/docs/config/models.mdx` — Select and configure AI models in Mux",
      "      - Providers (`/config/providers`) → `references/docs/config/providers.mdx` — Configure API keys and settings for AI providers",
      "    - Why Parallelize? (`/getting-started/why-parallelize`) → `references/docs/getting-started/why-parallelize.mdx` — Use cases for running multiple AI agents in parallel",
      "    - Mux Gateway (`/getting-started/mux-gateway`) → `references/docs/getting-started/mux-gateway.mdx` — Log in to Mux Gateway to get evaluation credits",
      "    - CLI (`/reference/cli`) → `references/docs/reference/cli.mdx` — Run one-off agent tasks from the command line with `mux run`",
      "  - **Workspaces**",
      "    - Workspaces (`/workspaces`) → `references/docs/workspaces/index.mdx` — Isolated development environments for parallel agent work",
      "    - Forking Workspaces (`/workspaces/fork`) → `references/docs/workspaces/fork.mdx` — Clone workspaces with conversation history to explore alternatives",
      "    - Message Sharing (`/workspaces/sharing`) → `references/docs/workspaces/sharing.mdx` — Share encrypted messages with cryptographic signatures via Mux",
      "    - **Compaction**",
      "      - Compaction (`/workspaces/compaction`) → `references/docs/workspaces/compaction/index.mdx` — Managing conversation context size with compaction",
      "      - Manual Compaction (`/workspaces/compaction/manual`) → `references/docs/workspaces/compaction/manual.mdx` — Commands for manually managing conversation context",
      "      - Automatic Compaction (`/workspaces/compaction/automatic`) → `references/docs/workspaces/compaction/automatic.mdx` — Let Mux automatically compact your conversations based on usage or idle time",
      "      - Customization (`/workspaces/compaction/customization`) → `references/docs/workspaces/compaction/customization.mdx` — Customize the compaction system prompt",
      "    - **Runtimes**",
      "      - Runtimes (`/runtime`) → `references/docs/runtime/index.mdx` — Configure where and how Mux executes agent workspaces",
      "      - Local Runtime (`/runtime/local`) → `references/docs/runtime/local.mdx` — Run agents directly in your project directory",
      "      - Worktree Runtime (`/runtime/worktree`) → `references/docs/runtime/worktree.mdx` — Isolated git worktree environments for parallel agent work",
      "      - SSH Runtime (`/runtime/ssh`) → `references/docs/runtime/ssh.mdx` — Run agents on remote hosts over SSH for security and performance",
      "      - Coder Runtime (`/runtime/coder`) → `references/docs/runtime/coder.mdx` — Run agents on Coder workspaces",
      "      - Docker Runtime (`/runtime/docker`) → `references/docs/runtime/docker.mdx` — Run agents in isolated Docker containers",
      "      - Dev Container Runtime (`/runtime/devcontainer`) → `references/docs/runtime/devcontainer.mdx` — Run agents in containers defined by devcontainer.json",
      "    - **Hooks**",
      "      - Init Hooks (`/hooks/init`) → `references/docs/hooks/init.mdx` — Run setup commands automatically when creating new workspaces",
      "      - Tool Hooks (`/hooks/tools`) → `references/docs/hooks/tools.mdx` — Block dangerous commands, lint after edits, and set up your environment",
      "      - Environment Variables (`/hooks/environment-variables`) → `references/docs/hooks/environment-variables.mdx` — Environment variables available in agent bash commands and hooks",
      "  - **Agents**",
      "    - Agents (`/agents`) → `references/docs/agents/index.mdx` — Define custom agents (modes + subagents) with Markdown files",
      "    - Instruction Files (`/agents/instruction-files`) → `references/docs/agents/instruction-files.mdx` — Configure agent behavior with AGENTS.md files",
      "    - Agent Skills (`/agents/agent-skills`) → `references/docs/agents/agent-skills.mdx` — Share reusable workflows and references with skills",
      "    - Plan Mode (`/agents/plan-mode`) → `references/docs/agents/plan-mode.mdx` — Review and collaborate on plans before execution",
      "    - System Prompt (`/agents/system-prompt`) → `references/docs/agents/system-prompt.mdx` — How Mux constructs the system prompt for AI models",
      "    - Prompting Tips (`/agents/prompting-tips`) → `references/docs/agents/prompting-tips.mdx` — Tips and tricks for getting the most out of your AI agents",
      "  - **Configuration**",
      "    - MCP Servers (`/config/mcp-servers`) → `references/docs/config/mcp-servers.mdx` — Extend agent capabilities with Model Context Protocol servers",
      "    - Policy File (`/config/policy-file`) → `references/docs/config/policy-file.mdx` — Admin-enforced restrictions for providers, models, MCP, and runtimes",
      "    - Project Secrets (`/config/project-secrets`) → `references/docs/config/project-secrets.mdx` — Manage environment variables and API keys for your projects",
      "    - Agentic Git Identity (`/config/agentic-git-identity`) → `references/docs/config/agentic-git-identity.mdx` — Configure a separate Git identity for AI-generated commits",
      "    - Keyboard Shortcuts (`/config/keybinds`) → `references/docs/config/keybinds.mdx` — Complete keyboard shortcut reference for Mux",
      "    - Notifications (`/config/notifications`) → `references/docs/config/notifications.mdx` — Configure how agents notify you about important events",
      "    - Vim Mode (`/config/vim-mode`) → `references/docs/config/vim-mode.mdx` — Vim-style editing in the Mux chat input",
      "  - **Guides**",
      "    - GitHub Actions (`/guides/github-actions`) → `references/docs/guides/github-actions.mdx` — Automate your workflows with mux run in GitHub Actions",
      "    - Agentic Git Identity (`/config/agentic-git-identity`) → `references/docs/config/agentic-git-identity.mdx` — Configure a separate Git identity for AI-generated commits",
      "    - Prompting Tips (`/agents/prompting-tips`) → `references/docs/agents/prompting-tips.mdx` — Tips and tricks for getting the most out of your AI agents",
      "  - **Integrations**",
      "    - VS Code Extension (`/integrations/vscode-extension`) → `references/docs/integrations/vscode-extension.mdx` — Pair Mux workspaces with VS Code and Cursor editors",
      "  - **Reference**",
      "    - Telemetry (`/reference/telemetry`) → `references/docs/reference/telemetry.mdx` — What Mux collects, what it doesn’t, and how to disable it",
      "    - Storybook (`/reference/storybook`) → `references/docs/reference/storybook.mdx` — Develop and test Mux UI states in isolation",
      "    - Terminal Benchmarking (`/reference/benchmarking`) → `references/docs/reference/benchmarking.mdx` — Run Terminal-Bench benchmarks with the Mux adapter",
      "    - AGENTS.md (`/AGENTS`) → `references/docs/AGENTS.md` — Agent instructions for AI assistants working on the Mux codebase",
      "<!-- END DOCS_TREE -->",
      "",
      "1. Read the docs navigation (source of truth for which pages exist):",
      "",
      "```ts",
      'agent_skill_read_file({ name: "mux-docs", filePath: "references/docs/docs.json" });',
      "```",
      "",
      "2. Read a specific page by path (mirrors `docs/` in the mux repo):",
      "",
      "- `/agents` → `references/docs/agents/index.mdx`",
      "- `/config/models` → `references/docs/config/models.mdx`",
      "- `/runtime` → `references/docs/runtime/index.mdx`",
      "",
      "```ts",
      "agent_skill_read_file({",
      '  name: "mux-docs",',
      '  filePath: "references/docs/config/models.mdx",',
      "});",
      "```",
      "",
      "Notes:",
      "",
      "- Many pages are `.mdx`; some are `.../index.mdx`.",
      "- Images are not embedded; you may see `/img/...` references.",
      "",
      "## When to use",
      "",
      "Use this skill when the user asks how mux works (workspaces, runtimes, agents, models, hooks, keybinds, etc.).",
      "",
      "## Links",
      "",
      "- **GitHub**: https://github.com/coder/mux",
      "- **Documentation**: https://mux.coder.com",
      "",
    ].join("\n"),
  },
};
